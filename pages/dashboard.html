<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dashboard</title>
	<link rel="stylesheet" href="../style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
	<style>
		.dashboard-card {
			cursor: pointer;
			transition: all 0.3s ease;
			position: relative;
			overflow: hidden;
		}
		.dashboard-card::before {
			content: 'Click to view ‚Üí';
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			background: linear-gradient(to top, rgba(59, 130, 246, 0.95), rgba(59, 130, 246, 0.8));
			color: white;
			padding: 8px;
			font-size: 12px;
			font-weight: 600;
			text-align: center;
			transform: translateY(100%);
			transition: transform 0.3s ease;
		}
		.dashboard-card:hover::before {
			transform: translateY(0);
		}
		.dashboard-card:hover {
			transform: translateY(-6px);
			box-shadow: 0 15px 40px rgba(59, 130, 246, 0.25);
			border: 2px solid #3b82f6;
		}
		.dashboard-card:active {
			transform: translateY(-2px);
		}
		.card-link-hint {
			position: absolute;
			top: 12px;
			right: 12px;
			width: 28px;
			height: 28px;
			background: #f1f5f9;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px;
			color: #94a3b8;
			opacity: 0;
			transform: scale(0.8);
			transition: all 0.3s ease;
		}
		.dashboard-card:hover .card-link-hint {
			opacity: 1;
			transform: scale(1);
			background: #3b82f6;
			color: white;
		}

		/* Detail Modal Styles */
		.detail-modal {
			position: fixed;
			inset: 0;
			background: rgba(15, 23, 42, 0.7);
			backdrop-filter: blur(4px);
			z-index: 9999;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s;
		}
		.detail-modal.show {
			opacity: 1;
			visibility: visible;
		}
		.detail-modal-content {
			background: white;
			border-radius: 20px;
			width: 600px;
			max-width: 95vw;
			max-height: 85vh;
			overflow: hidden;
			transform: scale(0.9) translateY(20px);
			transition: transform 0.3s ease;
			box-shadow: 0 25px 80px rgba(0,0,0,0.3);
		}
		.detail-modal.show .detail-modal-content {
			transform: scale(1) translateY(0);
		}
		.detail-modal-header {
			padding: 20px 24px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			border-bottom: 1px solid #e2e8f0;
		}
		.detail-modal-header.students { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
		.detail-modal-header.teachers { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
		.detail-modal-header.fees { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
		.detail-modal-header.attendance { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
		.detail-modal-title {
			font-size: 18px;
			font-weight: 700;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.detail-modal-close {
			background: rgba(255,255,255,0.2);
			border: none;
			width: 36px;
			height: 36px;
			border-radius: 10px;
			color: inherit;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.2s;
		}
		.detail-modal-close:hover {
			background: rgba(255,255,255,0.3);
			transform: rotate(90deg);
		}
		.detail-modal-body {
			padding: 24px;
			max-height: 50vh;
			overflow-y: auto;
		}
		.detail-modal-footer {
			padding: 16px 24px;
			background: #f8fafc;
			border-top: 1px solid #e2e8f0;
			display: flex;
			justify-content: flex-end;
			gap: 12px;
		}
		.detail-stats-grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 16px;
			margin-bottom: 20px;
		}
		.detail-stat-card {
			background: #f8fafc;
			border-radius: 12px;
			padding: 16px;
			text-align: center;
		}
		.detail-stat-value {
			font-size: 28px;
			font-weight: 800;
			color: #1e293b;
		}
		.detail-stat-label {
			font-size: 12px;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-top: 4px;
		}
		.detail-list {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}
		.detail-list-item {
			display: flex;
			align-items: center;
			gap: 14px;
			padding: 12px 16px;
			background: #f8fafc;
			border-radius: 12px;
			transition: all 0.2s;
		}
		.detail-list-item:hover {
			background: #eff6ff;
		}
		.detail-avatar {
			width: 44px;
			height: 44px;
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			font-size: 16px;
			color: white;
		}
		.detail-item-info {
			flex: 1;
		}
		.detail-item-name {
			font-weight: 600;
			color: #1e293b;
		}
		.detail-item-sub {
			font-size: 12px;
			color: #64748b;
		}
		.detail-item-badge {
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 600;
		}
		.badge-active { background: #dcfce7; color: #16a34a; }
		.badge-inactive { background: #fee2e2; color: #dc2626; }
		.badge-paid { background: #dcfce7; color: #16a34a; }
		.badge-pending { background: #fef3c7; color: #d97706; }
		.badge-present { background: #dcfce7; color: #16a34a; }
		.badge-absent { background: #fee2e2; color: #dc2626; }
		.action-card {
			cursor: pointer;
			transition: all 0.3s ease;
		}
		.action-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.15);
		}
		.quick-actions {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
			gap: 16px;
			margin: 24px 0;
		}
		.action-card {
			background: white;
			border-radius: 14px;
			padding: 20px;
			text-align: center;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
			border: 2px solid transparent;
		}
		.action-card:hover {
			border-color: #3498db;
			transform: translateY(-6px);
			box-shadow: 0 12px 30px rgba(0,0,0,0.15);
		}
		.action-card:active {
			transform: translateY(-2px);
		}
		.action-badge {
			position: absolute;
			top: -8px;
			right: -8px;
			background: linear-gradient(135deg, #22c55e, #16a34a);
			color: white;
			font-size: 10px;
			font-weight: 700;
			padding: 4px 8px;
			border-radius: 10px;
			opacity: 0;
			transform: scale(0.8);
			transition: all 0.3s;
		}
		.action-card:hover .action-badge {
			opacity: 1;
			transform: scale(1);
		}
		.action-hint {
			font-size: 11px;
			color: #94a3b8;
			margin-top: 4px;
			opacity: 0;
			transform: translateY(5px);
			transition: all 0.3s;
		}
		.action-card:hover .action-hint {
			opacity: 1;
			transform: translateY(0);
		}
		.action-card {
			position: relative;
		}

		/* Quick Action Modal */
		.quick-action-modal {
			position: fixed;
			inset: 0;
			background: rgba(15, 23, 42, 0.7);
			backdrop-filter: blur(4px);
			z-index: 9999;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s;
		}
		.quick-action-modal.show {
			opacity: 1;
			visibility: visible;
		}
		.quick-action-modal-content {
			background: white;
			border-radius: 20px;
			width: 500px;
			max-width: 95vw;
			max-height: 85vh;
			overflow: hidden;
			transform: scale(0.9) translateY(20px);
			transition: transform 0.3s ease;
			box-shadow: 0 25px 80px rgba(0,0,0,0.3);
		}
		.quick-action-modal.show .quick-action-modal-content {
			transform: scale(1) translateY(0);
		}
		.quick-action-modal-header {
			padding: 20px 24px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			color: white;
		}
		.quick-action-modal-header.addStudent { background: linear-gradient(135deg, #3b82f6, #2563eb); }
		.quick-action-modal-header.addTeacher { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
		.quick-action-modal-header.takeAttendance { background: linear-gradient(135deg, #22c55e, #16a34a); }
		.quick-action-modal-header.scheduleExam { background: linear-gradient(135deg, #f59e0b, #d97706); }
		.quick-action-modal-header.collectFees { background: linear-gradient(135deg, #06b6d4, #0891b2); }
		.quick-action-modal-header.generateReport { background: linear-gradient(135deg, #ef4444, #dc2626); }
		.quick-action-modal-title {
			font-size: 18px;
			font-weight: 700;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.quick-action-close {
			background: rgba(255,255,255,0.2);
			border: none;
			width: 36px;
			height: 36px;
			border-radius: 10px;
			color: white;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.2s;
		}
		.quick-action-close:hover {
			background: rgba(255,255,255,0.3);
			transform: rotate(90deg);
		}
		.quick-action-modal-body {
			padding: 24px;
		}
		.quick-form-group {
			margin-bottom: 18px;
		}
		.quick-form-label {
			display: block;
			margin-bottom: 8px;
			font-size: 13px;
			font-weight: 600;
			color: #475569;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.quick-form-input, .quick-form-select {
			width: 100%;
			height: 48px;
			padding: 0 16px;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			font-size: 15px;
			transition: all 0.2s;
		}
		.quick-form-input:focus, .quick-form-select:focus {
			outline: none;
			border-color: #3b82f6;
			box-shadow: 0 0 0 4px rgba(59,130,246,0.15);
		}
		.quick-form-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 16px;
		}
		.quick-form-footer {
			display: flex;
			justify-content: space-between;
			gap: 12px;
			margin-top: 24px;
			padding-top: 20px;
			border-top: 1px solid #e2e8f0;
		}
		.quick-btn {
			padding: 12px 24px;
			border-radius: 12px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s;
		}
		.quick-btn-cancel {
			background: white;
			border: 2px solid #e2e8f0;
			color: #64748b;
		}
		.quick-btn-cancel:hover {
			background: #f8fafc;
		}
		.quick-btn-primary {
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			border: none;
			color: white;
		}
		.quick-btn-primary:hover {
			box-shadow: 0 6px 20px rgba(59,130,246,0.4);
			transform: translateY(-2px);
		}
		.quick-btn-secondary {
			background: #f1f5f9;
			border: none;
			color: #475569;
		}
		.quick-btn-secondary:hover {
			background: #e2e8f0;
		}

		/* Chart Card Styles - Professional Design */
		.chart-card {
			position: relative;
			transition: all 0.3s ease;
			border: 2px solid transparent;
			overflow: visible;
		}
		.chart-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 15px 40px rgba(0,0,0,0.12);
			border-color: #e2e8f0;
		}
		.chart-card.performance:hover { border-color: #8b5cf6; }
		.chart-card.fees:hover { border-color: #22c55e; }
		
		/* Remove blocking overlay - use subtle indicator instead */
		.chart-overlay {
			display: none;
		}
		
		/* Chart Stats - Editable */
		.chart-stats {
			display: flex;
			justify-content: space-around;
			padding: 16px 20px;
			border-bottom: 1px solid #f1f5f9;
			background: linear-gradient(to bottom, #f8fafc, white);
		}
		.chart-stat {
			text-align: center;
			padding: 8px 16px;
			border-radius: 12px;
			transition: all 0.2s;
			cursor: pointer;
			position: relative;
		}
		.chart-stat:hover {
			background: #eff6ff;
			transform: scale(1.05);
		}
		.chart-stat:hover::after {
			content: '‚úèÔ∏è';
			position: absolute;
			top: 2px;
			right: 2px;
			font-size: 10px;
		}
		.chart-stat-value {
			display: block;
			font-size: 22px;
			font-weight: 800;
			color: #1e293b;
			transition: color 0.2s;
		}
		.chart-stat:hover .chart-stat-value {
			color: #3b82f6;
		}
		.chart-stat-label {
			font-size: 10px;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			font-weight: 600;
		}
		.chart-stat-value.editable {
			background: white;
			border: 2px solid #3b82f6;
			border-radius: 8px;
			padding: 4px 8px;
			outline: none;
			min-width: 60px;
			text-align: center;
		}
		
		/* Chart Action Buttons */
		.chart-btn {
			width: 36px;
			height: 36px;
			border: none;
			background: #f1f5f9;
			border-radius: 8px;
			cursor: pointer;
			color: #64748b;
			transition: all 0.2s;
		}
		.chart-btn:hover {
			background: #3b82f6;
			color: white;
			transform: scale(1.1);
		}
		
		/* Chart Footer */
		.chart-footer {
			padding: 14px 20px;
			border-top: 1px solid #f1f5f9;
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: #fafbfc;
		}
		.chart-footer-btn {
			padding: 10px 20px;
			background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
			border: none;
			border-radius: 10px;
			font-size: 13px;
			font-weight: 600;
			color: #475569;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s;
		}
		.chart-footer-btn:hover {
			background: linear-gradient(135deg, #8b5cf6, #7c3aed);
			color: white;
			transform: translateY(-2px);
		}
		.chart-footer-btn.primary {
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			color: white;
		}
		.chart-footer-btn.green {
			background: linear-gradient(135deg, #22c55e, #16a34a);
			color: white;
		}
		
		/* Chart Expand Button */
		.chart-expand-btn {
			position: absolute;
			top: 12px;
			right: 12px;
			width: 32px;
			height: 32px;
			background: rgba(255,255,255,0.9);
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			cursor: pointer;
			color: #64748b;
			font-size: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			transition: all 0.2s;
			z-index: 5;
		}
		.chart-card:hover .chart-expand-btn {
			opacity: 1;
		}
		.chart-expand-btn:hover {
			background: #3b82f6;
			color: white;
			border-color: #3b82f6;
		}

		/* Chart Detail Modal */
		.chart-detail-modal {
			position: fixed;
			inset: 0;
			background: rgba(15, 23, 42, 0.8);
			backdrop-filter: blur(8px);
			z-index: 9999;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s;
		}
		.chart-detail-modal.show {
			opacity: 1;
			visibility: visible;
		}
		.chart-detail-content {
			background: white;
			border-radius: 24px;
			width: 800px;
			max-width: 95vw;
			max-height: 90vh;
			overflow: hidden;
			transform: scale(0.9);
			transition: transform 0.3s ease;
			box-shadow: 0 30px 100px rgba(0,0,0,0.4);
		}
		.chart-detail-modal.show .chart-detail-content {
			transform: scale(1);
		}
		.chart-detail-header {
			padding: 24px 28px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			color: white;
		}
		.chart-detail-header.performance { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
		.chart-detail-header.fees { background: linear-gradient(135deg, #22c55e, #16a34a); }
		.chart-detail-title {
			font-size: 20px;
			font-weight: 700;
			display: flex;
			align-items: center;
			gap: 12px;
		}
		.chart-detail-close {
			background: rgba(255,255,255,0.2);
			border: none;
			width: 40px;
			height: 40px;
			border-radius: 12px;
			color: white;
			font-size: 18px;
			cursor: pointer;
			transition: all 0.2s;
		}
		.chart-detail-close:hover {
			background: rgba(255,255,255,0.3);
			transform: rotate(90deg);
		}
		.chart-detail-body {
			padding: 28px;
			max-height: 70vh;
			overflow-y: auto;
		}
		.detail-chart-container {
			height: 300px;
			margin-bottom: 24px;
		}
		.detail-stats-row {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 16px;
			margin-bottom: 24px;
		}
		.detail-stat-box {
			background: #f8fafc;
			border-radius: 12px;
			padding: 16px;
			text-align: center;
			border-left: 4px solid #8b5cf6;
		}
		.detail-stat-box.green { border-left-color: #22c55e; }
		.detail-stat-box.orange { border-left-color: #f59e0b; }
		.detail-stat-box.red { border-left-color: #ef4444; }
		.detail-stat-box.blue { border-left-color: #3b82f6; }
		.detail-stat-number {
			font-size: 28px;
			font-weight: 800;
			color: #1e293b;
		}
		.detail-stat-text {
			font-size: 12px;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-top: 4px;
		}
		.detail-table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 20px;
		}
		.detail-table th {
			background: #f8fafc;
			padding: 12px 16px;
			text-align: left;
			font-size: 12px;
			font-weight: 700;
			color: #64748b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.detail-table td {
			padding: 14px 16px;
			border-bottom: 1px solid #f1f5f9;
			font-size: 14px;
		}
		.detail-table tr:hover {
			background: #f8fafc;
		}
		.detail-actions {
			display: flex;
			justify-content: flex-end;
			gap: 12px;
			margin-top: 24px;
			padding-top: 20px;
			border-top: 1px solid #e2e8f0;
		}
		.action-icon {
			width: 56px;
			height: 56px;
			border-radius: 14px;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 12px;
			font-size: 24px;
			color: white;
		}
		.action-title {
			font-weight: 600;
			font-size: 14px;
			color: #334155;
		}
		.recent-section {
			background: white;
			border-radius: 16px;
			padding: 24px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
			margin-top: 24px;
		}
		.section-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}
		.section-title {
			font-size: 18px;
			font-weight: 700;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.view-all-btn {
			padding: 8px 16px;
			background: #f1f5f9;
			border: none;
			border-radius: 8px;
			color: #3b82f6;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s;
		}
		.view-all-btn:hover {
			background: #e2e8f0;
		}
		.recent-list {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}
		.recent-item {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 14px 16px;
			background: #f8fafc;
			border-radius: 10px;
			transition: all 0.2s;
		}
		.recent-item:hover {
			background: #f1f5f9;
		}
		.recent-item-left {
			display: flex;
			align-items: center;
			gap: 14px;
		}
		.recent-avatar {
			width: 44px;
			height: 44px;
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 600;
			font-size: 16px;
			color: white;
		}
		.recent-name {
			font-weight: 600;
			color: #1e293b;
		}
		.recent-detail {
			font-size: 12px;
			color: #64748b;
		}
		.recent-badge {
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 600;
		}
		.recent-badge.new { background: #dcfce7; color: #16a34a; }
		.recent-badge.pending { background: #fef3c7; color: #d97706; }
		
		/* Section Button */
		.section-btn {
			width: 36px;
			height: 36px;
			border: none;
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			border-radius: 10px;
			color: white;
			font-size: 14px;
			cursor: pointer;
			transition: all 0.2s;
		}
		.section-btn:hover {
			transform: scale(1.05);
			box-shadow: 0 4px 12px rgba(59,130,246,0.4);
		}
		
		/* Interactive Recent Item */
		.recent-item {
			cursor: pointer;
			position: relative;
			overflow: hidden;
		}
		.recent-item:hover {
			background: #eff6ff !important;
			transform: translateX(4px);
		}
		.recent-item-actions {
			display: flex;
			gap: 6px;
			opacity: 0;
			transition: opacity 0.2s;
		}
		.recent-item:hover .recent-item-actions {
			opacity: 1;
		}
		.recent-action-btn {
			width: 32px;
			height: 32px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-size: 12px;
			transition: all 0.2s;
		}
		.recent-action-btn.edit {
			background: #eff6ff;
			color: #3b82f6;
		}
		.recent-action-btn.edit:hover {
			background: #3b82f6;
			color: white;
		}
		.recent-action-btn.delete {
			background: #fef2f2;
			color: #ef4444;
		}
		.recent-action-btn.delete:hover {
			background: #ef4444;
			color: white;
		}
		
		/* Edit Modal */
		.edit-modal {
			position: fixed;
			inset: 0;
			background: rgba(15, 23, 42, 0.7);
			backdrop-filter: blur(4px);
			z-index: 9999;
			display: flex;
			align-items: center;
			justify-content: center;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s;
		}
		.edit-modal.show {
			opacity: 1;
			visibility: visible;
		}
		.edit-modal-content {
			background: white;
			border-radius: 20px;
			width: 450px;
			max-width: 95vw;
			overflow: hidden;
			transform: scale(0.9) translateY(20px);
			transition: transform 0.3s ease;
			box-shadow: 0 25px 80px rgba(0,0,0,0.3);
		}
		.edit-modal.show .edit-modal-content {
			transform: scale(1) translateY(0);
		}
		.edit-modal-header {
			padding: 20px 24px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			color: white;
		}
		.edit-modal-header.student { background: linear-gradient(135deg, #3b82f6, #2563eb); }
		.edit-modal-header.exam { background: linear-gradient(135deg, #f59e0b, #d97706); }
		.edit-modal-title {
			font-size: 18px;
			font-weight: 700;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.edit-modal-close {
			background: rgba(255,255,255,0.2);
			border: none;
			width: 36px;
			height: 36px;
			border-radius: 10px;
			color: white;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.2s;
		}
		.edit-modal-close:hover {
			background: rgba(255,255,255,0.3);
			transform: rotate(90deg);
		}
		.edit-modal-body {
			padding: 24px;
		}
		.edit-form-group {
			margin-bottom: 16px;
		}
		.edit-form-label {
			display: block;
			margin-bottom: 8px;
			font-size: 13px;
			font-weight: 600;
			color: #475569;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.edit-form-input, .edit-form-select {
			width: 100%;
			height: 48px;
			padding: 0 16px;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			font-size: 15px;
			transition: all 0.2s;
			box-sizing: border-box;
		}
		.edit-form-input:focus, .edit-form-select:focus {
			outline: none;
			border-color: #3b82f6;
			box-shadow: 0 0 0 4px rgba(59,130,246,0.15);
		}
		.edit-form-row {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 16px;
		}
		.edit-modal-footer {
			padding: 16px 24px;
			background: #f8fafc;
			display: flex;
			justify-content: space-between;
		}
		.edit-btn {
			padding: 12px 20px;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s;
			border: none;
		}
		.edit-btn.cancel {
			background: white;
			border: 2px solid #e2e8f0;
			color: #64748b;
		}
		.edit-btn.cancel:hover { background: #f1f5f9; }
		.edit-btn.save {
			background: linear-gradient(135deg, #22c55e, #16a34a);
			color: white;
		}
		.edit-btn.save:hover {
			box-shadow: 0 4px 12px rgba(34,197,94,0.4);
			transform: translateY(-2px);
		}
		.edit-btn.delete {
			background: #fef2f2;
			color: #ef4444;
		}
		.edit-btn.delete:hover {
			background: #ef4444;
			color: white;
		}
	</style>
</head>
<body>
	<div class="page dashboard-page active">
		<div class="page-title">
			<h1>Dashboard Overview</h1>
			<div class="date-selector" style="display:flex; gap:8px; align-items:center;">
				<select id="dateRange">
					<option value="today">Today</option>
					<option value="week">This Week</option>
					<option value="month" selected>This Month</option>
					<option value="year">This Year</option>
				</select>
			</div>
		</div>

		<!-- Dashboard Filters -->
		<div class="chart-actions" style="margin-bottom: 16px;">
			<select id="filterClass">
				<option value="">All Classes</option>
				<option value="8">Class 8</option>
				<option value="9">Class 9</option>
				<option value="10">Class 10</option>
				<option value="11">Class 11</option>
				<option value="12">Class 12</option>
			</select>
			<select id="filterSection">
				<option value="">All Sections</option>
				<option value="A">Section A</option>
				<option value="B">Section B</option>
				<option value="C">Section C</option>
			</select>
			<button class="btn btn-outline btn-sm" id="resetDashboardFilter"><i class="fas fa-undo"></i> Reset</button>
		</div>

		<!-- Stats Cards -->
		<div class="dashboard">
			<div class="card dashboard-card" data-navigate="students" title="Click to view Students">
				<div class="card-link-hint"><i class="fas fa-external-link-alt"></i></div>
				<div class="card-header">
					<div class="card-title">Total Students</div>
					<div class="card-icon students">
						<i class="fas fa-user-graduate"></i>
					</div>
				</div>
				<div class="card-value" id="studentsValue">0</div>
				<div class="card-footer positive" id="studentsFooter">
					<i class="fas fa-arrow-up"></i> <span id="studentsChange">Loading...</span>
				</div>
			</div>
			<div class="card dashboard-card" data-navigate="teachers" title="Click to view Teachers">
				<div class="card-link-hint"><i class="fas fa-external-link-alt"></i></div>
				<div class="card-header">
					<div class="card-title">Total Teachers</div>
					<div class="card-icon teachers">
						<i class="fas fa-chalkboard-teacher"></i>
					</div>
				</div>
				<div class="card-value" id="teachersValue">0</div>
				<div class="card-footer positive" id="teachersFooter">
					<i class="fas fa-arrow-up"></i> <span id="teachersChange">Loading...</span>
				</div>
			</div>
			<div class="card dashboard-card" data-navigate="fees" title="Click to view Fee Management">
				<div class="card-link-hint"><i class="fas fa-external-link-alt"></i></div>
				<div class="card-header">
					<div class="card-title">Fee Collection</div>
					<div class="card-icon fees">
						<i class="fas fa-money-bill-wave"></i>
					</div>
				</div>
				<div class="card-value" id="feeValue">‚Çπ0</div>
				<div class="card-footer positive" id="feeFooter">
					<i class="fas fa-arrow-up"></i> <span id="feeChange">Loading...</span>
				</div>
			</div>
			<div class="card dashboard-card" data-navigate="attendance" title="Click to view Attendance">
				<div class="card-link-hint"><i class="fas fa-external-link-alt"></i></div>
				<div class="card-header">
					<div class="card-title">Attendance Today</div>
					<div class="card-icon attendance">
						<i class="fas fa-clipboard-check"></i>
					</div>
				</div>
				<div class="card-value" id="attendanceValue">0%</div>
				<div class="card-footer" id="attendanceFooter">
					<i class="fas fa-arrow-down"></i> <span id="attendanceChange">Loading...</span>
				</div>
			</div>
		</div>

		<!-- Quick Actions -->
		<div class="quick-actions-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
			<h3 style="font-size: 16px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 10px;">
				<i class="fas fa-bolt" style="color: #f59e0b;"></i> Quick Actions
			</h3>
			<span style="font-size: 12px; color: #64748b;">Click any card for quick action</span>
		</div>
		<div class="quick-actions">
			<div class="action-card" data-action="addStudent" title="Add New Student">
				<div class="action-badge">New</div>
				<div class="action-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
					<i class="fas fa-user-plus"></i>
				</div>
				<div class="action-title">Add Student</div>
				<div class="action-hint">Quick add a student</div>
			</div>
			<div class="action-card" data-action="addTeacher" title="Add New Teacher">
				<div class="action-badge">New</div>
				<div class="action-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
					<i class="fas fa-chalkboard-teacher"></i>
				</div>
				<div class="action-title">Add Teacher</div>
				<div class="action-hint">Register faculty</div>
			</div>
			<div class="action-card" data-action="takeAttendance" title="Take Attendance">
				<div class="action-icon" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
					<i class="fas fa-clipboard-check"></i>
				</div>
				<div class="action-title">Take Attendance</div>
				<div class="action-hint">Mark today's attendance</div>
			</div>
			<div class="action-card" data-action="scheduleExam" title="Schedule Exam">
				<div class="action-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
					<i class="fas fa-file-alt"></i>
				</div>
				<div class="action-title">Schedule Exam</div>
				<div class="action-hint">Plan new exam</div>
			</div>
			<div class="action-card" data-action="collectFees" title="Collect Fees">
				<div class="action-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
					<i class="fas fa-rupee-sign"></i>
				</div>
				<div class="action-title">Collect Fees</div>
				<div class="action-hint">Record payment</div>
			</div>
			<div class="action-card" data-action="generateReport" title="Generate Report">
				<div class="action-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
					<i class="fas fa-chart-pie"></i>
				</div>
				<div class="action-title">Generate Report</div>
				<div class="action-hint">Export analytics</div>
			</div>
		</div>

		<!-- Quick Action Modal -->
		<div class="quick-action-modal" id="quickActionModal">
			<div class="quick-action-modal-content">
				<div class="quick-action-modal-header" id="quickActionHeader">
					<div class="quick-action-modal-title" id="quickActionTitle">
						<i class="fas fa-plus"></i> Quick Action
					</div>
					<button class="quick-action-close" id="closeQuickAction"><i class="fas fa-times"></i></button>
				</div>
				<div class="quick-action-modal-body" id="quickActionBody">
					<!-- Dynamic form content -->
				</div>
			</div>
		</div>

		<!-- Charts Row -->
		<div class="charts-header" style="display: flex; align-items: center; justify-content: space-between; margin: 24px 0 16px;">
			<h3 style="font-size: 16px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 10px;">
				<i class="fas fa-chart-line" style="color: #8b5cf6;"></i> Analytics & Insights
			</h3>
			<span style="font-size: 12px; color: #64748b;">Click charts for detailed view</span>
		</div>
		<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
			<!-- Student Performance Card -->
			<div class="chart-container chart-card performance" id="performanceChartCard" data-chart="performance">
				<button class="chart-expand-btn" onclick="showChartDetailModal('performance')" title="Expand Details">
					<i class="fas fa-expand-alt"></i>
				</button>
				<div class="chart-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border-radius: 16px 16px 0 0; padding: 18px 20px;">
					<div class="chart-title" style="color: white; font-size: 16px;">
						<i class="fas fa-graduation-cap" style="margin-right: 10px;"></i>Student Performance
					</div>
					<div class="chart-actions" style="display: flex; gap: 8px;">
						<select id="performanceMetric" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 13px; cursor: pointer;">
							<option value="overall" style="color: #1e293b;">Overall</option>
							<option value="subject" style="color: #1e293b;">Subject-wise</option>
							<option value="class" style="color: #1e293b;">Class-wise</option>
					</select>
						<button class="chart-btn" onclick="exportPerformanceChart();" title="Export Data" style="background: rgba(255,255,255,0.2); color: white;">
							<i class="fas fa-download"></i>
						</button>
						<button class="chart-btn" onclick="refreshPerformanceChart();" title="Refresh" style="background: rgba(255,255,255,0.2); color: white;">
							<i class="fas fa-sync-alt"></i>
						</button>
				</div>
			</div>
				<div class="chart-stats">
					<div class="chart-stat" onclick="editChartStat('avgPerformance', 'Avg Score')" title="Click to edit">
						<span class="chart-stat-value" id="avgPerformance" style="color: #8b5cf6;">85%</span>
						<span class="chart-stat-label">Avg Score</span>
					</div>
					<div class="chart-stat" onclick="editChartStat('topPerformers', 'Top Performers')" title="Click to edit">
						<span class="chart-stat-value" id="topPerformers" style="color: #22c55e;">12</span>
						<span class="chart-stat-label">Top Performers</span>
					</div>
					<div class="chart-stat" onclick="editChartStat('needsImprovement', 'Need Support')" title="Click to edit">
						<span class="chart-stat-value" id="needsImprovement" style="color: #f59e0b;">3</span>
						<span class="chart-stat-label">Need Support</span>
					</div>
				</div>
				<div class="chart" style="height: 200px; padding: 16px;" id="performanceChartArea">
				<!-- SVG Line Chart for Performance -->
				<svg viewBox="0 0 400 150" style="width: 100%; height: 100%;">
					<!-- Grid lines -->
					<defs>
						<linearGradient id="perfGradient" x1="0%" y1="0%" x2="0%" y2="100%">
							<stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:0.3"/>
							<stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0"/>
						</linearGradient>
					</defs>
					<g stroke="#e2e8f0" stroke-width="1" fill="none">
						<line x1="40" y1="20" x2="380" y2="20"/>
						<line x1="40" y1="55" x2="380" y2="55"/>
						<line x1="40" y1="90" x2="380" y2="90"/>
						<line x1="40" y1="125" x2="380" y2="125"/>
					</g>
					<!-- Y-axis labels -->
					<g fill="#94a3b8" font-size="10" text-anchor="end">
						<text x="35" y="24">100%</text>
						<text x="35" y="59">75%</text>
						<text x="35" y="94">50%</text>
						<text x="35" y="129">25%</text>
					</g>
					<!-- Area fill -->
					<path d="M60,85 L117,70 L174,78 L231,55 L288,45 L345,35 L345,125 L60,125 Z" fill="url(#perfGradient)"/>
					<!-- Line -->
					<polyline points="60,85 117,70 174,78 231,55 288,45 345,35" fill="none" stroke="#8b5cf6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
					<!-- Data points -->
					<g fill="#8b5cf6">
						<circle cx="60" cy="85" r="5" stroke="white" stroke-width="2"/>
						<circle cx="117" cy="70" r="5" stroke="white" stroke-width="2"/>
						<circle cx="174" cy="78" r="5" stroke="white" stroke-width="2"/>
						<circle cx="231" cy="55" r="5" stroke="white" stroke-width="2"/>
						<circle cx="288" cy="45" r="5" stroke="white" stroke-width="2"/>
						<circle cx="345" cy="35" r="5" stroke="white" stroke-width="2"/>
					</g>
					<!-- X-axis labels -->
					<g fill="#94a3b8" font-size="10" text-anchor="middle">
						<text x="60" y="142">Jan</text>
						<text x="117" y="142">Feb</text>
						<text x="174" y="142">Mar</text>
						<text x="231" y="142">Apr</text>
						<text x="288" y="142">May</text>
						<text x="345" y="142">Jun</text>
					</g>
				</svg>
			</div>
				<div class="chart-footer" style="justify-content: center;">
					<button class="chart-footer-btn" onclick="showChartDetailModal('performance');">
						<i class="fas fa-expand"></i> Details
					</button>
				</div>
		</div>

			<!-- Fee Collection Card -->
			<div class="chart-container chart-card fees" id="feeChartCard" data-chart="fees">
				<button class="chart-expand-btn" onclick="showChartDetailModal('fees')" title="Expand Details">
					<i class="fas fa-expand-alt"></i>
				</button>
				<div class="chart-header" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; border-radius: 16px 16px 0 0; padding: 18px 20px;">
					<div class="chart-title" style="color: white; font-size: 16px;">
						<i class="fas fa-rupee-sign" style="margin-right: 10px;"></i>Fee Collection Trends
					</div>
					<div class="chart-actions" style="display: flex; gap: 8px;">
						<select id="feeMetric" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 12px; border-radius: 8px; font-size: 13px; cursor: pointer;">
							<option value="rate" style="color: #1e293b;">Collection Rate</option>
							<option value="amount" style="color: #1e293b;">Amount Collected</option>
					</select>
						<button class="chart-btn" onclick="exportFeeChart();" title="Export Data" style="background: rgba(255,255,255,0.2); color: white;">
							<i class="fas fa-download"></i>
						</button>
						<button class="chart-btn" onclick="refreshFeeChart();" title="Refresh" style="background: rgba(255,255,255,0.2); color: white;">
							<i class="fas fa-sync-alt"></i>
						</button>
				</div>
			</div>
				<div class="chart-stats">
					<div class="chart-stat" onclick="editChartStat('totalCollection', 'Total Collected')" title="Click to edit">
						<span class="chart-stat-value" id="totalCollection" style="color: #22c55e;">‚Çπ0</span>
						<span class="chart-stat-label">Collected</span>
					</div>
					<div class="chart-stat" onclick="editChartStat('pendingAmount', 'Pending Amount')" title="Click to edit">
						<span class="chart-stat-value" id="pendingAmount" style="color: #ef4444;">‚Çπ0</span>
						<span class="chart-stat-label">Pending</span>
					</div>
					<div class="chart-stat" onclick="editChartStat('collectionRate', 'Collection Rate')" title="Click to edit">
						<span class="chart-stat-value" id="collectionRate" style="color: #3b82f6;">0%</span>
						<span class="chart-stat-label">Rate</span>
					</div>
				</div>
				<div class="chart" style="height: 200px; padding: 16px;" id="feeChartArea">
				<!-- SVG Bar Chart for Fee Collection -->
				<svg viewBox="0 0 400 150" style="width: 100%; height: 100%;">
					<!-- Grid lines -->
					<defs>
						<linearGradient id="feeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
							<stop offset="0%" style="stop-color:#22c55e;stop-opacity:1"/>
							<stop offset="100%" style="stop-color:#16a34a;stop-opacity:0.7"/>
						</linearGradient>
					</defs>
					<g stroke="#e2e8f0" stroke-width="1" fill="none">
						<line x1="40" y1="20" x2="380" y2="20"/>
						<line x1="40" y1="55" x2="380" y2="55"/>
						<line x1="40" y1="90" x2="380" y2="90"/>
						<line x1="40" y1="125" x2="380" y2="125"/>
					</g>
					<!-- Y-axis labels -->
					<g fill="#94a3b8" font-size="10" text-anchor="end">
						<text x="35" y="24">100%</text>
						<text x="35" y="59">75%</text>
						<text x="35" y="94">50%</text>
						<text x="35" y="129">25%</text>
					</g>
					<!-- Bars -->
					<g fill="url(#feeGradient)">
						<rect x="50" y="70" width="35" height="55" rx="4"/>
						<rect x="100" y="55" width="35" height="70" rx="4"/>
						<rect x="150" y="40" width="35" height="85" rx="4"/>
						<rect x="200" y="50" width="35" height="75" rx="4"/>
						<rect x="250" y="30" width="35" height="95" rx="4"/>
						<rect x="300" y="25" width="35" height="100" rx="4"/>
						<rect x="350" y="20" width="35" height="105" rx="4"/>
					</g>
					<!-- Bar value labels -->
					<g fill="#22c55e" font-size="9" font-weight="600" text-anchor="middle">
						<text x="68" y="65">65%</text>
						<text x="118" y="50">72%</text>
						<text x="168" y="35">80%</text>
						<text x="218" y="45">75%</text>
						<text x="268" y="25">88%</text>
						<text x="318" y="20">92%</text>
						<text x="368" y="15">95%</text>
					</g>
					<!-- X-axis labels -->
					<g fill="#94a3b8" font-size="10" text-anchor="middle">
						<text x="68" y="142">Jan</text>
						<text x="118" y="142">Feb</text>
						<text x="168" y="142">Mar</text>
						<text x="218" y="142">Apr</text>
						<text x="268" y="142">May</text>
						<text x="318" y="142">Jun</text>
						<text x="368" y="142">Jul</text>
					</g>
				</svg>
				</div>
				<div class="chart-footer" style="justify-content: center;">
					<button class="chart-footer-btn" onclick="showChartDetailModal('fees');">
						<i class="fas fa-expand"></i> Details
					</button>
				</div>
			</div>
		</div>

		<!-- Chart Detail Modal -->
		<div class="chart-detail-modal" id="chartDetailModal">
			<div class="chart-detail-content">
				<div class="chart-detail-header" id="chartDetailHeader">
					<div class="chart-detail-title" id="chartDetailTitle">
						<i class="fas fa-chart-bar"></i> Chart Details
					</div>
					<button class="chart-detail-close" id="closeChartDetail"><i class="fas fa-times"></i></button>
				</div>
				<div class="chart-detail-body" id="chartDetailBody">
					<!-- Dynamic content -->
				</div>
			</div>
		</div>

		<!-- Detail Modal -->
		<div class="detail-modal" id="detailModal">
			<div class="detail-modal-content">
				<div class="detail-modal-header" id="detailModalHeader">
					<div class="detail-modal-title">
						<i class="fas fa-info-circle"></i>
						<span id="detailModalTitle">Details</span>
					</div>
					<button class="detail-modal-close" id="closeDetailModal"><i class="fas fa-times"></i></button>
				</div>
				<div class="detail-modal-body" id="detailModalBody">
					<!-- Dynamic content here -->
				</div>
				<div class="detail-modal-footer">
					<button class="btn btn-outline" id="closeDetailBtn"><i class="fas fa-times"></i> Close</button>
					<button class="btn btn-primary" id="viewAllDetailBtn"><i class="fas fa-external-link-alt"></i> View All</button>
				</div>
			</div>
		</div>

		<!-- Recent Activity Section -->
		<div class="recent-activity-header" style="display: flex; align-items: center; justify-content: space-between; margin: 24px 0 16px;">
			<h3 style="font-size: 16px; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 10px;">
				<i class="fas fa-clock" style="color: #3b82f6;"></i> Recent Activity
			</h3>
			<span style="font-size: 12px; color: #64748b;">Click to edit ‚Ä¢ Double-click for details</span>
		</div>
		<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
			<div class="recent-section">
				<div class="section-header">
					<div class="section-title"><i class="fas fa-user-graduate" style="color: #3b82f6;"></i> Recent Students</div>
					<button class="section-btn" onclick="addQuickStudent()" title="Add Student"><i class="fas fa-plus"></i></button>
				</div>
				<div class="recent-list" id="recentStudents"></div>
			</div>

			<div class="recent-section">
				<div class="section-header">
					<div class="section-title"><i class="fas fa-calendar-check" style="color: #22c55e;"></i> Upcoming Exams</div>
					<button class="section-btn" onclick="addQuickExam()" title="Add Exam"><i class="fas fa-plus"></i></button>
				</div>
				<div class="recent-list" id="upcomingExams"></div>
			</div>
		</div>

		<!-- Student Edit Modal -->
		<div class="edit-modal" id="studentEditModal">
			<div class="edit-modal-content">
				<div class="edit-modal-header student">
					<div class="edit-modal-title"><i class="fas fa-user-edit"></i> Edit Student</div>
					<button class="edit-modal-close" onclick="closeStudentEditModal()"><i class="fas fa-times"></i></button>
				</div>
				<div class="edit-modal-body">
					<input type="hidden" id="editStudentId">
					<div class="edit-form-group">
						<label class="edit-form-label">Student Name</label>
						<input type="text" class="edit-form-input" id="editStudentName" placeholder="Full Name">
					</div>
					<div class="edit-form-row">
						<div class="edit-form-group">
							<label class="edit-form-label">Class</label>
							<select class="edit-form-select" id="editStudentClass">
								<option value="">Select</option>
								<option value="1">Class 1</option><option value="2">Class 2</option><option value="3">Class 3</option>
								<option value="4">Class 4</option><option value="5">Class 5</option><option value="6">Class 6</option>
								<option value="7">Class 7</option><option value="8">Class 8</option><option value="9">Class 9</option>
								<option value="10">Class 10</option><option value="11">Class 11</option><option value="12">Class 12</option>
							</select>
						</div>
						<div class="edit-form-group">
							<label class="edit-form-label">Section</label>
							<select class="edit-form-select" id="editStudentSection">
								<option value="">Select</option>
								<option value="A">Section A</option>
								<option value="B">Section B</option>
								<option value="C">Section C</option>
							</select>
						</div>
					</div>
					<div class="edit-form-group">
						<label class="edit-form-label">Status</label>
						<select class="edit-form-select" id="editStudentStatus">
							<option value="Active">Active</option>
							<option value="Inactive">Inactive</option>
						</select>
					</div>
				</div>
				<div class="edit-modal-footer">
					<button class="edit-btn delete" onclick="deleteStudent()"><i class="fas fa-trash"></i> Delete</button>
					<div style="display:flex;gap:10px;">
						<button class="edit-btn cancel" onclick="closeStudentEditModal()">Cancel</button>
						<button class="edit-btn save" onclick="saveStudentEdit()"><i class="fas fa-check"></i> Save</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Exam Edit Modal -->
		<div class="edit-modal" id="examEditModal">
			<div class="edit-modal-content">
				<div class="edit-modal-header exam">
					<div class="edit-modal-title"><i class="fas fa-edit"></i> Edit Exam</div>
					<button class="edit-modal-close" onclick="closeExamEditModal()"><i class="fas fa-times"></i></button>
				</div>
				<div class="edit-modal-body">
					<input type="hidden" id="editExamId">
					<div class="edit-form-group">
						<label class="edit-form-label">Exam Name</label>
						<input type="text" class="edit-form-input" id="editExamName" placeholder="Exam Name">
					</div>
					<div class="edit-form-row">
						<div class="edit-form-group">
							<label class="edit-form-label">Subject</label>
							<select class="edit-form-select" id="editExamSubject">
								<option value="">Select</option>
								<option value="Mathematics">Mathematics</option>
								<option value="Science">Science</option>
								<option value="English">English</option>
								<option value="Hindi">Hindi</option>
								<option value="Social Studies">Social Studies</option>
								<option value="physics">Physics</option>
							</select>
						</div>
						<div class="edit-form-group">
							<label class="edit-form-label">Class</label>
							<select class="edit-form-select" id="editExamClass">
								<option value="">Select</option>
								<option value="1">Class 1</option><option value="2">Class 2</option><option value="3">Class 3</option>
								<option value="4">Class 4</option><option value="5">Class 5</option><option value="6">Class 6</option>
								<option value="7">Class 7</option><option value="8">Class 8</option><option value="9">Class 9</option>
								<option value="10">Class 10</option><option value="11">Class 11</option><option value="12">Class 12</option>
							</select>
						</div>
					</div>
					<div class="edit-form-row">
						<div class="edit-form-group">
							<label class="edit-form-label">Date</label>
							<input type="date" class="edit-form-input" id="editExamDate">
						</div>
						<div class="edit-form-group">
							<label class="edit-form-label">Status</label>
							<select class="edit-form-select" id="editExamStatus">
								<option value="Scheduled">Scheduled</option>
								<option value="Completed">Completed</option>
								<option value="Cancelled">Cancelled</option>
							</select>
						</div>
					</div>
				</div>
				<div class="edit-modal-footer">
					<button class="edit-btn delete" onclick="deleteExam()"><i class="fas fa-trash"></i> Delete</button>
					<div style="display:flex;gap:10px;">
						<button class="edit-btn cancel" onclick="closeExamEditModal()">Cancel</button>
						<button class="edit-btn save" onclick="saveExamEdit()"><i class="fas fa-check"></i> Save</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// ==================== TOAST NOTIFICATION ====================
		function notify(msg, type = 'success') {
			document.querySelectorAll('.toast').forEach(t => t.remove());
			const toast = document.createElement('div');
			const bg = type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6';
			toast.style.cssText = `position:fixed;bottom:30px;right:30px;padding:16px 24px;background:${bg};color:white;border-radius:12px;font-weight:600;z-index:10000;display:flex;align-items:center;gap:10px;animation:slideIn 0.4s ease;`;
			toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${msg}`;
			document.body.appendChild(toast);
			if (!document.getElementById('toastStyle')) {
				const s = document.createElement('style');
				s.id = 'toastStyle';
				s.textContent = `@keyframes slideIn{from{transform:translateX(100px);opacity:0}to{transform:translateX(0);opacity:1}}`;
				document.head.appendChild(s);
			}
			setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
		}

		// ==================== DATA LOADERS ====================
		function loadStudents() {
			try { return JSON.parse(localStorage.getItem('edu_students') || '[]'); } catch(e) { return []; }
		}
		function loadTeachers() {
			try { return JSON.parse(localStorage.getItem('edu_teachers') || '[]'); } catch(e) { return []; }
		}
		function loadExams() {
			try { return JSON.parse(localStorage.getItem('edu_exams') || '[]'); } catch(e) { return []; }
		}
		function loadAttendance() {
			try { return JSON.parse(localStorage.getItem('edu_attendance') || '[]'); } catch(e) { return []; }
		}

		// ==================== NAVIGATION ====================
		function navigateTo(page) {
			// Find parent iframe and switch pages
			if (window.parent && window.parent.document) {
				const sidebarItems = window.parent.document.querySelectorAll('.sidebar-menu li[data-page]');
				let found = false;
				sidebarItems.forEach(item => {
					if (item.dataset.page === page) {
						item.click();
						found = true;
					}
				});
				if (!found) {
					console.log('Page not found:', page);
				}
			}
			notify(`Opening ${page.charAt(0).toUpperCase() + page.slice(1)}...`, 'info');
		}

		// Direct navigation functions for buttons
		function goToReports() {
			notify('üìä Opening Reports & Analytics...', 'info');
			if (window.parent && window.parent.document) {
				const sidebarItems = window.parent.document.querySelectorAll('.sidebar-menu li[data-page]');
				sidebarItems.forEach(item => {
					if (item.dataset.page === 'reports') {
						item.click();
					}
				});
			}
		}

		function goToFees() {
			notify('üí∞ Opening Fee Management...', 'info');
			if (window.parent && window.parent.document) {
				const sidebarItems = window.parent.document.querySelectorAll('.sidebar-menu li[data-page]');
				sidebarItems.forEach(item => {
					if (item.dataset.page === 'fees') {
						item.click();
					}
				});
			}
		}

		// ==================== UPDATE STATS ====================
		function updateStats() {
			const students = loadStudents();
			const teachers = loadTeachers();
			const exams = loadExams();
			const attendance = loadAttendance();

			const classFilter = document.getElementById('filterClass').value;
			const sectionFilter = document.getElementById('filterSection').value;
			
			// Filter students
			let filteredStudents = students;
			if (classFilter) filteredStudents = filteredStudents.filter(s => s.class === classFilter);
			if (sectionFilter) filteredStudents = filteredStudents.filter(s => s.section === sectionFilter);

			// Update student count
			document.getElementById('studentsValue').textContent = filteredStudents.length.toLocaleString();
			const activeStudents = filteredStudents.filter(s => s.status === 'Active').length;
			document.getElementById('studentsChange').textContent = `${activeStudents} active students`;

			// Update teacher count
			const filteredTeachers = teachers;
			document.getElementById('teachersValue').textContent = filteredTeachers.length.toLocaleString();
			document.getElementById('teachersChange').textContent = `${filteredTeachers.filter(t => t.status === 'Active').length} active`;

			// Fee calculation
			const totalFee = filteredStudents.length * 25000;
			const collectedFee = Math.round(totalFee * 0.85);
			document.getElementById('feeValue').textContent = '‚Çπ' + collectedFee.toLocaleString('en-IN');
			document.getElementById('feeChange').textContent = '85% collected';

			// Attendance rate
			let attendanceRate = 94;
			if (attendance.length > 0) {
				let present = 0, total = 0;
				attendance.forEach(a => {
					if (a.records) {
						Object.values(a.records).forEach(status => {
							total++;
							if (status === 'P') present++;
						});
					}
				});
				if (total > 0) attendanceRate = Math.round((present / total) * 100);
			}
			document.getElementById('attendanceValue').textContent = attendanceRate + '%';
			const attendanceFooter = document.getElementById('attendanceFooter');
			if (attendanceRate >= 90) {
				attendanceFooter.className = 'card-footer positive';
				document.getElementById('attendanceChange').textContent = 'Good attendance!';
			} else {
				attendanceFooter.className = 'card-footer negative';
				document.getElementById('attendanceChange').textContent = 'Needs improvement';
			}
		}

		// ==================== RECENT STUDENTS ====================
		function renderRecentStudents() {
			const students = loadStudents().slice(0, 5);
			const container = document.getElementById('recentStudents');

			if (students.length === 0) {
				container.innerHTML = '<div style="text-align: center; padding: 30px; color: #94a3b8;"><i class="fas fa-user-graduate" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>No students yet<br><button onclick="addQuickStudent()" style="margin-top:12px;padding:10px 20px;background:#3b82f6;color:white;border:none;border-radius:10px;cursor:pointer;font-weight:600;">+ Add Student</button></div>';
				return;
			}

			let html = '';
			students.forEach(function(s) {
				const initials = s.name.split(' ').map(function(n) { return n[0]; }).join('').substring(0, 2).toUpperCase();
				const colors = ['#3b82f6', '#8b5cf6', '#22c55e', '#f59e0b', '#ef4444'];
				const color = colors[Math.abs(s.name.charCodeAt(0)) % colors.length];
				const statusClass = s.status === 'Active' ? 'new' : 'pending';
				html += '<div class="recent-item" onclick="editStudent(\'' + s.id + '\')" title="Click to edit">';
				html += '<div class="recent-item-left">';
				html += '<div class="recent-avatar" style="background: ' + color + ';">' + initials + '</div>';
				html += '<div>';
				html += '<div class="recent-name">' + s.name + '</div>';
				html += '<div class="recent-detail">Class ' + s.class + ' - ' + s.section + '</div>';
				html += '</div>';
				html += '</div>';
				html += '<div style="display:flex;align-items:center;gap:10px;">';
				html += '<span class="recent-badge ' + statusClass + '">' + (s.status || 'Active') + '</span>';
				html += '<div class="recent-item-actions">';
				html += '<button class="recent-action-btn edit" onclick="event.stopPropagation(); editStudent(\'' + s.id + '\');" title="Edit"><i class="fas fa-pen"></i></button>';
				html += '<button class="recent-action-btn delete" onclick="event.stopPropagation(); quickDeleteStudent(\'' + s.id + '\');" title="Delete"><i class="fas fa-trash"></i></button>';
				html += '</div>';
				html += '</div>';
				html += '</div>';
			});
			container.innerHTML = html;
		}

		// ==================== UPCOMING EXAMS ====================
		function renderUpcomingExams() {
			const exams = loadExams().filter(function(e) { return e.status === 'Scheduled'; }).slice(0, 5);
			const container = document.getElementById('upcomingExams');

			if (exams.length === 0) {
				container.innerHTML = '<div style="text-align: center; padding: 30px; color: #94a3b8;"><i class="fas fa-file-alt" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>No upcoming exams<br><button onclick="addQuickExam()" style="margin-top:12px;padding:10px 20px;background:#f59e0b;color:white;border:none;border-radius:10px;cursor:pointer;font-weight:600;">+ Schedule Exam</button></div>';
				return;
			}

			let html = '';
			exams.forEach(function(e) {
				html += '<div class="recent-item" onclick="editExam(\'' + e.id + '\')" title="Click to edit">';
				html += '<div class="recent-item-left">';
				html += '<div class="recent-avatar" style="background: linear-gradient(135deg, #f59e0b, #d97706);"><i class="fas fa-file-alt"></i></div>';
				html += '<div>';
				html += '<div class="recent-name">' + e.name + '</div>';
				html += '<div class="recent-detail">' + e.subject + ' - Class ' + e.class + '</div>';
				html += '</div>';
				html += '</div>';
				html += '<div style="display:flex;align-items:center;gap:10px;">';
				html += '<span class="recent-badge pending">' + e.date + '</span>';
				html += '<div class="recent-item-actions">';
				html += '<button class="recent-action-btn edit" onclick="event.stopPropagation(); editExam(\'' + e.id + '\');" title="Edit"><i class="fas fa-pen"></i></button>';
				html += '<button class="recent-action-btn delete" onclick="event.stopPropagation(); quickDeleteExam(\'' + e.id + '\');" title="Delete"><i class="fas fa-trash"></i></button>';
				html += '</div>';
				html += '</div>';
				html += '</div>';
			});
			container.innerHTML = html;
		}

		// ==================== RENDER CHARTS ====================
		function renderCharts() {
			const students = loadStudents();
			const metric = document.getElementById('performanceMetric').value;

			// Performance Chart
			const perfCtx = document.getElementById('performanceChart');
			if (window.performanceChart) window.performanceChart.destroy();

			let labels, data, chartType = 'bar';
				if (metric === 'Subject-wise') {
				labels = ['Math', 'Science', 'English', 'Physics', 'Chemistry'];
				data = [85, 78, 82, 75, 80];
				} else if (metric === 'Class-wise') {
					labels = ['Class 8', 'Class 9', 'Class 10', 'Class 11', 'Class 12'];
				data = [74, 79, 81, 77, 83];
				} else {
				labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
				data = [72, 78, 75, 82, 85, 88];
				chartType = 'line';
				}
				
				window.performanceChart = new Chart(perfCtx, {
					type: chartType,
				data: {
					labels,
					datasets: [{
						label: 'Performance %',
						data,
						backgroundColor: chartType === 'line' ? 'rgba(59, 130, 246, 0.1)' : 'rgba(59, 130, 246, 0.7)',
						borderColor: '#3b82f6',
						borderWidth: 2,
						borderRadius: 8,
						fill: chartType === 'line',
						tension: 0.4
					}]
				},
					options: {
						responsive: true,
					maintainAspectRatio: false,
					plugins: { legend: { display: false } },
					scales: { y: { beginAtZero: true, max: 100 } }
				}
			});

			// Fee Chart
			const feeCtx = document.getElementById('feeChart');
			if (window.feeChart) window.feeChart.destroy();

			const feeMetric = document.getElementById('feeMetric').value;
			const feeLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
			let feeData, feeLabel;

			if (feeMetric === 'Amount Collected') {
				feeData = [250000, 320000, 450000, 380000, 520000, 580000];
				feeLabel = 'Amount (‚Çπ)';
			} else {
				feeData = [65, 72, 85, 78, 88, 92];
				feeLabel = 'Collection Rate %';
			}

			window.feeChart = new Chart(feeCtx, {
				type: 'bar',
				data: {
					labels: feeLabels,
					datasets: [{
						label: feeLabel,
						data: feeData,
						backgroundColor: 'rgba(34, 197, 94, 0.7)',
						borderColor: '#22c55e',
						borderWidth: 2,
						borderRadius: 8
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: { legend: { display: false } },
					scales: { y: { beginAtZero: true } }
				}
			});
		}

		// ==================== DETAIL MODAL FUNCTIONS ====================
		
		const detailModal = document.getElementById('detailModal');
		const detailModalHeader = document.getElementById('detailModalHeader');
		const detailModalTitle = document.getElementById('detailModalTitle');
		const detailModalBody = document.getElementById('detailModalBody');
		let currentDetailPage = '';

		function showDetailModal(type) {
			currentDetailPage = type;
			detailModalHeader.className = 'detail-modal-header ' + type;
			
			switch(type) {
				case 'students':
					detailModalTitle.innerHTML = '<i class="fas fa-user-graduate"></i> Students Overview';
					detailModalBody.innerHTML = generateStudentsDetail();
					break;
				case 'teachers':
					detailModalTitle.innerHTML = '<i class="fas fa-chalkboard-teacher"></i> Teachers Overview';
					detailModalBody.innerHTML = generateTeachersDetail();
					break;
				case 'fees':
					detailModalTitle.innerHTML = '<i class="fas fa-money-bill-wave"></i> Fee Collection Details';
					detailModalBody.innerHTML = generateFeesDetail();
					break;
				case 'attendance':
					detailModalTitle.innerHTML = '<i class="fas fa-clipboard-check"></i> Attendance Summary';
					detailModalBody.innerHTML = generateAttendanceDetail();
					break;
			}
			
			detailModal.classList.add('show');
		}

		function closeDetailModal() {
			detailModal.classList.remove('show');
		}

		function generateStudentsDetail() {
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const active = students.filter(s => s.status === 'Active').length;
			const inactive = students.length - active;
			const male = students.filter(s => s.gender === 'Male').length;
			const female = students.length - male;
			
			const recentStudents = students.slice(0, 5);
			
			return `
				<div class="detail-stats-grid">
					<div class="detail-stat-card" style="border-left: 4px solid #3b82f6;">
						<div class="detail-stat-value">${students.length}</div>
						<div class="detail-stat-label">Total Students</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #22c55e;">
						<div class="detail-stat-value">${active}</div>
						<div class="detail-stat-label">Active</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #3b82f6;">
						<div class="detail-stat-value">${male}</div>
						<div class="detail-stat-label">Male</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #ec4899;">
						<div class="detail-stat-value">${female}</div>
						<div class="detail-stat-label">Female</div>
					</div>
				</div>
				<h4 style="margin-bottom: 12px; color: #1e293b; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">Recent Students</h4>
				<div class="detail-list">
					${recentStudents.map(s => `
						<div class="detail-list-item">
							<div class="detail-avatar" style="background: linear-gradient(135deg, ${s.gender === 'Female' ? '#ec4899, #db2777' : '#3b82f6, #2563eb'});">
								${s.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}
							</div>
							<div class="detail-item-info">
								<div class="detail-item-name">${s.name}</div>
								<div class="detail-item-sub">Class ${s.class} - ${s.section} | ${s.id}</div>
							</div>
							<span class="detail-item-badge ${s.status === 'Active' ? 'badge-active' : 'badge-inactive'}">${s.status}</span>
						</div>
					`).join('') || '<div style="text-align:center;color:#94a3b8;padding:20px;">No students found</div>'}
				</div>
			`;
		}

		function generateTeachersDetail() {
			const teachers = JSON.parse(localStorage.getItem('edu_teachers') || '[]');
			const active = teachers.filter(t => t.status === 'Active').length;
			const subjects = [...new Set(teachers.map(t => t.subject))];
			const avgExp = teachers.length ? Math.round(teachers.reduce((a, t) => a + (parseInt(t.experience) || 0), 0) / teachers.length) : 0;
			
			return `
				<div class="detail-stats-grid">
					<div class="detail-stat-card" style="border-left: 4px solid #8b5cf6;">
						<div class="detail-stat-value">${teachers.length}</div>
						<div class="detail-stat-label">Total Teachers</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #22c55e;">
						<div class="detail-stat-value">${active}</div>
						<div class="detail-stat-label">Active</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #f59e0b;">
						<div class="detail-stat-value">${subjects.length}</div>
						<div class="detail-stat-label">Subjects</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #06b6d4;">
						<div class="detail-stat-value">${avgExp} yrs</div>
						<div class="detail-stat-label">Avg Experience</div>
					</div>
				</div>
				<h4 style="margin-bottom: 12px; color: #1e293b; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">Faculty Members</h4>
				<div class="detail-list">
					${teachers.slice(0, 5).map(t => `
						<div class="detail-list-item">
							<div class="detail-avatar" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
								${t.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}
							</div>
							<div class="detail-item-info">
								<div class="detail-item-name">${t.name}</div>
								<div class="detail-item-sub">${t.subject} | ${t.experience || 0} yrs exp</div>
							</div>
							<span class="detail-item-badge ${t.status === 'Active' ? 'badge-active' : 'badge-inactive'}">${t.status}</span>
						</div>
					`).join('') || '<div style="text-align:center;color:#94a3b8;padding:20px;">No teachers found</div>'}
				</div>
			`;
		}

		function generateFeesDetail() {
			const fees = JSON.parse(localStorage.getItem('edu_fees') || '[]');
			const totalAmount = fees.reduce((sum, f) => sum + (f.total || 0), 0);
			const collected = fees.reduce((sum, f) => sum + (f.paid || 0), 0);
			const pending = totalAmount - collected;
			const paidCount = fees.filter(f => f.status === 'paid').length;
			const pendingCount = fees.length - paidCount;
			
			return `
				<div class="detail-stats-grid">
					<div class="detail-stat-card" style="border-left: 4px solid #f59e0b;">
						<div class="detail-stat-value">‚Çπ${totalAmount.toLocaleString('en-IN')}</div>
						<div class="detail-stat-label">Total Fees</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #22c55e;">
						<div class="detail-stat-value">‚Çπ${collected.toLocaleString('en-IN')}</div>
						<div class="detail-stat-label">Collected</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #ef4444;">
						<div class="detail-stat-value">‚Çπ${pending.toLocaleString('en-IN')}</div>
						<div class="detail-stat-label">Pending</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #3b82f6;">
						<div class="detail-stat-value">${totalAmount > 0 ? Math.round((collected/totalAmount)*100) : 0}%</div>
						<div class="detail-stat-label">Collection Rate</div>
					</div>
				</div>
				<h4 style="margin-bottom: 12px; color: #1e293b; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">Recent Transactions</h4>
				<div class="detail-list">
					${fees.slice(0, 5).map(f => `
						<div class="detail-list-item">
							<div class="detail-avatar" style="background: linear-gradient(135deg, ${f.status === 'paid' ? '#22c55e, #16a34a' : '#f59e0b, #d97706'});">
								${f.name ? f.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase() : '??'}
							</div>
							<div class="detail-item-info">
								<div class="detail-item-name">${f.name || 'Unknown'}</div>
								<div class="detail-item-sub">Class ${f.class || '-'} | ‚Çπ${(f.paid || 0).toLocaleString('en-IN')} / ‚Çπ${(f.total || 0).toLocaleString('en-IN')}</div>
							</div>
							<span class="detail-item-badge ${f.status === 'paid' ? 'badge-paid' : 'badge-pending'}">${f.status === 'paid' ? 'Paid' : 'Pending'}</span>
						</div>
					`).join('') || '<div style="text-align:center;color:#94a3b8;padding:20px;">No fee records found</div>'}
				</div>
			`;
		}

		function generateAttendanceDetail() {
			const attendance = JSON.parse(localStorage.getItem('edu_attendance') || '[]');
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const today = new Date().toISOString().split('T')[0];
			const todayAttendance = attendance.find(a => a.date === today) || { records: {} };
			
			const totalStudents = students.length;
			const presentCount = Object.values(todayAttendance.records || {}).filter(s => s === 'P').length;
			const absentCount = Object.values(todayAttendance.records || {}).filter(s => s === 'A').length;
			const lateCount = Object.values(todayAttendance.records || {}).filter(s => s === 'L').length;
			const percentage = totalStudents > 0 ? Math.round((presentCount / totalStudents) * 100) : 0;
			
			// Get recent attendance records
			const recentRecords = [];
			if (todayAttendance.records) {
				Object.entries(todayAttendance.records).slice(0, 5).forEach(([id, status]) => {
					const student = students.find(s => s.id === id);
					if (student) {
						recentRecords.push({ ...student, attendanceStatus: status });
				}
			});
		}

			return `
				<div class="detail-stats-grid">
					<div class="detail-stat-card" style="border-left: 4px solid #22c55e;">
						<div class="detail-stat-value">${percentage}%</div>
						<div class="detail-stat-label">Today's Rate</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #3b82f6;">
						<div class="detail-stat-value">${presentCount}</div>
						<div class="detail-stat-label">Present</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #ef4444;">
						<div class="detail-stat-value">${absentCount}</div>
						<div class="detail-stat-label">Absent</div>
					</div>
					<div class="detail-stat-card" style="border-left: 4px solid #f59e0b;">
						<div class="detail-stat-value">${lateCount}</div>
						<div class="detail-stat-label">Late</div>
					</div>
				</div>
				<h4 style="margin-bottom: 12px; color: #1e293b; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">Today's Attendance</h4>
				<div class="detail-list">
					${recentRecords.length > 0 ? recentRecords.map(s => `
						<div class="detail-list-item">
							<div class="detail-avatar" style="background: linear-gradient(135deg, ${s.attendanceStatus === 'P' ? '#22c55e, #16a34a' : s.attendanceStatus === 'A' ? '#ef4444, #dc2626' : '#f59e0b, #d97706'});">
								${s.attendanceStatus}
							</div>
							<div class="detail-item-info">
								<div class="detail-item-name">${s.name}</div>
								<div class="detail-item-sub">Class ${s.class} - ${s.section}</div>
							</div>
							<span class="detail-item-badge ${s.attendanceStatus === 'P' ? 'badge-present' : 'badge-absent'}">${s.attendanceStatus === 'P' ? 'Present' : s.attendanceStatus === 'A' ? 'Absent' : 'Late'}</span>
						</div>
					`).join('') : '<div style="text-align:center;color:#94a3b8;padding:20px;">No attendance marked today. Go to Attendance page to mark.</div>'}
				</div>
			`;
		}

		// ==================== EVENT LISTENERS ====================

		// Stats Cards - Show Detail Modal
		document.querySelectorAll('.dashboard-card').forEach(card => {
			card.addEventListener('click', () => {
				const page = card.dataset.navigate;
				showDetailModal(page);
			});
		});

		// Detail Modal Close
		document.getElementById('closeDetailModal').addEventListener('click', closeDetailModal);
		document.getElementById('closeDetailBtn').addEventListener('click', closeDetailModal);
		document.getElementById('viewAllDetailBtn').addEventListener('click', () => {
			closeDetailModal();
			navigateTo(currentDetailPage);
		});
		detailModal.addEventListener('click', (e) => {
			if (e.target === detailModal) closeDetailModal();
		});

		// Quick Action Modal Functions
		const quickActionModal = document.getElementById('quickActionModal');
		const quickActionHeader = document.getElementById('quickActionHeader');
		const quickActionTitle = document.getElementById('quickActionTitle');
		const quickActionBody = document.getElementById('quickActionBody');
		let currentQuickAction = '';

		function showQuickActionModal(action) {
			currentQuickAction = action;
			quickActionHeader.className = 'quick-action-modal-header ' + action;
			
			const icons = {
				addStudent: 'fa-user-plus',
				addTeacher: 'fa-chalkboard-teacher',
				takeAttendance: 'fa-clipboard-check',
				scheduleExam: 'fa-file-alt',
				collectFees: 'fa-rupee-sign',
				generateReport: 'fa-chart-pie'
			};
			
			const titles = {
				addStudent: 'Quick Add Student',
				addTeacher: 'Quick Add Teacher',
				takeAttendance: 'Take Attendance',
				scheduleExam: 'Schedule Exam',
				collectFees: 'Collect Fees',
				generateReport: 'Generate Report'
			};
			
			quickActionTitle.innerHTML = `<i class="fas ${icons[action]}"></i> ${titles[action]}`;
			quickActionBody.innerHTML = generateQuickActionForm(action);
			quickActionModal.classList.add('show');
		}

		function closeQuickActionModal() {
			quickActionModal.classList.remove('show');
		}

		function generateQuickActionForm(action) {
			switch(action) {
				case 'addStudent':
					return `
						<div class="quick-form-group">
							<label class="quick-form-label">Student Name *</label>
							<input type="text" class="quick-form-input" id="quickStudentName" placeholder="Enter full name">
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Class *</label>
								<select class="quick-form-select" id="quickStudentClass">
									<option value="">Select Class</option>
									${[1,2,3,4,5,6,7,8,9,10,11,12].map(c => `<option value="${c}">Class ${c}</option>`).join('')}
								</select>
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Section *</label>
								<select class="quick-form-select" id="quickStudentSection">
									<option value="">Select Section</option>
									<option value="A">Section A</option>
									<option value="B">Section B</option>
									<option value="C">Section C</option>
								</select>
							</div>
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Gender</label>
								<select class="quick-form-select" id="quickStudentGender">
									<option value="Male">Male</option>
									<option value="Female">Female</option>
								</select>
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Parent Name</label>
								<input type="text" class="quick-form-input" id="quickStudentParent" placeholder="Parent/Guardian">
							</div>
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-secondary" onclick="closeQuickActionModal(); navigateTo('students');">
								<i class="fas fa-external-link-alt"></i> Full Form
							</button>
							<div style="display:flex;gap:12px;">
								<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
								<button class="quick-btn quick-btn-primary" onclick="quickAddStudent()">
									<i class="fas fa-plus"></i> Add Student
								</button>
							</div>
						</div>
					`;
				case 'addTeacher':
					return `
						<div class="quick-form-group">
							<label class="quick-form-label">Teacher Name *</label>
							<input type="text" class="quick-form-input" id="quickTeacherName" placeholder="Enter full name">
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Subject *</label>
								<select class="quick-form-select" id="quickTeacherSubject">
									<option value="">Select Subject</option>
									<option value="Mathematics">Mathematics</option>
									<option value="Science">Science</option>
									<option value="English">English</option>
									<option value="Hindi">Hindi</option>
									<option value="Social Studies">Social Studies</option>
									<option value="Computer Science">Computer Science</option>
								</select>
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Experience (Years)</label>
								<input type="number" class="quick-form-input" id="quickTeacherExp" placeholder="0" min="0">
							</div>
						</div>
						<div class="quick-form-group">
							<label class="quick-form-label">Email</label>
							<input type="email" class="quick-form-input" id="quickTeacherEmail" placeholder="email@school.edu">
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-secondary" onclick="closeQuickActionModal(); navigateTo('teachers');">
								<i class="fas fa-external-link-alt"></i> Full Form
							</button>
							<div style="display:flex;gap:12px;">
								<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
								<button class="quick-btn quick-btn-primary" onclick="quickAddTeacher()">
									<i class="fas fa-plus"></i> Add Teacher
								</button>
							</div>
						</div>
					`;
				case 'takeAttendance':
					return `
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Date *</label>
								<input type="date" class="quick-form-input" id="quickAttendanceDate" value="${new Date().toISOString().split('T')[0]}">
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Class *</label>
								<select class="quick-form-select" id="quickAttendanceClass">
									<option value="">Select Class</option>
									${[1,2,3,4,5,6,7,8,9,10,11,12].map(c => `<option value="${c}">Class ${c}</option>`).join('')}
								</select>
							</div>
						</div>
						<div class="quick-form-group">
							<label class="quick-form-label">Section *</label>
							<select class="quick-form-select" id="quickAttendanceSection">
								<option value="">Select Section</option>
								<option value="A">Section A</option>
								<option value="B">Section B</option>
								<option value="C">Section C</option>
							</select>
						</div>
						<div style="background:#f8fafc;border-radius:12px;padding:16px;margin-top:16px;">
							<div style="display:flex;align-items:center;gap:10px;color:#64748b;font-size:14px;">
								<i class="fas fa-info-circle" style="color:#3b82f6;"></i>
								<span>Select class and section to mark attendance on the Attendance page.</span>
							</div>
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
							<button class="quick-btn quick-btn-primary" onclick="goToAttendance()">
								<i class="fas fa-arrow-right"></i> Go to Attendance
							</button>
						</div>
					`;
				case 'scheduleExam':
					return `
						<div class="quick-form-group">
							<label class="quick-form-label">Exam Name *</label>
							<input type="text" class="quick-form-input" id="quickExamName" placeholder="e.g., Mid-Term Exam 2024">
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Subject *</label>
								<select class="quick-form-select" id="quickExamSubject">
									<option value="">Select Subject</option>
									<option value="Mathematics">Mathematics</option>
									<option value="Science">Science</option>
									<option value="English">English</option>
									<option value="Hindi">Hindi</option>
								</select>
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Class *</label>
								<select class="quick-form-select" id="quickExamClass">
									<option value="">Select Class</option>
									${[1,2,3,4,5,6,7,8,9,10,11,12].map(c => `<option value="${c}">Class ${c}</option>`).join('')}
								</select>
							</div>
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Date *</label>
								<input type="date" class="quick-form-input" id="quickExamDate">
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Max Marks</label>
								<input type="number" class="quick-form-input" id="quickExamMarks" placeholder="100" value="100">
							</div>
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-secondary" onclick="closeQuickActionModal(); navigateTo('exams');">
								<i class="fas fa-external-link-alt"></i> Full Form
							</button>
							<div style="display:flex;gap:12px;">
								<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
								<button class="quick-btn quick-btn-primary" onclick="quickScheduleExam()">
									<i class="fas fa-plus"></i> Schedule Exam
								</button>
							</div>
						</div>
					`;
				case 'collectFees':
					const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
					return `
						<div class="quick-form-group">
							<label class="quick-form-label">Select Student *</label>
							<select class="quick-form-select" id="quickFeeStudent">
								<option value="">Choose a student...</option>
								${students.map(s => `<option value="${s.id}">${s.name} (Class ${s.class})</option>`).join('')}
							</select>
						</div>
						<div class="quick-form-row">
							<div class="quick-form-group">
								<label class="quick-form-label">Fee Amount *</label>
								<input type="number" class="quick-form-input" id="quickFeeAmount" placeholder="‚Çπ0">
							</div>
							<div class="quick-form-group">
								<label class="quick-form-label">Payment Mode</label>
								<select class="quick-form-select" id="quickFeeMode">
									<option value="cash">üíµ Cash</option>
									<option value="card">üí≥ Card</option>
									<option value="upi">üì± UPI</option>
									<option value="bank">üè¶ Bank Transfer</option>
								</select>
							</div>
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-secondary" onclick="closeQuickActionModal(); navigateTo('fees');">
								<i class="fas fa-external-link-alt"></i> Full Form
							</button>
							<div style="display:flex;gap:12px;">
								<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
								<button class="quick-btn quick-btn-primary" onclick="quickCollectFee()">
									<i class="fas fa-check"></i> Collect Fee
								</button>
							</div>
						</div>
					`;
				case 'generateReport':
					return `
						<div class="quick-form-group">
							<label class="quick-form-label">Report Type *</label>
							<select class="quick-form-select" id="quickReportType">
								<option value="">Select Report Type</option>
								<option value="students">üìö Student Report</option>
								<option value="teachers">üë®‚Äçüè´ Teacher Report</option>
								<option value="attendance">üìã Attendance Report</option>
								<option value="fees">üí∞ Fee Collection Report</option>
								<option value="exams">üìù Exam Results Report</option>
								<option value="complete">üìä Complete Summary</option>
							</select>
						</div>
						<div style="background:#f8fafc;border-radius:12px;padding:16px;margin-top:16px;">
							<h4 style="font-size:14px;font-weight:600;color:#1e293b;margin-bottom:12px;">Quick Export Options</h4>
							<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
								<button class="quick-btn quick-btn-secondary" onclick="quickExport('students')" style="justify-content:center;">
									<i class="fas fa-user-graduate"></i> Students
								</button>
								<button class="quick-btn quick-btn-secondary" onclick="quickExport('teachers')" style="justify-content:center;">
									<i class="fas fa-chalkboard-teacher"></i> Teachers
								</button>
								<button class="quick-btn quick-btn-secondary" onclick="quickExport('fees')" style="justify-content:center;">
									<i class="fas fa-rupee-sign"></i> Fees
								</button>
								<button class="quick-btn quick-btn-secondary" onclick="quickExport('attendance')" style="justify-content:center;">
									<i class="fas fa-clipboard-check"></i> Attendance
								</button>
							</div>
						</div>
						<div class="quick-form-footer">
							<button class="quick-btn quick-btn-cancel" onclick="closeQuickActionModal()">Cancel</button>
							<button class="quick-btn quick-btn-primary" onclick="closeQuickActionModal(); navigateTo('reports');">
								<i class="fas fa-chart-bar"></i> View All Reports
							</button>
						</div>
					`;
				default:
					return '<p>Action not configured</p>';
			}
		}

		// Quick Action Submit Functions
		function quickAddStudent() {
			const name = document.getElementById('quickStudentName').value.trim();
			const cls = document.getElementById('quickStudentClass').value;
			const section = document.getElementById('quickStudentSection').value;
			const gender = document.getElementById('quickStudentGender').value;
			const parent = document.getElementById('quickStudentParent').value.trim();
			
			if (!name || !cls || !section) {
				notify('Please fill all required fields', 'error');
				return;
			}
			
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const newId = 'STU-' + new Date().getFullYear() + '-' + String(students.length + 1).padStart(3, '0');
			students.unshift({ id: newId, name, gender, class: cls, section, parent, address: '', dob: '', status: 'Active', photo: '' });
			localStorage.setItem('edu_students', JSON.stringify(students));
			
			closeQuickActionModal();
			notify(`‚úÖ Student "${name}" added successfully!`, 'success');
			updateStats();
		}

		function quickAddTeacher() {
			const name = document.getElementById('quickTeacherName').value.trim();
			const subject = document.getElementById('quickTeacherSubject').value;
			const experience = document.getElementById('quickTeacherExp').value || 0;
			const email = document.getElementById('quickTeacherEmail').value.trim();
			
			if (!name || !subject) {
				notify('Please fill all required fields', 'error');
				return;
			}
			
			const teachers = JSON.parse(localStorage.getItem('edu_teachers') || '[]');
			const newId = 'TCH' + String(teachers.length + 1).padStart(3, '0');
			teachers.unshift({ id: newId, name, gender: 'Male', subject, email, phone: '', experience: parseInt(experience), status: 'Active', photo: '' });
			localStorage.setItem('edu_teachers', JSON.stringify(teachers));
			
			closeQuickActionModal();
			notify(`‚úÖ Teacher "${name}" added successfully!`, 'success');
			updateStats();
		}

		function goToAttendance() {
			closeQuickActionModal();
			navigateTo('attendance');
		}

		function quickScheduleExam() {
			const name = document.getElementById('quickExamName').value.trim();
			const subject = document.getElementById('quickExamSubject').value;
			const cls = document.getElementById('quickExamClass').value;
			const date = document.getElementById('quickExamDate').value;
			const marks = document.getElementById('quickExamMarks').value || 100;
			
			if (!name || !subject || !cls || !date) {
				notify('Please fill all required fields', 'error');
				return;
			}
			
			const exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			const newId = 'EXM' + String(exams.length + 1).padStart(3, '0');
			exams.unshift({ id: newId, name, subject, class: cls, date, time: '09:00', duration: 180, max: parseInt(marks), status: 'Scheduled' });
			localStorage.setItem('edu_exams', JSON.stringify(exams));
			
			closeQuickActionModal();
			notify(`‚úÖ Exam "${name}" scheduled successfully!`, 'success');
		}

		function quickCollectFee() {
			const studentId = document.getElementById('quickFeeStudent').value;
			const amount = document.getElementById('quickFeeAmount').value;
			
			if (!studentId || !amount) {
				notify('Please select student and enter amount', 'error');
				return;
			}
			
			const fees = JSON.parse(localStorage.getItem('edu_fees') || '[]');
			const feeIdx = fees.findIndex(f => f.studentId === studentId);
			
			if (feeIdx >= 0) {
				fees[feeIdx].paid = (fees[feeIdx].paid || 0) + parseInt(amount);
				if (fees[feeIdx].paid >= fees[feeIdx].total) {
					fees[feeIdx].status = 'paid';
				} else {
					fees[feeIdx].status = 'partial';
				}
				fees[feeIdx].lastPayment = new Date().toISOString().split('T')[0];
				localStorage.setItem('edu_fees', JSON.stringify(fees));
				notify(`‚úÖ ‚Çπ${parseInt(amount).toLocaleString('en-IN')} collected successfully!`, 'success');
			} else {
				notify('Fee record not found. Creating new record...', 'info');
				const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
				const student = students.find(s => s.id === studentId);
				if (student) {
					fees.push({
						id: 'FEE' + String(fees.length + 1).padStart(3, '0'),
						studentId: student.id,
						name: student.name,
						class: student.class,
						section: student.section,
						total: parseInt(amount),
						paid: parseInt(amount),
						dueDate: new Date().toISOString().split('T')[0],
						status: 'paid',
						lastPayment: new Date().toISOString().split('T')[0]
					});
					localStorage.setItem('edu_fees', JSON.stringify(fees));
					notify(`‚úÖ ‚Çπ${parseInt(amount).toLocaleString('en-IN')} collected!`, 'success');
				}
			}
			
			closeQuickActionModal();
			updateStats();
		}

		function quickExport(type) {
			const data = JSON.parse(localStorage.getItem(`edu_${type}`) || '[]');
			if (!data.length) {
				notify(`No ${type} data to export`, 'error');
				return;
			}
			
			let csv = '';
			if (type === 'students') {
				csv = 'ID,Name,Gender,Class,Section,Status\n' + data.map(s => `${s.id},"${s.name}",${s.gender},${s.class},${s.section},${s.status}`).join('\n');
			} else if (type === 'teachers') {
				csv = 'ID,Name,Subject,Email,Experience,Status\n' + data.map(t => `${t.id},"${t.name}",${t.subject},${t.email || ''},${t.experience || 0},${t.status}`).join('\n');
			} else if (type === 'fees') {
				csv = 'ID,Student,Class,Total,Paid,Balance,Status\n' + data.map(f => `${f.id},"${f.name}",${f.class},${f.total},${f.paid},${f.total - f.paid},${f.status}`).join('\n');
			} else {
				csv = JSON.stringify(data, null, 2);
			}
			
			const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8' });
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = `${type}_export_${new Date().toISOString().slice(0,10)}.csv`;
			link.click();
			notify(`‚úÖ ${type.charAt(0).toUpperCase() + type.slice(1)} exported!`, 'success');
		}

		// Quick Action Buttons - Show Modal
		document.querySelectorAll('.action-card').forEach(card => {
			card.addEventListener('click', () => {
				const action = card.dataset.action;
				showQuickActionModal(action);
			});
		});

		// Quick Action Modal Close
		document.getElementById('closeQuickAction').addEventListener('click', closeQuickActionModal);
		quickActionModal.addEventListener('click', (e) => {
			if (e.target === quickActionModal) closeQuickActionModal();
		});

		// View All Buttons
		document.querySelectorAll('.view-all-btn').forEach(btn => {
			btn.addEventListener('click', () => {
				const page = btn.dataset.navigate;
				navigateTo(page);
			});
		});

		// Filters
		document.getElementById('filterClass').addEventListener('change', () => {
			updateStats();
			renderCharts();
		});
		document.getElementById('filterSection').addEventListener('change', () => {
			updateStats();
			renderCharts();
		});
		document.getElementById('resetDashboardFilter').addEventListener('click', () => {
			document.getElementById('filterClass').value = '';
			document.getElementById('filterSection').value = '';
			updateStats();
			renderCharts();
			notify('Filters reset!');
		});

		// Date Range
		document.getElementById('dateRange').addEventListener('change', (e) => {
			const range = e.target.value;
			notify(`Showing data for: ${e.target.options[e.target.selectedIndex].text}`, 'info');
			renderCharts();
		});

		// Chart Metric Changes
		document.getElementById('performanceMetric').addEventListener('change', renderCharts);
		document.getElementById('feeMetric').addEventListener('change', renderCharts);

		// ==================== CHART DETAIL FUNCTIONS ====================
		const chartDetailModal = document.getElementById('chartDetailModal');
		const chartDetailHeader = document.getElementById('chartDetailHeader');
		const chartDetailTitle = document.getElementById('chartDetailTitle');
		const chartDetailBody = document.getElementById('chartDetailBody');

		function showChartDetailModal(chartType) {
			chartDetailHeader.className = 'chart-detail-header ' + chartType;
			
			if (chartType === 'performance') {
				chartDetailTitle.innerHTML = '<i class="fas fa-graduation-cap"></i> Student Performance Analysis';
				chartDetailBody.innerHTML = generatePerformanceDetail();
			} else if (chartType === 'fees') {
				chartDetailTitle.innerHTML = '<i class="fas fa-rupee-sign"></i> Fee Collection Analysis';
				chartDetailBody.innerHTML = generateFeeDetail();
			}
			
			chartDetailModal.classList.add('show');
		}

		function closeChartDetailModal() {
			chartDetailModal.classList.remove('show');
		}

		function generatePerformanceDetail() {
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			
			// Mock performance data
			const classPerformance = [
				{ cls: 'Class 10', count: students.filter(s => s.class === '10').length, avgScore: 85, topScore: 98, passRate: '95%' },
				{ cls: 'Class 11', count: students.filter(s => s.class === '11').length, avgScore: 78, topScore: 95, passRate: '90%' },
				{ cls: 'Class 12', count: students.filter(s => s.class === '12').length, avgScore: 82, topScore: 97, passRate: '92%' },
				{ cls: 'Class 9', count: students.filter(s => s.class === '9').length, avgScore: 80, topScore: 94, passRate: '88%' },
				{ cls: 'Class 8', count: students.filter(s => s.class === '8').length, avgScore: 76, topScore: 92, passRate: '85%' }
			];
			
			let html = '<div class="detail-stats-row">';
			html += '<div class="detail-stat-box"><div class="detail-stat-number">' + students.length + '</div><div class="detail-stat-text">Total Students</div></div>';
			html += '<div class="detail-stat-box green"><div class="detail-stat-number">85%</div><div class="detail-stat-text">Avg Performance</div></div>';
			html += '<div class="detail-stat-box orange"><div class="detail-stat-number">' + exams.length + '</div><div class="detail-stat-text">Total Exams</div></div>';
			html += '<div class="detail-stat-box blue"><div class="detail-stat-number">92%</div><div class="detail-stat-text">Pass Rate</div></div>';
			html += '</div>';
			
			html += '<h4 style="font-size:14px;font-weight:700;color:#1e293b;margin-bottom:16px;display:flex;align-items:center;gap:8px;"><i class="fas fa-chart-bar" style="color:#8b5cf6;"></i> Class-wise Performance</h4>';
			
			html += '<table class="detail-table"><thead><tr><th>Class</th><th>Students</th><th>Avg Score</th><th>Top Score</th><th>Pass Rate</th></tr></thead><tbody>';
			classPerformance.forEach(function(c) {
				html += '<tr>';
				html += '<td><strong>' + c.cls + '</strong></td>';
				html += '<td>' + (c.count || 0) + '</td>';
				html += '<td><span style="color:#8b5cf6;font-weight:600;">' + c.avgScore + '%</span></td>';
				html += '<td><span style="color:#22c55e;font-weight:600;">' + c.topScore + '%</span></td>';
				html += '<td><span style="background:#dcfce7;color:#16a34a;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;">' + c.passRate + '</span></td>';
				html += '</tr>';
			});
			html += '</tbody></table>';
			
			html += '<div class="detail-actions">';
			html += '<button class="quick-btn quick-btn-secondary" onclick="exportPerformanceData()"><i class="fas fa-download"></i> Export Report</button>';
			html += '<button class="quick-btn quick-btn-primary" onclick="closeChartDetailModal(); navigateTo(\'reports\');"><i class="fas fa-chart-line"></i> View Full Analytics</button>';
			html += '</div>';
			
			return html;
		}

		function generateFeeDetail() {
			const fees = JSON.parse(localStorage.getItem('edu_fees') || '[]');
			const totalAmount = fees.reduce(function(sum, f) { return sum + (f.total || 0); }, 0);
			const collected = fees.reduce(function(sum, f) { return sum + (f.paid || 0); }, 0);
			const pending = totalAmount - collected;
			const paidCount = fees.filter(function(f) { return f.status === 'paid'; }).length;
			const pendingCount = fees.filter(function(f) { return f.status !== 'paid'; }).length;
			const recentPayments = fees.filter(function(f) { return f.paid > 0; }).slice(0, 5);
			const rate = totalAmount > 0 ? Math.round((collected/totalAmount)*100) : 0;
			
			let html = '<div class="detail-stats-row">';
			html += '<div class="detail-stat-box"><div class="detail-stat-number">‚Çπ' + totalAmount.toLocaleString('en-IN') + '</div><div class="detail-stat-text">Total Expected</div></div>';
			html += '<div class="detail-stat-box green"><div class="detail-stat-number">‚Çπ' + collected.toLocaleString('en-IN') + '</div><div class="detail-stat-text">Collected</div></div>';
			html += '<div class="detail-stat-box red"><div class="detail-stat-number">‚Çπ' + pending.toLocaleString('en-IN') + '</div><div class="detail-stat-text">Pending</div></div>';
			html += '<div class="detail-stat-box blue"><div class="detail-stat-number">' + rate + '%</div><div class="detail-stat-text">Collection Rate</div></div>';
			html += '</div>';
			
			html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:24px;">';
			html += '<div style="background:#dcfce7;border-radius:12px;padding:20px;text-align:center;"><div style="font-size:36px;font-weight:800;color:#16a34a;">' + paidCount + '</div><div style="font-size:13px;color:#15803d;font-weight:600;">Fully Paid</div></div>';
			html += '<div style="background:#fee2e2;border-radius:12px;padding:20px;text-align:center;"><div style="font-size:36px;font-weight:800;color:#dc2626;">' + pendingCount + '</div><div style="font-size:13px;color:#b91c1c;font-weight:600;">Pending Payment</div></div>';
			html += '</div>';
			
			html += '<h4 style="font-size:14px;font-weight:700;color:#1e293b;margin-bottom:16px;display:flex;align-items:center;gap:8px;"><i class="fas fa-history" style="color:#22c55e;"></i> Recent Payments</h4>';
			
			html += '<table class="detail-table"><thead><tr><th>Student</th><th>Class</th><th>Amount Paid</th><th>Balance</th><th>Status</th></tr></thead><tbody>';
			if (recentPayments.length > 0) {
				recentPayments.forEach(function(f) {
					const balance = (f.total || 0) - (f.paid || 0);
					const balColor = balance > 0 ? '#ef4444' : '#22c55e';
					const statusBg = f.status === 'paid' ? '#dcfce7' : '#fef3c7';
					const statusColor = f.status === 'paid' ? '#16a34a' : '#d97706';
					const statusText = f.status === 'paid' ? 'Paid' : 'Pending';
					html += '<tr>';
					html += '<td><strong>' + (f.name || 'Unknown') + '</strong></td>';
					html += '<td>Class ' + (f.class || '-') + '</td>';
					html += '<td style="color:#22c55e;font-weight:600;">‚Çπ' + (f.paid || 0).toLocaleString('en-IN') + '</td>';
					html += '<td style="color:' + balColor + ';font-weight:600;">‚Çπ' + balance.toLocaleString('en-IN') + '</td>';
					html += '<td><span style="background:' + statusBg + ';color:' + statusColor + ';padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;">' + statusText + '</span></td>';
					html += '</tr>';
				});
			} else {
				html += '<tr><td colspan="5" style="text-align:center;color:#94a3b8;padding:30px;">No recent payments</td></tr>';
			}
			html += '</tbody></table>';
			
			html += '<div class="detail-actions">';
			html += '<button class="quick-btn quick-btn-secondary" onclick="exportFeeData()"><i class="fas fa-download"></i> Export Report</button>';
			html += '<button class="quick-btn quick-btn-primary" onclick="closeChartDetailModal(); navigateTo(\'fees\');"><i class="fas fa-rupee-sign"></i> Manage Fees</button>';
			html += '</div>';
			
			return html;
		}

		// Chart Card Click Handlers - Removed full card click, using buttons instead
		// Individual buttons handle expand/details now

		// Chart Detail Modal Close
		document.getElementById('closeChartDetail').addEventListener('click', closeChartDetailModal);
		chartDetailModal.addEventListener('click', (e) => {
			if (e.target === chartDetailModal) closeChartDetailModal();
		});

		// Chart Export Functions
		function exportPerformanceChart() {
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			let csv = 'Class,Students,Status\n';
			[10,11,12,9,8].forEach(function(c) {
				csv += 'Class ' + c + ',' + students.filter(function(s) { return s.class === String(c); }).length + ',Active\n';
			});
			downloadCSV(csv, 'performance_report');
			notify('‚úÖ Performance report exported!', 'success');
		}

		function exportFeeChart() {
			const fees = JSON.parse(localStorage.getItem('edu_fees') || '[]');
			let csv = 'Student,Class,Total,Paid,Balance,Status\n';
			fees.forEach(function(f) {
				csv += '"' + f.name + '",' + f.class + ',' + f.total + ',' + f.paid + ',' + (f.total - f.paid) + ',' + f.status + '\n';
			});
			downloadCSV(csv, 'fee_collection_report');
			notify('‚úÖ Fee report exported!', 'success');
		}

		function exportPerformanceData() {
			exportPerformanceChart();
			closeChartDetailModal();
		}

		function exportFeeData() {
			exportFeeChart();
			closeChartDetailModal();
		}

		function downloadCSV(csv, filename) {
			const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8' });
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = filename + '_' + new Date().toISOString().slice(0,10) + '.csv';
			link.click();
		}

		function refreshPerformanceChart() {
			renderCharts();
			notify('üìä Performance chart refreshed!', 'info');
		}

		function refreshFeeChart() {
			renderCharts();
			notify('üìä Fee chart refreshed!', 'info');
		}

		// ==================== EDITABLE CHART STATS ====================
		function editChartStat(elementId, label) {
			const element = document.getElementById(elementId);
			const currentValue = element.textContent;
			
			// Create input
			const input = document.createElement('input');
			input.type = 'text';
			input.value = currentValue;
			input.className = 'chart-stat-value editable';
			input.style.cssText = 'width: 80px; font-size: 18px; font-weight: 800; text-align: center; border: 2px solid #3b82f6; border-radius: 8px; padding: 4px; outline: none;';
			
			// Replace element with input
			element.style.display = 'none';
			element.parentNode.insertBefore(input, element.nextSibling);
			input.focus();
			input.select();
			
			// Save on blur or enter
			function saveValue() {
				const newValue = input.value.trim() || currentValue;
				element.textContent = newValue;
				element.style.display = 'block';
				input.remove();
				
				// Save to localStorage
				let chartData = JSON.parse(localStorage.getItem('edu_chart_stats') || '{}');
				chartData[elementId] = newValue;
				localStorage.setItem('edu_chart_stats', JSON.stringify(chartData));
				
				notify('‚úÖ ' + label + ' updated!', 'success');
			}
			
			input.addEventListener('blur', saveValue);
			input.addEventListener('keydown', function(e) {
				if (e.key === 'Enter') {
					saveValue();
				}
				if (e.key === 'Escape') {
					element.style.display = 'block';
					input.remove();
				}
			});
		}

		// Load saved chart stats
		function loadChartStats() {
			const chartData = JSON.parse(localStorage.getItem('edu_chart_stats') || '{}');
			Object.keys(chartData).forEach(function(key) {
				const el = document.getElementById(key);
				if (el) el.textContent = chartData[key];
			});
		}

		// ==================== STUDENT EDIT FUNCTIONS ====================
		const studentEditModal = document.getElementById('studentEditModal');

		function editStudent(studentId) {
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const student = students.find(function(s) { return s.id === studentId; });
			if (!student) {
				notify('Student not found', 'error');
				return;
			}
			
			document.getElementById('editStudentId').value = student.id;
			document.getElementById('editStudentName').value = student.name || '';
			document.getElementById('editStudentClass').value = student.class || '';
			document.getElementById('editStudentSection').value = student.section || '';
			document.getElementById('editStudentStatus').value = student.status || 'Active';
			
			studentEditModal.classList.add('show');
		}

		function closeStudentEditModal() {
			studentEditModal.classList.remove('show');
		}

		function saveStudentEdit() {
			const id = document.getElementById('editStudentId').value;
			const name = document.getElementById('editStudentName').value.trim();
			const cls = document.getElementById('editStudentClass').value;
			const section = document.getElementById('editStudentSection').value;
			const status = document.getElementById('editStudentStatus').value;
			
			if (!name || !cls || !section) {
				notify('Please fill all required fields', 'error');
				return;
			}
			
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			const idx = students.findIndex(function(s) { return s.id === id; });
			
			if (idx >= 0) {
				students[idx].name = name;
				students[idx].class = cls;
				students[idx].section = section;
				students[idx].status = status;
				localStorage.setItem('edu_students', JSON.stringify(students));
				
				closeStudentEditModal();
				renderRecentStudents();
				updateStats();
				notify('‚úÖ Student updated successfully!', 'success');
			}
		}

		function deleteStudent() {
			const id = document.getElementById('editStudentId').value;
			if (!confirm('Are you sure you want to delete this student?')) return;
			
			let students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			students = students.filter(function(s) { return s.id !== id; });
			localStorage.setItem('edu_students', JSON.stringify(students));
			
			closeStudentEditModal();
			renderRecentStudents();
			updateStats();
			notify('üóëÔ∏è Student deleted', 'info');
		}

		function quickDeleteStudent(studentId) {
			if (!confirm('Delete this student?')) return;
			
			let students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			students = students.filter(function(s) { return s.id !== studentId; });
			localStorage.setItem('edu_students', JSON.stringify(students));
			
			renderRecentStudents();
			updateStats();
			notify('üóëÔ∏è Student deleted', 'info');
		}

		function addQuickStudent() {
			showQuickActionModal('addStudent');
		}

		// ==================== EXAM EDIT FUNCTIONS ====================
		const examEditModal = document.getElementById('examEditModal');

		function editExam(examId) {
			const exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			const exam = exams.find(function(e) { return e.id === examId; });
			if (!exam) {
				notify('Exam not found', 'error');
				return;
			}
			
			document.getElementById('editExamId').value = exam.id;
			document.getElementById('editExamName').value = exam.name || '';
			document.getElementById('editExamSubject').value = exam.subject || '';
			document.getElementById('editExamClass').value = exam.class || '';
			document.getElementById('editExamDate').value = exam.date || '';
			document.getElementById('editExamStatus').value = exam.status || 'Scheduled';
			
			examEditModal.classList.add('show');
		}

		function closeExamEditModal() {
			examEditModal.classList.remove('show');
		}

		function saveExamEdit() {
			const id = document.getElementById('editExamId').value;
			const name = document.getElementById('editExamName').value.trim();
			const subject = document.getElementById('editExamSubject').value;
			const cls = document.getElementById('editExamClass').value;
			const date = document.getElementById('editExamDate').value;
			const status = document.getElementById('editExamStatus').value;
			
			if (!name || !subject || !cls || !date) {
				notify('Please fill all required fields', 'error');
				return;
			}
			
			const exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			const idx = exams.findIndex(function(e) { return e.id === id; });
			
			if (idx >= 0) {
				exams[idx].name = name;
				exams[idx].subject = subject;
				exams[idx].class = cls;
				exams[idx].date = date;
				exams[idx].status = status;
				localStorage.setItem('edu_exams', JSON.stringify(exams));
				
				closeExamEditModal();
				renderUpcomingExams();
				notify('‚úÖ Exam updated successfully!', 'success');
			}
		}

		function deleteExam() {
			const id = document.getElementById('editExamId').value;
			if (!confirm('Are you sure you want to delete this exam?')) return;
			
			let exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			exams = exams.filter(function(e) { return e.id !== id; });
			localStorage.setItem('edu_exams', JSON.stringify(exams));
			
			closeExamEditModal();
			renderUpcomingExams();
			notify('üóëÔ∏è Exam deleted', 'info');
		}

		function quickDeleteExam(examId) {
			if (!confirm('Delete this exam?')) return;
			
			let exams = JSON.parse(localStorage.getItem('edu_exams') || '[]');
			exams = exams.filter(function(e) { return e.id !== examId; });
			localStorage.setItem('edu_exams', JSON.stringify(exams));
			
			renderUpcomingExams();
			notify('üóëÔ∏è Exam deleted', 'info');
		}

		function addQuickExam() {
			showQuickActionModal('scheduleExam');
		}

		// Close modals on outside click
		studentEditModal.addEventListener('click', function(e) {
			if (e.target === studentEditModal) closeStudentEditModal();
		});
		examEditModal.addEventListener('click', function(e) {
			if (e.target === examEditModal) closeExamEditModal();
		});

		// Update Chart Stats
		function updateChartStats() {
			const fees = JSON.parse(localStorage.getItem('edu_fees') || '[]');
			const totalAmount = fees.reduce((sum, f) => sum + (f.total || 0), 0);
			const collected = fees.reduce((sum, f) => sum + (f.paid || 0), 0);
			const pending = totalAmount - collected;
			const rate = totalAmount > 0 ? Math.round((collected/totalAmount)*100) : 0;
			
			document.getElementById('totalCollection').textContent = '‚Çπ' + collected.toLocaleString('en-IN');
			document.getElementById('pendingAmount').textContent = '‚Çπ' + pending.toLocaleString('en-IN');
			document.getElementById('collectionRate').textContent = rate + '%';
			
			const students = JSON.parse(localStorage.getItem('edu_students') || '[]');
			document.getElementById('avgPerformance').textContent = '85%';
			document.getElementById('topPerformers').textContent = Math.max(1, Math.floor(students.length * 0.2));
			document.getElementById('needsImprovement').textContent = Math.max(0, Math.floor(students.length * 0.1));
		}

		// ==================== INITIALIZE ====================
		document.addEventListener('DOMContentLoaded', () => {
			updateStats();
			renderRecentStudents();
			renderUpcomingExams();
			renderCharts();
			updateChartStats();
			loadChartStats();
		});

		// Also run immediately
		updateStats();
		renderRecentStudents();
		renderUpcomingExams();
		updateChartStats();
		loadChartStats();
		setTimeout(renderCharts, 100);
	</script>
</body>
</html>
