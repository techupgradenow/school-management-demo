<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Timetable</title>
	<link rel="stylesheet" href="../style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		/* Timetable Specific Styles */
		.timetable-controls {
			display: flex;
			flex-wrap: wrap;
			gap: 12px;
			align-items: center;
			margin-bottom: 20px;
			padding: 16px 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border-radius: 12px;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
		}
		.timetable-controls label {
			color: #fff;
			font-weight: 600;
			font-size: 13px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.timetable-controls select {
			height: 42px;
			padding: 0 16px;
			border: none;
			border-radius: 8px;
			font-size: 14px;
			font-weight: 500;
			background: rgba(255,255,255,0.95);
			min-width: 140px;
			cursor: pointer;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}
		.timetable-controls .btn {
			height: 42px;
			border-radius: 8px;
			font-weight: 600;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.timetable-controls .btn-light {
			background: rgba(255,255,255,0.95);
			color: #667eea;
			border: none;
		}
		.timetable-controls .btn-light:hover {
			background: #fff;
			transform: translateY(-1px);
		}

		/* Timetable Grid */
		.timetable-wrapper {
			background: #fff;
			border-radius: 16px;
			box-shadow: 0 4px 20px rgba(0,0,0,0.08);
			overflow: hidden;
		}
		.timetable-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 20px 24px;
			background: linear-gradient(180deg, #f8fafc, #fff);
			border-bottom: 1px solid #e2e8f0;
		}
		.timetable-title {
			font-size: 18px;
			font-weight: 700;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.timetable-title i {
			color: #667eea;
		}
		.timetable-grid {
			display: grid;
			grid-template-columns: 100px repeat(6, 1fr);
			border-collapse: collapse;
		}
		.timetable-grid .cell {
			border: 1px solid #e2e8f0;
			padding: 0;
			min-height: 80px;
			position: relative;
		}
		.timetable-grid .cell-header {
			background: linear-gradient(180deg, #f1f5f9, #e2e8f0);
			font-weight: 700;
			font-size: 13px;
			color: #475569;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 50px;
		}
		.timetable-grid .cell-time {
			background: linear-gradient(180deg, #fafbfc, #f1f5f9);
			font-weight: 600;
			font-size: 12px;
			color: #64748b;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 2px;
			padding: 8px;
		}
		.timetable-grid .cell-time .period-num {
			font-size: 11px;
			color: #94a3b8;
			text-transform: uppercase;
		}
		.timetable-grid .cell-slot {
			cursor: pointer;
			transition: all 0.2s;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 8px;
		}
		.timetable-grid .cell-slot:hover {
			background: #f8fafc;
		}
		.timetable-grid .cell-slot.empty {
			background: repeating-linear-gradient(
				45deg,
				transparent,
				transparent 5px,
				#f8fafc 5px,
				#f8fafc 10px
			);
		}
		.timetable-grid .cell-slot.empty:hover {
			background: #eff6ff;
		}

		/* Subject Card */
		.subject-card {
			width: 100%;
			padding: 10px 12px;
			border-radius: 8px;
			text-align: center;
			transition: all 0.2s;
		}
		.subject-card:hover {
			transform: scale(1.02);
			box-shadow: 0 4px 12px rgba(0,0,0,0.15);
		}
		.subject-card .subject-name {
			font-weight: 700;
			font-size: 13px;
			margin-bottom: 4px;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		.subject-card .teacher-name {
			font-size: 11px;
			opacity: 0.85;
		}
		.subject-card .room-info {
			font-size: 10px;
			opacity: 0.7;
			margin-top: 2px;
		}

		/* Subject Colors */
		.subject-math { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: #fff; }
		.subject-science { background: linear-gradient(135deg, #22c55e, #16a34a); color: #fff; }
		.subject-english { background: linear-gradient(135deg, #f59e0b, #d97706); color: #fff; }
		.subject-history { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: #fff; }
		.subject-geography { background: linear-gradient(135deg, #06b6d4, #0891b2); color: #fff; }
		.subject-physics { background: linear-gradient(135deg, #ec4899, #db2777); color: #fff; }
		.subject-chemistry { background: linear-gradient(135deg, #14b8a6, #0d9488); color: #fff; }
		.subject-biology { background: linear-gradient(135deg, #84cc16, #65a30d); color: #fff; }
		.subject-computer { background: linear-gradient(135deg, #6366f1, #4f46e5); color: #fff; }
		.subject-pe { background: linear-gradient(135deg, #f43f5e, #e11d48); color: #fff; }
		.subject-art { background: linear-gradient(135deg, #a855f7, #9333ea); color: #fff; }
		.subject-music { background: linear-gradient(135deg, #0ea5e9, #0284c7); color: #fff; }
		.subject-break { background: linear-gradient(135deg, #94a3b8, #64748b); color: #fff; }
		.subject-lunch { background: linear-gradient(135deg, #fb923c, #ea580c); color: #fff; }
		.subject-assembly { background: linear-gradient(135deg, #475569, #334155); color: #fff; }

		/* Legend */
		.legend-wrapper {
			margin-top: 20px;
			padding: 16px 20px;
			background: #fff;
			border-radius: 12px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
		}
		.legend-title {
			font-weight: 600;
			font-size: 14px;
			color: #475569;
			margin-bottom: 12px;
		}
		.legend-items {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}
		.legend-item {
			display: flex;
			align-items: center;
			gap: 6px;
			font-size: 12px;
			color: #64748b;
		}
		.legend-color {
			width: 16px;
			height: 16px;
			border-radius: 4px;
		}

		/* Modern Modal Styles with Collapse */
		.modal {
			position: fixed;
			inset: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			background: rgba(15, 23, 42, 0.75);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			z-index: 9999;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			padding: 20px;
		}
		.modal.show {
			opacity: 1;
			visibility: visible;
		}
		.modal.closing {
			opacity: 0;
		}
		.modal-content {
			background: #ffffff;
			border-radius: 24px;
			width: 520px;
			max-width: 100%;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05);
			padding: 0;
			transform-origin: center;
			overflow: hidden;
			position: relative;
			max-height: 90vh;
			display: flex;
			flex-direction: column;
		}
		.modal.show .modal-content {
			animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
		}
		.modal.closing .modal-content {
			animation: modalCollapse 0.35s cubic-bezier(0.4, 0, 0.2, 1);
		}
		.modal-content::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
			background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
			background-size: 200% 100%;
			animation: shimmer 3s linear infinite;
			z-index: 1;
		}
		@keyframes shimmer {
			0% { background-position: 200% 0; }
			100% { background-position: -200% 0; }
		}
		@keyframes modalSlideIn {
			from { 
				transform: translateY(-30px) scale(0.95); 
				opacity: 0; 
			}
			to { 
				transform: translateY(0) scale(1); 
				opacity: 1; 
			}
		}
		@keyframes modalCollapse {
			0% { 
				transform: translateY(0) scale(1); 
				opacity: 1;
				max-height: 90vh;
			}
			50% {
				transform: translateY(20px) scale(0.98);
				opacity: 0.8;
			}
			100% { 
				transform: translateY(50px) scale(0.92); 
				opacity: 0;
				max-height: 0;
			}
		}
		.modal-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 28px 32px 24px;
			background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
			border-bottom: 1px solid rgba(226, 232, 240, 0.8);
			position: relative;
			flex-shrink: 0;
		}
		.modal-header::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 32px;
			right: 32px;
			height: 1px;
			background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
		}
		.modal-title {
			font-weight: 700;
			font-size: 22px;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 12px;
			letter-spacing: -0.02em;
		}
		.modal-title span {
			width: 5px;
			height: 24px;
			background: linear-gradient(180deg, #667eea, #764ba2);
			border-radius: 3px;
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
		}
		.modal-close {
			cursor: pointer;
			color: #64748b;
			width: 40px;
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 12px;
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			background: transparent;
			border: 2px solid transparent;
		}
		.modal-close:hover {
			color: #ef4444;
			background: #fef2f2;
			border-color: #fecaca;
			transform: rotate(90deg);
		}
		.modal-close:active {
			transform: rotate(90deg) scale(0.95);
		}
		.modal-body {
			padding: 32px;
			display: grid;
			gap: 24px;
			background: #ffffff;
			overflow-y: auto;
			flex: 1;
			min-height: 0;
		}
		.modal-body label {
			display: flex;
			align-items: center;
			gap: 6px;
			margin-bottom: 10px;
			color: #475569;
			font-weight: 700;
			font-size: 12px;
			text-transform: uppercase;
			letter-spacing: 0.8px;
		}
		.modal-body label .required {
			color: #ef4444;
			font-size: 14px;
		}
		.modal-body input,
		.modal-body select {
			width: 100%;
			height: 52px;
			border: 2px solid #e2e8f0;
			border-radius: 14px;
			padding: 0 18px;
			font-size: 15px;
			font-weight: 500;
			background: #ffffff;
			color: #1e293b;
			box-sizing: border-box;
			outline: none;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			cursor: pointer;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
		}
		.modal-body input:hover,
		.modal-body select:hover {
			border-color: #cbd5e1;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
		}
		.modal-body input:focus,
		.modal-body select:focus {
			border-color: #667eea;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.12), 0 4px 12px rgba(102, 126, 234, 0.15);
			transform: translateY(-1px);
		}
		.modal-body input[type="text"] {
			cursor: text;
		}
		.modal-body input::placeholder {
			color: #94a3b8;
			font-weight: 400;
		}
		.modal-body select {
			appearance: none;
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
			background-repeat: no-repeat;
			background-position: right 18px center;
			padding-right: 45px;
		}
		.modal-body select option[data-add-subject="true"] {
			background: linear-gradient(135deg, #eff6ff, #dbeafe);
			color: #667eea;
			font-weight: 700;
			padding: 12px;
		}
		.modal-body select option[data-custom="true"] {
			font-weight: 500;
		}
		.modal-footer {
			display: flex;
			justify-content: flex-end;
			align-items: center;
			gap: 12px;
			padding: 24px 32px;
			background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%);
			border-top: 1px solid rgba(226, 232, 240, 0.8);
			position: relative;
			flex-shrink: 0;
		}
		.modal-footer::before {
			content: '';
			position: absolute;
			top: 0;
			left: 32px;
			right: 32px;
			height: 1px;
			background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
		}
		.modal-footer .btn {
			min-width: 130px;
			height: 48px;
			padding: 0 24px;
			border-radius: 12px;
			font-weight: 700;
			font-size: 14px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			border: none;
			letter-spacing: 0.3px;
		}
		.modal-footer .btn-cancel {
			background: #ffffff;
			border: 2px solid #e2e8f0;
			color: #64748b;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
		}
		.modal-footer .btn-cancel:hover {
			background: #f8fafc;
			border-color: #cbd5e1;
			color: #475569;
			transform: translateY(-1px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		}
		.modal-footer .btn-save {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: #ffffff;
			box-shadow: 0 4px 14px rgba(102, 126, 234, 0.4), 0 2px 4px rgba(102, 126, 234, 0.2);
		}
		.modal-footer .btn-save:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 20px rgba(102, 126, 234, 0.5), 0 4px 8px rgba(102, 126, 234, 0.3);
		}
		.modal-footer .btn-save:active {
			transform: translateY(0);
		}
		.modal-footer .btn-delete {
			background: linear-gradient(135deg, #fee2e2, #fecaca);
			border: 2px solid #fca5a5;
			color: #dc2626;
			margin-right: auto;
			box-shadow: 0 2px 6px rgba(220, 38, 38, 0.2);
		}
		.modal-footer .btn-delete:hover {
			background: linear-gradient(135deg, #fecaca, #fca5a5);
			border-color: #f87171;
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
		}
		
		/* Add Subject Option in Dropdown */
		.subject-select-wrapper {
			position: relative;
		}
		.add-subject-option {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 12px 16px;
			margin-top: 4px;
			border-top: 2px dashed #e2e8f0;
			color: #667eea;
			font-weight: 600;
			font-size: 14px;
			cursor: pointer;
			transition: all 0.2s;
			border-radius: 0 0 12px 12px;
		}
		.add-subject-option:hover {
			background: #eff6ff;
			color: #764ba2;
		}
		.add-subject-option i {
			font-size: 16px;
		}

		/* Add Subject Modal */
		.add-subject-modal {
			position: fixed;
			inset: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			background: rgba(15, 23, 42, 0.85);
			backdrop-filter: blur(8px);
			z-index: 10000;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}
		.add-subject-modal.show {
			opacity: 1;
			visibility: visible;
		}
		.add-subject-modal.closing {
			opacity: 0;
		}
		.add-subject-content {
			background: #ffffff;
			border-radius: 16px;
			width: 360px;
			max-width: 90%;
			box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
			overflow: hidden;
			position: relative;
		}
		.add-subject-modal.show .add-subject-content {
			animation: modalSlideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
		}
		.add-subject-modal.closing .add-subject-content {
			animation: modalCollapse 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}
		.add-subject-header {
			padding: 16px 20px;
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
			display: flex;
			align-items: center;
			justify-content: space-between;
		}
		.add-subject-header h3 {
			font-size: 16px;
			font-weight: 700;
			margin: 0;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.add-subject-close {
			width: 28px;
			height: 28px;
			border-radius: 6px;
			background: rgba(255, 255, 255, 0.2);
			border: none;
			color: white;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
			font-size: 14px;
		}
		.add-subject-close:hover {
			background: rgba(255, 255, 255, 0.3);
			transform: rotate(90deg);
		}
		.add-subject-body {
			padding: 20px;
		}
		.icon-selector {
			display: grid;
			grid-template-columns: repeat(6, 1fr);
			gap: 6px;
			margin-top: 10px;
			max-height: 160px;
			overflow-y: auto;
			padding: 6px;
			background: #f8fafc;
			border-radius: 10px;
			border: 2px solid #e2e8f0;
		}
		@media (max-width: 640px) {
			.icon-selector {
				grid-template-columns: repeat(4, 1fr);
			}
		}
		.icon-option {
			width: 100%;
			aspect-ratio: 1;
			border: 2px solid #e2e8f0;
			border-radius: 8px;
			background: white;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.2s;
			font-size: 18px;
		}
		.icon-option:hover {
			border-color: #667eea;
			background: #eff6ff;
			transform: scale(1.1);
		}
		.icon-option.selected {
			border-color: #667eea;
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
		}
		.icon-upload-area {
			border: 2px dashed #cbd5e1;
			border-radius: 10px;
			padding: 16px;
			text-align: center;
			cursor: pointer;
			transition: all 0.2s;
			background: #f8fafc;
			margin-top: 10px;
		}
		.icon-upload-area:hover {
			border-color: #667eea;
			background: #eff6ff;
		}
		.icon-upload-area.has-icon {
			border-style: solid;
			border-color: #667eea;
			background: white;
		}
		.icon-preview {
			width: 50px;
			height: 50px;
			margin: 0 auto 10px;
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 28px;
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: white;
		}
		.icon-preview img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			border-radius: 12px;
		}

		/* Responsive Modal */
		@media (max-width: 640px) {
			.modal {
				padding: 12px;
			}
			.modal-content {
				width: 100%;
				border-radius: 20px;
			}
			.modal-header {
				padding: 24px 20px 20px;
			}
			.modal-title {
				font-size: 20px;
			}
			.modal-body {
				padding: 24px 20px;
				gap: 20px;
			}
			.modal-footer {
				padding: 20px;
				flex-wrap: wrap;
			}
			.modal-footer .btn {
				flex: 1;
				min-width: auto;
			}
			.modal-footer .btn-delete {
				width: 100%;
				margin-right: 0;
				margin-bottom: 8px;
			}
			.add-subject-content {
				width: 95%;
			}
			.icon-selector {
				grid-template-columns: repeat(5, 1fr);
			}
		}

		/* Print Styles */
		@media print {
			.timetable-controls, .legend-wrapper, .page-title button { display: none !important; }
			.timetable-wrapper { box-shadow: none; border: 1px solid #e2e8f0; }
		}

		/* Responsive */
		@media (max-width: 768px) {
			.timetable-grid {
				grid-template-columns: 70px repeat(6, 1fr);
				font-size: 11px;
			}
			.subject-card {
				padding: 6px 4px;
			}
			.subject-card .subject-name {
				font-size: 10px;
			}
			.subject-card .teacher-name,
			.subject-card .room-info {
				display: none;
			}
		}
	</style>
</head>
<body>
	<div class="page timetable-page active">
		<div class="page-title">
			<h1><i class="fas fa-calendar-alt" style="color: #667eea; margin-right: 10px;"></i>Timetable</h1>
			<button class="btn btn-primary" id="addSlotBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none;">
				<i class="fas fa-plus"></i> Add Period
			</button>
		</div>

		<!-- Controls -->
		<div class="timetable-controls">
			<div>
				<label>Class</label>
				<select id="classSelect">
					<option value="8">Class 8</option>
					<option value="9">Class 9</option>
					<option value="10" selected>Class 10</option>
					<option value="11">Class 11</option>
					<option value="12">Class 12</option>
				</select>
			</div>
			<div>
				<label>Section</label>
				<select id="sectionSelect">
					<option value="A" selected>Section A</option>
					<option value="B">Section B</option>
					<option value="C">Section C</option>
				</select>
			</div>
			<div style="margin-left: auto; display: flex; gap: 10px;">
				<button class="btn btn-light" id="printBtn">
					<i class="fas fa-print"></i> Print
				</button>
				<button class="btn btn-light" id="exportBtn">
					<i class="fas fa-download"></i> Export
				</button>
			</div>
		</div>

		<!-- Timetable Grid -->
		<div class="timetable-wrapper">
			<div class="timetable-header">
				<div class="timetable-title">
					<i class="fas fa-table"></i>
					<span>Weekly Schedule - Class <span id="displayClass">10</span> <span id="displaySection">A</span></span>
				</div>
				<div style="font-size: 13px; color: #64748b;">
					<i class="fas fa-clock"></i> Academic Year 2024-25
				</div>
			</div>
			<div class="timetable-grid" id="timetableGrid">
				<!-- Generated by JS -->
			</div>
		</div>

		<!-- Legend -->
		<div class="legend-wrapper">
			<div class="legend-title"><i class="fas fa-palette" style="margin-right: 8px;"></i>Subject Colors</div>
			<div class="legend-items" id="legendItems">
				<!-- Generated by JS -->
			</div>
		</div>
	</div>

	<!-- Add/Edit Slot Modal -->
	<div class="modal" id="slotModal">
		<div class="modal-content">
			<!-- Header -->
			<div class="modal-header">
				<div class="modal-title">
					<span></span>
					<span id="modalTitle">Add Period</span>
				</div>
				<div id="closeModal" class="modal-close">
					<i class="fas fa-times"></i>
				</div>
			</div>
			
			<!-- Form Body -->
			<div class="modal-body">
				<input type="hidden" id="editDay">
				<input type="hidden" id="editPeriod">
				
				<!-- Day Selection -->
				<div id="daySelectContainer">
					<label for="daySelect">
						<i class="fas fa-calendar-day" style="font-size: 11px;"></i>
						Day <span class="required">*</span>
					</label>
					<select id="daySelect">
						<option value="">Select Day</option>
						<option value="Monday">Monday</option>
						<option value="Tuesday">Tuesday</option>
						<option value="Wednesday">Wednesday</option>
						<option value="Thursday">Thursday</option>
						<option value="Friday">Friday</option>
						<option value="Saturday">Saturday</option>
					</select>
				</div>
				
				<!-- Period Selection -->
				<div id="periodSelectContainer">
					<label for="periodSelect">
						<i class="fas fa-clock" style="font-size: 11px;"></i>
						Period <span class="required">*</span>
					</label>
					<select id="periodSelect">
						<option value="">Select Period</option>
						<option value="1">Period 1 (08:00 - 08:45)</option>
						<option value="2">Period 2 (08:45 - 09:30)</option>
						<option value="3">Period 3 (09:30 - 10:15)</option>
						<option value="4">Period 4 (10:30 - 11:15)</option>
						<option value="5">Period 5 (11:15 - 12:00)</option>
						<option value="6">Period 6 (12:00 - 12:45)</option>
						<option value="7">Period 7 (01:30 - 02:15)</option>
						<option value="8">Period 8 (02:15 - 03:00)</option>
					</select>
				</div>
				
				<!-- Subject -->
				<div class="subject-select-wrapper">
					<label for="subjectSelect">
						<i class="fas fa-book" style="font-size: 11px;"></i>
						Subject <span class="required">*</span>
					</label>
					<select id="subjectSelect">
						<option value="">Select Subject</option>
						<option value="Mathematics">üìê Mathematics</option>
						<option value="Science">üî¨ Science</option>
						<option value="English">üìö English</option>
						<option value="History">üìú History</option>
						<option value="Geography">üåç Geography</option>
						<option value="Physics">‚öõÔ∏è Physics</option>
						<option value="Chemistry">üß™ Chemistry</option>
						<option value="Biology">üß¨ Biology</option>
						<option value="Computer Science">üíª Computer Science</option>
						<option value="Physical Education">üèÉ Physical Education</option>
						<option value="Art">üé® Art</option>
						<option value="Music">üéµ Music</option>
						<option value="Assembly">üè´ Assembly</option>
					</select>
				</div>
				
				<!-- Teacher -->
				<div>
					<label for="teacherInput">
						<i class="fas fa-chalkboard-teacher" style="font-size: 11px;"></i>
						Teacher
					</label>
					<input type="text" id="teacherInput" placeholder="e.g. Mr. Sharma, Mrs. Gupta">
				</div>
				
				<!-- Room -->
				<div>
					<label for="roomInput">
						<i class="fas fa-door-open" style="font-size: 11px;"></i>
						Room / Lab
					</label>
					<input type="text" id="roomInput" placeholder="e.g. Room 101, Physics Lab, Ground">
				</div>
			</div>
			
			<!-- Footer -->
			<div class="modal-footer">
				<button id="deleteSlotBtn" class="btn btn-delete" style="display: none;">
					<i class="fas fa-trash"></i> Remove
				</button>
				<button id="cancelBtn" class="btn btn-cancel">
					<i class="fas fa-times"></i> Cancel
				</button>
				<button id="saveSlotBtn" class="btn btn-save">
					<i class="fas fa-check"></i> Save Period
				</button>
			</div>
		</div>
	</div>

	<!-- Add Subject Modal -->
	<div class="add-subject-modal" id="addSubjectModal">
		<div class="add-subject-content">
			<div class="add-subject-header">
				<h3>
					<i class="fas fa-plus-circle"></i>
					Add New Subject
				</h3>
				<button class="add-subject-close" id="closeAddSubject">
					<i class="fas fa-times"></i>
				</button>
			</div>
			<div class="add-subject-body">
				<div>
					<label for="newSubjectName">
						<i class="fas fa-tag" style="font-size: 11px;"></i>
						Subject Name <span class="required">*</span>
					</label>
					<input type="text" id="newSubjectName" placeholder="e.g. Economics, Psychology" style="width: 100%; height: 44px; border: 2px solid #e2e8f0; border-radius: 10px; padding: 0 14px; font-size: 14px; font-weight: 500; background: #ffffff; color: #1e293b; box-sizing: border-box; outline: none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: text; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);">
				</div>
				
				<div style="margin-top: 16px;">
					<label>
						<i class="fas fa-image" style="font-size: 11px;"></i>
						Subject Icon
					</label>
					<div class="icon-selector" id="iconSelector">
						<div class="icon-option" data-icon="üìê" title="Mathematics">üìê</div>
						<div class="icon-option" data-icon="üî¨" title="Science">üî¨</div>
						<div class="icon-option" data-icon="üìö" title="English">üìö</div>
						<div class="icon-option" data-icon="üìú" title="History">üìú</div>
						<div class="icon-option" data-icon="üåç" title="Geography">üåç</div>
						<div class="icon-option" data-icon="‚öõÔ∏è" title="Physics">‚öõÔ∏è</div>
						<div class="icon-option" data-icon="üß™" title="Chemistry">üß™</div>
						<div class="icon-option" data-icon="üß¨" title="Biology">üß¨</div>
						<div class="icon-option" data-icon="üíª" title="Computer">üíª</div>
						<div class="icon-option" data-icon="üèÉ" title="Physical Education">üèÉ</div>
						<div class="icon-option" data-icon="üé®" title="Art">üé®</div>
						<div class="icon-option" data-icon="üéµ" title="Music">üéµ</div>
						<div class="icon-option" data-icon="üè´" title="Assembly">üè´</div>
						<div class="icon-option" data-icon="üìä" title="Statistics">üìä</div>
						<div class="icon-option" data-icon="üí∞" title="Economics">üí∞</div>
						<div class="icon-option" data-icon="üß†" title="Psychology">üß†</div>
						<div class="icon-option" data-icon="üåê" title="Languages">üåê</div>
						<div class="icon-option" data-icon="‚öΩ" title="Sports">‚öΩ</div>
						<div class="icon-option" data-icon="üìñ" title="Literature">üìñ</div>
						<div class="icon-option" data-icon="‚úèÔ∏è" title="Writing">‚úèÔ∏è</div>
						<div class="icon-option" data-icon="üî§" title="Language Arts">üî§</div>
						<div class="icon-option" data-icon="üìù" title="Essay">üìù</div>
						<div class="icon-option" data-icon="üî¢" title="Algebra">üî¢</div>
						<div class="icon-option" data-icon="üìê" title="Geometry">üìê</div>
						<div class="icon-option" data-icon="üî≠" title="Astronomy">üî≠</div>
						<div class="icon-option" data-icon="üå°Ô∏è" title="Meteorology">üå°Ô∏è</div>
						<div class="icon-option" data-icon="üåã" title="Geology">üåã</div>
						<div class="icon-option" data-icon="üåø" title="Botany">üåø</div>
						<div class="icon-option" data-icon="ü¶Å" title="Zoology">ü¶Å</div>
						<div class="icon-option" data-icon="üßÆ" title="Calculus">üßÆ</div>
						<div class="icon-option" data-icon="üìà" title="Business">üìà</div>
						<div class="icon-option" data-icon="üèõÔ∏è" title="Civics">üèõÔ∏è</div>
						<div class="icon-option" data-icon="‚öñÔ∏è" title="Law">‚öñÔ∏è</div>
						<div class="icon-option" data-icon="üè•" title="Health">üè•</div>
						<div class="icon-option" data-icon="üî¨" title="Research">üî¨</div>
						<div class="icon-option" data-icon="üì±" title="Technology">üì±</div>
						<div class="icon-option" data-icon="üé≠" title="Drama">üé≠</div>
						<div class="icon-option" data-icon="üé¨" title="Film Studies">üé¨</div>
						<div class="icon-option" data-icon="üì∑" title="Photography">üì∑</div>
						<div class="icon-option" data-icon="üñºÔ∏è" title="Media Studies">üñºÔ∏è</div>
						<div class="icon-option" data-icon="üåè" title="World Studies">üåè</div>
						<div class="icon-option" data-icon="üó∫Ô∏è" title="Cartography">üó∫Ô∏è</div>
						<div class="icon-option" data-icon="üè∫" title="Archaeology">üè∫</div>
						<div class="icon-option" data-icon="‚è∞" title="History">‚è∞</div>
						<div class="icon-option" data-icon="üîç" title="Research Methods">üîç</div>
						<div class="icon-option" data-icon="üìã" title="Social Studies">üìã</div>
						<div class="icon-option" data-icon="üéØ" title="Target">üéØ</div>
						<div class="icon-option" data-icon="üî¨" title="Lab">üî¨</div>
						<div class="icon-option" data-icon="üß≤" title="Magnetism">üß≤</div>
						<div class="icon-option" data-icon="‚ö°" title="Electricity">‚ö°</div>
						<div class="icon-option" data-icon="üåä" title="Oceanography">üåä</div>
						<div class="icon-option" data-icon="üåå" title="Space Science">üåå</div>
						<div class="icon-option" data-icon="üî≠" title="Telescope">üî≠</div>
						<div class="icon-option" data-icon="üß™" title="Experiment">üß™</div>
						<div class="icon-option" data-icon="üìö" title="Library">üìö</div>
						<div class="icon-option" data-icon="üéì" title="Education">üéì</div>
						<div class="icon-option" data-icon="üìñ" title="Reading">üìñ</div>
						<div class="icon-option" data-icon="‚úçÔ∏è" title="Creative Writing">‚úçÔ∏è</div>
						<div class="icon-option" data-icon="üó£Ô∏è" title="Speech">üó£Ô∏è</div>
						<div class="icon-option" data-icon="üé§" title="Public Speaking">üé§</div>
						<div class="icon-option" data-icon="üé™" title="Theater">üé™</div>
						<div class="icon-option" data-icon="üéπ" title="Piano">üéπ</div>
						<div class="icon-option" data-icon="ü•Å" title="Drums">ü•Å</div>
						<div class="icon-option" data-icon="üé∏" title="Guitar">üé∏</div>
						<div class="icon-option" data-icon="üé®" title="Drawing">üé®</div>
						<div class="icon-option" data-icon="üñåÔ∏è" title="Painting">üñåÔ∏è</div>
						<div class="icon-option" data-icon="‚úÇÔ∏è" title="Crafts">‚úÇÔ∏è</div>
						<div class="icon-option" data-icon="üèãÔ∏è" title="Fitness">üèãÔ∏è</div>
						<div class="icon-option" data-icon="ü§∏" title="Gymnastics">ü§∏</div>
						<div class="icon-option" data-icon="üèä" title="Swimming">üèä</div>
						<div class="icon-option" data-icon="üèÄ" title="Basketball">üèÄ</div>
						<div class="icon-option" data-icon="‚öΩ" title="Football">‚öΩ</div>
						<div class="icon-option" data-icon="üéæ" title="Tennis">üéæ</div>
						<div class="icon-option" data-icon="üèê" title="Volleyball">üèê</div>
						<div class="icon-option" data-icon="üè∏" title="Badminton">üè∏</div>
						<div class="icon-option" data-icon="‚ôüÔ∏è" title="Chess">‚ôüÔ∏è</div>
						<div class="icon-option" data-icon="üß©" title="Puzzle">üß©</div>
						<div class="icon-option" data-icon="üé≤" title="Games">üé≤</div>
					</div>
					<div class="icon-upload-area" id="iconUploadArea">
						<div class="icon-preview" id="iconPreview">üìö</div>
						<div style="font-size: 12px; color: #64748b; font-weight: 500;">
							Click to upload custom icon
							<br>
							<span style="font-size: 10px; color: #94a3b8;">or select from above</span>
						</div>
						<input type="file" id="iconFileInput" accept="image/*" style="display: none;">
					</div>
				</div>
			</div>
			<div class="modal-footer" style="padding: 16px 20px;">
				<button id="cancelAddSubject" class="btn btn-cancel">
					<i class="fas fa-times"></i> Cancel
				</button>
				<button id="saveNewSubject" class="btn btn-save">
					<i class="fas fa-check"></i> Add Subject
				</button>
			</div>
		</div>
	</div>

	<script>
		// Constants
		const DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
		const PERIODS = [
			{ num: 1, start: '08:00', end: '08:45' },
			{ num: 2, start: '08:45', end: '09:30' },
			{ num: 3, start: '09:30', end: '10:15' },
			{ num: 'Break', start: '10:15', end: '10:30', isBreak: true },
			{ num: 4, start: '10:30', end: '11:15' },
			{ num: 5, start: '11:15', end: '12:00' },
			{ num: 6, start: '12:00', end: '12:45' },
			{ num: 'Lunch', start: '12:45', end: '01:30', isBreak: true },
			{ num: 7, start: '01:30', end: '02:15' },
			{ num: 8, start: '02:15', end: '03:00' }
		];

		const SUBJECT_COLORS = {
			'Mathematics': 'subject-math',
			'Science': 'subject-science',
			'English': 'subject-english',
			'History': 'subject-history',
			'Geography': 'subject-geography',
			'Physics': 'subject-physics',
			'Chemistry': 'subject-chemistry',
			'Biology': 'subject-biology',
			'Computer Science': 'subject-computer',
			'Physical Education': 'subject-pe',
			'Art': 'subject-art',
			'Music': 'subject-music',
			'Break': 'subject-break',
			'Lunch Break': 'subject-lunch',
			'Assembly': 'subject-assembly'
		};

		const STORAGE_KEY = 'edu_timetable';
		const SUBJECTS_STORAGE_KEY = 'edu_custom_subjects';
		
		// Custom subjects management
		let customSubjects = [];
		let selectedIcon = 'üìö';
		let selectedIconType = 'emoji'; // 'emoji' or 'image'
		let selectedIconData = null;

		// Demo Data
		const DEMO_DATA = {
			'10-A': {
				'Monday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					3: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					4: { subject: 'Physics', teacher: 'Mr. Verma', room: 'Physics Lab' },
					5: { subject: 'Chemistry', teacher: 'Mrs. Patel', room: 'Chemistry Lab' },
					6: { subject: 'History', teacher: 'Mr. Singh', room: 'Room 101' },
					7: { subject: 'Computer Science', teacher: 'Mr. Kumar', room: 'Computer Lab' },
					8: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' }
				},
				'Tuesday': {
					1: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					2: { subject: 'Physics', teacher: 'Mr. Verma', room: 'Physics Lab' },
					3: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					4: { subject: 'Biology', teacher: 'Mrs. Reddy', room: 'Biology Lab' },
					5: { subject: 'Geography', teacher: 'Mr. Joshi', room: 'Room 101' },
					6: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					7: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					8: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' }
				},
				'Wednesday': {
					1: { subject: 'Science', teacher: 'Mr. Verma', room: 'Science Lab' },
					2: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					3: { subject: 'History', teacher: 'Mr. Singh', room: 'Room 101' },
					4: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					5: { subject: 'Chemistry', teacher: 'Mrs. Patel', room: 'Chemistry Lab' },
					6: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					7: { subject: 'Physics', teacher: 'Mr. Verma', room: 'Physics Lab' },
					8: { subject: 'Computer Science', teacher: 'Mr. Kumar', room: 'Computer Lab' }
				},
				'Thursday': {
					1: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					2: { subject: 'Biology', teacher: 'Mrs. Reddy', room: 'Biology Lab' },
					3: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					4: { subject: 'Geography', teacher: 'Mr. Joshi', room: 'Room 101' },
					5: { subject: 'Physics', teacher: 'Mr. Verma', room: 'Physics Lab' },
					6: { subject: 'History', teacher: 'Mr. Singh', room: 'Room 101' },
					7: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					8: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' }
				},
				'Friday': {
					1: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					2: { subject: 'Chemistry', teacher: 'Mrs. Patel', room: 'Chemistry Lab' },
					3: { subject: 'Computer Science', teacher: 'Mr. Kumar', room: 'Computer Lab' },
					4: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					5: { subject: 'Biology', teacher: 'Mrs. Reddy', room: 'Biology Lab' },
					6: { subject: 'Physics', teacher: 'Mr. Verma', room: 'Physics Lab' },
					7: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					8: { subject: 'Geography', teacher: 'Mr. Joshi', room: 'Room 101' }
				},
				'Saturday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'English', teacher: 'Mrs. Gupta', room: 'Room 101' },
					3: { subject: 'Mathematics', teacher: 'Mr. Sharma', room: 'Room 101' },
					4: { subject: 'Science', teacher: 'Mr. Verma', room: 'Science Lab' },
					5: { subject: 'History', teacher: 'Mr. Singh', room: 'Room 101' },
					6: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					7: { subject: 'Computer Science', teacher: 'Mr. Kumar', room: 'Computer Lab' },
					8: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' }
				}
			},
			'10-B': {
				'Monday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					3: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					4: { subject: 'Chemistry', teacher: 'Mr. Saxena', room: 'Chemistry Lab' },
					5: { subject: 'Biology', teacher: 'Mrs. Nair', room: 'Biology Lab' },
					6: { subject: 'Geography', teacher: 'Mrs. Bose', room: 'Room 102' },
					7: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					8: { subject: 'Computer Science', teacher: 'Ms. Sharma', room: 'Computer Lab' }
				},
				'Tuesday': {
					1: { subject: 'Physics', teacher: 'Mr. Das', room: 'Physics Lab' },
					2: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					3: { subject: 'History', teacher: 'Mr. Pillai', room: 'Room 102' },
					4: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					5: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					6: { subject: 'Chemistry', teacher: 'Mr. Saxena', room: 'Chemistry Lab' },
					7: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					8: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' }
				},
				'Wednesday': {
					1: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					2: { subject: 'Biology', teacher: 'Mrs. Nair', room: 'Biology Lab' },
					3: { subject: 'Physics', teacher: 'Mr. Das', room: 'Physics Lab' },
					4: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					5: { subject: 'History', teacher: 'Mr. Pillai', room: 'Room 102' },
					6: { subject: 'Computer Science', teacher: 'Ms. Sharma', room: 'Computer Lab' },
					7: { subject: 'Geography', teacher: 'Mrs. Bose', room: 'Room 102' },
					8: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' }
				},
				'Thursday': {
					1: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					2: { subject: 'Chemistry', teacher: 'Mr. Saxena', room: 'Chemistry Lab' },
					3: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					4: { subject: 'Physics', teacher: 'Mr. Das', room: 'Physics Lab' },
					5: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					6: { subject: 'Biology', teacher: 'Mrs. Nair', room: 'Biology Lab' },
					7: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					8: { subject: 'History', teacher: 'Mr. Pillai', room: 'Room 102' }
				},
				'Friday': {
					1: { subject: 'Science', teacher: 'Mr. Das', room: 'Science Lab' },
					2: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					3: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					4: { subject: 'Geography', teacher: 'Mrs. Bose', room: 'Room 102' },
					5: { subject: 'Computer Science', teacher: 'Ms. Sharma', room: 'Computer Lab' },
					6: { subject: 'Chemistry', teacher: 'Mr. Saxena', room: 'Chemistry Lab' },
					7: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					8: { subject: 'Biology', teacher: 'Mrs. Nair', room: 'Biology Lab' }
				},
				'Saturday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'Mathematics', teacher: 'Mr. Agarwal', room: 'Room 102' },
					3: { subject: 'Physics', teacher: 'Mr. Das', room: 'Physics Lab' },
					4: { subject: 'English', teacher: 'Mrs. Kapoor', room: 'Room 102' },
					5: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					6: { subject: 'History', teacher: 'Mr. Pillai', room: 'Room 102' },
					7: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					8: { subject: 'Computer Science', teacher: 'Ms. Sharma', room: 'Computer Lab' }
				}
			},
			'10-C': {
				'Monday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'Physics', teacher: 'Mrs. Iyer', room: 'Physics Lab' },
					3: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					4: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					5: { subject: 'History', teacher: 'Mr. Menon', room: 'Room 103' },
					6: { subject: 'Chemistry', teacher: 'Mr. Khan', room: 'Chemistry Lab' },
					7: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					8: { subject: 'Biology', teacher: 'Mrs. George', room: 'Biology Lab' }
				},
				'Tuesday': {
					1: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					2: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					3: { subject: 'Computer Science', teacher: 'Mr. Rajan', room: 'Computer Lab' },
					4: { subject: 'Physics', teacher: 'Mrs. Iyer', room: 'Physics Lab' },
					5: { subject: 'Geography', teacher: 'Mrs. Shetty', room: 'Room 103' },
					6: { subject: 'Biology', teacher: 'Mrs. George', room: 'Biology Lab' },
					7: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					8: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' }
				},
				'Wednesday': {
					1: { subject: 'Chemistry', teacher: 'Mr. Khan', room: 'Chemistry Lab' },
					2: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					3: { subject: 'Biology', teacher: 'Mrs. George', room: 'Biology Lab' },
					4: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					5: { subject: 'Physics', teacher: 'Mrs. Iyer', room: 'Physics Lab' },
					6: { subject: 'History', teacher: 'Mr. Menon', room: 'Room 103' },
					7: { subject: 'Computer Science', teacher: 'Mr. Rajan', room: 'Computer Lab' },
					8: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' }
				},
				'Thursday': {
					1: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					2: { subject: 'Physics', teacher: 'Mrs. Iyer', room: 'Physics Lab' },
					3: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					4: { subject: 'Chemistry', teacher: 'Mr. Khan', room: 'Chemistry Lab' },
					5: { subject: 'Computer Science', teacher: 'Mr. Rajan', room: 'Computer Lab' },
					6: { subject: 'Geography', teacher: 'Mrs. Shetty', room: 'Room 103' },
					7: { subject: 'Music', teacher: 'Mr. Roy', room: 'Music Room' },
					8: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' }
				},
				'Friday': {
					1: { subject: 'Biology', teacher: 'Mrs. George', room: 'Biology Lab' },
					2: { subject: 'Chemistry', teacher: 'Mr. Khan', room: 'Chemistry Lab' },
					3: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					4: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					5: { subject: 'History', teacher: 'Mr. Menon', room: 'Room 103' },
					6: { subject: 'Physics', teacher: 'Mrs. Iyer', room: 'Physics Lab' },
					7: { subject: 'Art', teacher: 'Ms. Mehra', room: 'Art Room' },
					8: { subject: 'Geography', teacher: 'Mrs. Shetty', room: 'Room 103' }
				},
				'Saturday': {
					1: { subject: 'Assembly', teacher: '', room: 'Ground' },
					2: { subject: 'English', teacher: 'Mr. Thomas', room: 'Room 103' },
					3: { subject: 'Chemistry', teacher: 'Mr. Khan', room: 'Chemistry Lab' },
					4: { subject: 'Mathematics', teacher: 'Mrs. Desai', room: 'Room 103' },
					5: { subject: 'Biology', teacher: 'Mrs. George', room: 'Biology Lab' },
					6: { subject: 'Computer Science', teacher: 'Mr. Rajan', room: 'Computer Lab' },
					7: { subject: 'Physical Education', teacher: 'Mr. Yadav', room: 'Ground' },
					8: { subject: 'History', teacher: 'Mr. Menon', room: 'Room 103' }
				}
			}
		};

		// Load custom subjects
		function loadCustomSubjects() {
			try {
				const data = localStorage.getItem(SUBJECTS_STORAGE_KEY);
				if (data) {
					customSubjects = JSON.parse(data);
				}
			} catch (e) {
				customSubjects = [];
			}
		}
		
		function saveCustomSubjects() {
			localStorage.setItem(SUBJECTS_STORAGE_KEY, JSON.stringify(customSubjects));
		}
		
		function renderSubjectDropdown() {
			const select = document.getElementById('subjectSelect');
			const currentValue = select.value;
			
			// Default subjects list
			const defaultSubjects = [
				{ value: 'Mathematics', text: 'üìê Mathematics' },
				{ value: 'Science', text: 'üî¨ Science' },
				{ value: 'English', text: 'üìö English' },
				{ value: 'History', text: 'üìú History' },
				{ value: 'Geography', text: 'üåç Geography' },
				{ value: 'Physics', text: '‚öõÔ∏è Physics' },
				{ value: 'Chemistry', text: 'üß™ Chemistry' },
				{ value: 'Biology', text: 'üß¨ Biology' },
				{ value: 'Computer Science', text: 'üíª Computer Science' },
				{ value: 'Physical Education', text: 'üèÉ Physical Education' },
				{ value: 'Art', text: 'üé® Art' },
				{ value: 'Music', text: 'üéµ Music' },
				{ value: 'Assembly', text: 'üè´ Assembly' }
			];
			
			// Clear and rebuild
			select.innerHTML = '<option value="">Select Subject</option>';
			
			// Add default subjects
			defaultSubjects.forEach(subject => {
				const option = document.createElement('option');
				option.value = subject.value;
				option.textContent = subject.text;
				select.appendChild(option);
			});
			
			// Add custom subjects
			customSubjects.forEach(subject => {
				const option = document.createElement('option');
				option.value = subject.name;
				const icon = subject.iconType === 'image' 
					? 'üñºÔ∏è'
					: subject.icon;
				option.textContent = `${icon} ${subject.name}`;
				option.dataset.custom = 'true';
				select.appendChild(option);
			});
			
			// Add "Add Subject" option at the end
			const addOption = document.createElement('option');
			addOption.value = '__add_subject__';
			addOption.textContent = '‚ûï Add New Subject';
			addOption.dataset.addSubject = 'true';
			select.appendChild(addOption);
			
			// Restore previous selection
			if (currentValue && currentValue !== '__add_subject__') {
				select.value = currentValue;
			}
		}
		
		// Subject dropdown change handler (set once)
		let subjectDropdownHandlerAttached = false;
		function setupSubjectDropdownHandler() {
			const select = document.getElementById('subjectSelect');
			if (!select) return;
			
			// Remove old listener if exists
			if (subjectDropdownHandlerAttached) {
				const newSelect = select.cloneNode(true);
				select.parentNode.replaceChild(newSelect, select);
			}
			
			// Add new listener
			const newSelect = document.getElementById('subjectSelect');
			if (newSelect) {
				newSelect.addEventListener('change', function() {
					if (this.value === '__add_subject__') {
						// Reset to empty
						this.value = '';
						openAddSubjectModal();
					}
				});
				subjectDropdownHandlerAttached = true;
			}
		}

		// DOM Elements
		const classSelect = document.getElementById('classSelect');
		const sectionSelect = document.getElementById('sectionSelect');
		const timetableGrid = document.getElementById('timetableGrid');
		const displayClass = document.getElementById('displayClass');
		const displaySection = document.getElementById('displaySection');
		const legendItems = document.getElementById('legendItems');
		const slotModal = document.getElementById('slotModal');
		const modalTitle = document.getElementById('modalTitle');
		const closeModal = document.getElementById('closeModal');
		const cancelBtn = document.getElementById('cancelBtn');
		const saveSlotBtn = document.getElementById('saveSlotBtn');
		const deleteSlotBtn = document.getElementById('deleteSlotBtn');
		const addSlotBtn = document.getElementById('addSlotBtn');
		const printBtn = document.getElementById('printBtn');
		const exportBtn = document.getElementById('exportBtn');
		
		// Add Subject Modal Elements
		const addSubjectModal = document.getElementById('addSubjectModal');
		const closeAddSubject = document.getElementById('closeAddSubject');
		const cancelAddSubject = document.getElementById('cancelAddSubject');
		const saveNewSubject = document.getElementById('saveNewSubject');
		const newSubjectName = document.getElementById('newSubjectName');
		const iconSelector = document.getElementById('iconSelector');
		const iconUploadArea = document.getElementById('iconUploadArea');
		const iconFileInput = document.getElementById('iconFileInput');
		const iconPreview = document.getElementById('iconPreview');

		// Load/Save Data
		function loadTimetableData() {
			try {
				const saved = localStorage.getItem(STORAGE_KEY);
				if (saved) {
					const data = JSON.parse(saved);
					// Merge with demo data - demo data fills in missing sections
					return { ...DEMO_DATA, ...data };
				}
			} catch (e) {}
			// Return demo data if no saved data
			return DEMO_DATA;
		}
		
		// Reset to demo data
		function resetTimetableData() {
			localStorage.removeItem(STORAGE_KEY);
			renderTimetable();
		}

		function saveTimetableData(data) {
			localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
		}

		// Render Functions
		function getSubjectColorClass(subjectName) {
			// Check if it's a custom subject
			const customSubject = customSubjects.find(s => s.name === subjectName);
			if (customSubject) {
				// Use a default color for custom subjects or assign based on name hash
				return 'subject-math'; // Default color, can be enhanced later
			}
			return SUBJECT_COLORS[subjectName] || 'subject-math';
		}

		function renderTimetable() {
			const cls = classSelect.value;
			const sec = sectionSelect.value;
			const key = `${cls}-${sec}`;
			const data = loadTimetableData();
			const schedule = data[key] || {};

			displayClass.textContent = cls;
			displaySection.textContent = sec;

			let html = '';

			// Header row
			html += '<div class="cell cell-header">Time</div>';
			DAYS.forEach(day => {
				html += `<div class="cell cell-header">${day}</div>`;
			});

			// Period rows
			PERIODS.forEach(period => {
				// Time cell
				if (period.isBreak) {
					html += `
						<div class="cell cell-time" style="background: linear-gradient(180deg, #fef3c7, #fde68a);">
							<div class="period-num">${period.num}</div>
							<div>${period.start}</div>
							<div style="font-size: 10px;">to ${period.end}</div>
						</div>`;
				} else {
					html += `
						<div class="cell cell-time">
							<div class="period-num">Period ${period.num}</div>
							<div>${period.start}</div>
							<div style="font-size: 10px;">to ${period.end}</div>
						</div>`;
				}

				// Day cells
				DAYS.forEach(day => {
					if (period.isBreak) {
						const breakType = period.num === 'Lunch' ? 'Lunch Break' : 'Break';
						const colorClass = period.num === 'Lunch' ? 'subject-lunch' : 'subject-break';
						html += `
							<div class="cell cell-slot" style="background: linear-gradient(180deg, #fef3c7, #fde68a);">
								<div class="subject-card ${colorClass}">
									<div class="subject-name">${breakType}</div>
								</div>
							</div>`;
					} else {
						const slot = schedule[day] && schedule[day][period.num];
						if (slot && slot.subject) {
							const colorClass = getSubjectColorClass(slot.subject);
							html += `
								<div class="cell cell-slot" data-day="${day}" data-period="${period.num}">
									<div class="subject-card ${colorClass}">
										<div class="subject-name">${slot.subject}</div>
										${slot.teacher ? `<div class="teacher-name">${slot.teacher}</div>` : ''}
										${slot.room ? `<div class="room-info">${slot.room}</div>` : ''}
									</div>
								</div>`;
						} else {
							html += `
								<div class="cell cell-slot empty" data-day="${day}" data-period="${period.num}">
									<i class="fas fa-plus" style="color: #cbd5e1; font-size: 16px;"></i>
								</div>`;
						}
					}
				});
			});

			timetableGrid.innerHTML = html;
			renderLegend();
			attachSlotListeners();
		}

		function renderLegend() {
			const items = Object.entries(SUBJECT_COLORS)
				.filter(([name]) => !['Break', 'Lunch Break', 'Assembly'].includes(name))
				.map(([name, colorClass]) => `
					<div class="legend-item">
						<div class="legend-color ${colorClass}"></div>
						<span>${name}</span>
					</div>
				`).join('');
			legendItems.innerHTML = items;
		}

		function attachSlotListeners() {
			document.querySelectorAll('.cell-slot[data-day]').forEach(cell => {
				cell.addEventListener('click', () => {
					const day = cell.dataset.day;
					const period = cell.dataset.period;
					openModal(day, period);
				});
			});
		}

		// Modal Functions
		function openModal(day = null, period = null) {
			const cls = classSelect.value;
			const sec = sectionSelect.value;
			const key = `${cls}-${sec}`;
			const data = loadTimetableData();
			
			// Refresh subject dropdown when opening modal to include any new custom subjects
			renderSubjectDropdown();
			setupSubjectDropdownHandler();
			
			// If day and period are provided (clicked from grid), use them
			if (day && period) {
				const slot = data[key]?.[day]?.[period];
				document.getElementById('editDay').value = day;
				document.getElementById('editPeriod').value = period;
				
				// Hide day/period selectors when editing from grid
				document.getElementById('daySelectContainer').style.display = 'none';
				document.getElementById('periodSelectContainer').style.display = 'none';
				document.getElementById('daySelect').value = day;
				document.getElementById('periodSelect').value = period;

				if (slot && slot.subject) {
					modalTitle.textContent = 'Edit Period';
					document.getElementById('subjectSelect').value = slot.subject;
					document.getElementById('teacherInput').value = slot.teacher || '';
					document.getElementById('roomInput').value = slot.room || '';
					deleteSlotBtn.style.display = 'flex';
				} else {
					modalTitle.textContent = 'Add Period';
					document.getElementById('subjectSelect').value = '';
					document.getElementById('teacherInput').value = '';
					document.getElementById('roomInput').value = '';
					deleteSlotBtn.style.display = 'none';
				}
			} else {
				// Opening from "Add Period" button - show day/period selectors
				modalTitle.textContent = 'Add Period';
				document.getElementById('editDay').value = '';
				document.getElementById('editPeriod').value = '';
				document.getElementById('daySelectContainer').style.display = 'block';
				document.getElementById('periodSelectContainer').style.display = 'block';
				document.getElementById('daySelect').value = '';
				document.getElementById('periodSelect').value = '';
				document.getElementById('subjectSelect').value = '';
				document.getElementById('teacherInput').value = '';
				document.getElementById('roomInput').value = '';
				deleteSlotBtn.style.display = 'none';
			}

			slotModal.classList.add('show');
		}

		function closeModalFn() {
			// Add closing class for collapse animation
			slotModal.classList.add('closing');
			slotModal.classList.remove('show');
			
			// Remove closing class after animation completes
			setTimeout(() => {
				slotModal.classList.remove('closing');
			}, 350);
		}

		function saveSlot() {
			// Get day and period - either from hidden inputs (grid click) or from selectors (Add Period button)
			let day = document.getElementById('editDay').value;
			let period = document.getElementById('editPeriod').value;
			
			// If not set (opened from Add Period button), get from selectors
			if (!day) day = document.getElementById('daySelect').value;
			if (!period) period = document.getElementById('periodSelect').value;
			
			const subject = document.getElementById('subjectSelect').value;
			const teacher = document.getElementById('teacherInput').value.trim();
			const room = document.getElementById('roomInput').value.trim();

			if (!day) {
				notify('Please select a day', 'error');
				return;
			}
			
			if (!period) {
				notify('Please select a period', 'error');
				return;
			}

			if (!subject) {
				notify('Please select a subject', 'error');
				return;
			}

			const cls = classSelect.value;
			const sec = sectionSelect.value;
			const key = `${cls}-${sec}`;
			const data = loadTimetableData();

			if (!data[key]) data[key] = {};
			if (!data[key][day]) data[key][day] = {};
			data[key][day][period] = { subject, teacher, room };

			saveTimetableData(data);
			closeModalFn();
			renderTimetable();
			notify('Period saved successfully', 'success');
		}

		function deleteSlot() {
			let day = document.getElementById('editDay').value;
			let period = document.getElementById('editPeriod').value;
			
			// If not set, get from selectors
			if (!day) day = document.getElementById('daySelect').value;
			if (!period) period = document.getElementById('periodSelect').value;
			
			if (!day || !period) {
				notify('Invalid day or period', 'error');
				return;
			}
			
			const cls = classSelect.value;
			const sec = sectionSelect.value;
			const key = `${cls}-${sec}`;
			const data = loadTimetableData();

			if (data[key]?.[day]?.[period]) {
				delete data[key][day][period];
				saveTimetableData(data);
				closeModalFn();
				renderTimetable();
				notify('Period removed', 'success');
			}
		}

		function notify(msg, type = 'success') {
			if (window.parent && typeof window.parent.showNotification === 'function') {
				window.parent.showNotification(msg, type);
			} else {
				alert(msg);
			}
		}

		// Export/Print
		function exportTimetable() {
			const cls = classSelect.value;
			const sec = sectionSelect.value;
			const key = `${cls}-${sec}`;
			const data = loadTimetableData();
			const schedule = data[key] || {};

			let csv = 'Time,' + DAYS.join(',') + '\n';
			PERIODS.forEach(period => {
				if (period.isBreak) {
					csv += `${period.start}-${period.end},` + DAYS.map(() => period.num === 'Lunch' ? 'Lunch Break' : 'Break').join(',') + '\n';
				} else {
					const row = [period.start + '-' + period.end];
					DAYS.forEach(day => {
						const slot = schedule[day]?.[period.num];
						row.push(slot ? `${slot.subject} (${slot.teacher || 'N/A'})` : '-');
					});
					csv += row.join(',') + '\n';
				}
			});

			const blob = new Blob([csv], { type: 'text/csv' });
			const a = document.createElement('a');
			a.href = URL.createObjectURL(blob);
			a.download = `timetable_class${cls}_${sec}.csv`;
			a.click();
		}

		// Subject dropdown change handler is now in renderSubjectDropdown function
		
		// Icon selector - use event delegation
		if (iconSelector) {
			iconSelector.addEventListener('click', function(e) {
				const iconOption = e.target.closest('.icon-option');
				if (iconOption) {
					// Remove previous selection
					iconSelector.querySelectorAll('.icon-option').forEach(opt => {
						opt.classList.remove('selected');
					});
					
					// Select clicked icon
					iconOption.classList.add('selected');
					selectedIcon = iconOption.dataset.icon;
					selectedIconType = 'emoji';
					selectedIconData = null;
					
					// Update preview
					iconPreview.innerHTML = selectedIcon;
					iconPreview.style.fontSize = '32px';
					iconPreview.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
					iconPreview.style.color = 'white';
					iconUploadArea.classList.remove('has-icon');
					if (iconFileInput) iconFileInput.value = '';
				}
			});
		}
		
		// Icon upload
		if (iconUploadArea) {
			iconUploadArea.addEventListener('click', function() {
				if (iconFileInput) {
					iconFileInput.click();
				}
			});
		}
		
		if (iconFileInput) {
			iconFileInput.addEventListener('change', function(e) {
				const file = e.target.files[0];
				if (file && file.type.startsWith('image/')) {
					// Validate file size (max 2MB)
					if (file.size > 2 * 1024 * 1024) {
						notify('Image size should be less than 2MB', 'error');
						return;
					}
					
					const reader = new FileReader();
					reader.onload = function(event) {
						selectedIconData = event.target.result;
						selectedIconType = 'image';
						selectedIcon = null;
						
						// Update preview
						iconPreview.innerHTML = `<img src="${selectedIconData}" alt="Custom Icon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">`;
						iconPreview.style.fontSize = 'auto';
						iconPreview.style.background = 'transparent';
						iconPreview.style.color = 'transparent';
						iconUploadArea.classList.add('has-icon');
						
						// Deselect emoji icons
						if (iconSelector) {
							iconSelector.querySelectorAll('.icon-option').forEach(opt => {
								opt.classList.remove('selected');
							});
						}
					};
					reader.onerror = function() {
						notify('Error reading image file', 'error');
					};
					reader.readAsDataURL(file);
				} else {
					notify('Please select a valid image file', 'error');
					this.value = '';
				}
			});
		}
		
		// Add Subject Modal Functions
		function openAddSubjectModal() {
			if (!addSubjectModal || !newSubjectName) return;
			
			// Reset form
			newSubjectName.value = '';
			selectedIcon = 'üìö';
			selectedIconType = 'emoji';
			selectedIconData = null;
			
			// Reset icon preview
			if (iconPreview) {
				iconPreview.innerHTML = selectedIcon;
				iconPreview.style.fontSize = '32px';
				iconPreview.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
				iconPreview.style.color = 'white';
			}
			
			if (iconUploadArea) {
				iconUploadArea.classList.remove('has-icon');
			}
			
			if (iconSelector) {
				iconSelector.querySelectorAll('.icon-option').forEach(opt => {
					opt.classList.remove('selected');
				});
			}
			
			if (iconFileInput) {
				iconFileInput.value = '';
			}
			
			// Show modal
			addSubjectModal.classList.add('show');
			setTimeout(() => {
				if (newSubjectName) newSubjectName.focus();
			}, 100);
		}
		
		function closeAddSubjectModal() {
			if (!addSubjectModal) return;
			addSubjectModal.classList.add('closing');
			addSubjectModal.classList.remove('show');
			setTimeout(() => {
				addSubjectModal.classList.remove('closing');
			}, 300);
		}
		
		function saveNewSubjectFn() {
			if (!newSubjectName) return;
			
			const name = newSubjectName.value.trim();
			
			if (!name) {
				notify('Please enter a subject name', 'error');
				if (newSubjectName) newSubjectName.focus();
				return;
			}
			
			// Validate icon selection
			if (selectedIconType === 'emoji' && !selectedIcon) {
				selectedIcon = 'üìö'; // Default icon
			}
			if (selectedIconType === 'image' && !selectedIconData) {
				notify('Please select or upload an icon', 'error');
				return;
			}
			
			// Check if subject already exists (check both default and custom)
			const subjectSelect = document.getElementById('subjectSelect');
			if (!subjectSelect) return;
			
			const allSubjects = Array.from(subjectSelect.options)
				.map(opt => opt.value)
				.filter(v => v && v !== '__add_subject__' && v !== '');
			
			if (allSubjects.includes(name)) {
				notify('This subject already exists', 'error');
				if (newSubjectName) newSubjectName.focus();
				return;
			}
			
			// Create new subject object
			const newSubject = {
				name: name,
				icon: selectedIconType === 'emoji' ? selectedIcon : selectedIconData,
				iconType: selectedIconType,
				createdAt: new Date().toISOString()
			};
			
			// Add to custom subjects
			customSubjects.push(newSubject);
			saveCustomSubjects();
			
			// Update dropdown
			renderSubjectDropdown();
			setupSubjectDropdownHandler();
			
			// Auto-select the new subject
			const updatedSelect = document.getElementById('subjectSelect');
			if (updatedSelect) {
				updatedSelect.value = name;
			}
			
			// Close modal
			closeAddSubjectModal();
			
			notify(`Subject "${name}" added successfully!`, 'success');
		}
		
		// Add Subject Modal Event Listeners
		if (closeAddSubject) {
			closeAddSubject.addEventListener('click', closeAddSubjectModal);
		}
		if (cancelAddSubject) {
			cancelAddSubject.addEventListener('click', closeAddSubjectModal);
		}
		if (saveNewSubject) {
			saveNewSubject.addEventListener('click', saveNewSubjectFn);
		}
		if (newSubjectName) {
			newSubjectName.addEventListener('keypress', (e) => {
				if (e.key === 'Enter') {
					e.preventDefault();
					saveNewSubjectFn();
				}
			});
		}
		window.addEventListener('click', (e) => {
			if (e.target === addSubjectModal) {
				closeAddSubjectModal();
			}
		});
		// Close on Escape key
		document.addEventListener('keydown', (e) => {
			if (e.key === 'Escape' && addSubjectModal && addSubjectModal.classList.contains('show')) {
				closeAddSubjectModal();
			}
		});

		// Event Listeners
		classSelect.addEventListener('change', renderTimetable);
		sectionSelect.addEventListener('change', renderTimetable);
		closeModal.addEventListener('click', closeModalFn);
		cancelBtn.addEventListener('click', closeModalFn);
		saveSlotBtn.addEventListener('click', saveSlot);
		deleteSlotBtn.addEventListener('click', deleteSlot);
		printBtn.addEventListener('click', () => window.print());
		exportBtn.addEventListener('click', exportTimetable);
		addSlotBtn.addEventListener('click', () => {
			openModal(); // Open modal without day/period - user will select from dropdowns
		});
		window.addEventListener('click', (e) => {
			if (e.target === slotModal) closeModalFn();
		});

		// Initialize
		document.addEventListener('DOMContentLoaded', () => {
			loadCustomSubjects();
			renderSubjectDropdown();
			setupSubjectDropdownHandler();
			renderTimetable();
		});
	</script>
</body>
</html>
