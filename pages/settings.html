<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Settings</title>
	<link rel="stylesheet" href="../style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		* { box-sizing: border-box; margin: 0; padding: 0; }
		html, body {
			width: 100%;
			max-width: 100%;
			overflow-x: hidden;
			overflow-y: auto;
		}
		body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; }

		/* Header - Reports & Analytics Style */
		.settings-header {
			background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
			padding: 28px 32px;
			border-radius: 20px;
			margin-bottom: 24px;
			color: white;
			display: flex;
			justify-content: space-between;
			align-items: center;
			position: relative;
			overflow: hidden;
		}
		.settings-header::before {
			content: '';
			position: absolute;
			top: -100px;
			right: -100px;
			width: 300px;
			height: 300px;
			background: rgba(255,255,255,0.05);
			border-radius: 50%;
		}
		.settings-header::after {
			content: '';
			position: absolute;
			bottom: -80px;
			left: 30%;
			width: 200px;
			height: 200px;
			background: rgba(255,255,255,0.03);
			border-radius: 50%;
		}
		.settings-header h1 {
			font-size: 26px;
			font-weight: 700;
			display: flex;
			align-items: center;
			gap: 12px;
		}
		.settings-header p { opacity: 0.85; font-size: 14px; margin-top: 6px; }
		.header-btn {
			padding: 12px 24px;
			background: #22c55e;
			color: white;
			border: none;
			border-radius: 10px;
			font-weight: 600;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s;
			z-index: 1;
		}
		.header-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4); }

		/* Page wrapper - Full Width */
		.settings-page {
			padding: 24px 24px 32px;
			width: 100%;
			max-width: 100%;
			margin: 0;
			overflow-x: hidden;
			overflow-y: visible;
			box-sizing: border-box;
		}

		/* Layout - Full Width with Horizontal Navigation */
		.settings-layout {
			display: flex;
			flex-direction: column;
			width: 100%;
			max-width: 100%;
			box-sizing: border-box;
			overflow: visible;
			padding: 0;
			gap: 0;
		}
		.settings-layout > * {
			min-width: 0;
			box-sizing: border-box;
		}

		/* Horizontal Navigation Bar - Modern Professional Design */
		.settings-sidebar {
			background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
			border-radius: 16px;
			padding: 0;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
			width: 100%;
			margin-bottom: 24px;
			color: #e2e8f0;
			backdrop-filter: blur(10px);
			overflow-x: auto;
			overflow-y: visible;
		}
		.sidebar-title {
			display: none; /* Hide title in horizontal layout */
		}
		.sidebar-nav {
			display: flex;
			flex-direction: row;
			gap: 4px;
			padding: 8px;
			align-items: center;
			flex-wrap: wrap;
		}
		.nav-item {
			padding: 14px 20px;
			border-radius: 12px;
			cursor: pointer;
			display: flex;
			align-items: center;
			gap: 10px;
			font-weight: 600;
			color: #cbd5e1;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			border: none;
			background: transparent;
			text-align: center;
			white-space: nowrap;
			font-size: 14px;
			position: relative;
			flex-shrink: 0;
		}
		.nav-item::before {
			content: '';
			position: absolute;
			bottom: 0;
			left: 50%;
			transform: translateX(-50%);
			width: 0;
			height: 3px;
			background: linear-gradient(90deg, #3b82f6, #2563eb);
			border-radius: 3px 3px 0 0;
			transition: width 0.3s ease;
		}
		.nav-item:hover {
			background: rgba(255, 255, 255, 0.08);
			color: #ffffff;
			transform: translateY(-2px);
		}
		.nav-item:hover::before {
			width: 60%;
		}
		.nav-item.active {
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			color: #ffffff;
			box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
			transform: translateY(0);
		}
		.nav-item.active::before {
			width: 80%;
		}
		.nav-item i { 
			width: 18px; 
			text-align: center; 
			font-size: 15px; 
			flex-shrink: 0;
		}

		/* Content - Full Width */
		.settings-content {
			display: flex;
			flex-direction: column;
			gap: 24px;
			width: 100%;
			max-width: 100%;
			min-width: 0;
			overflow: visible;
			box-sizing: border-box;
			flex: 1;
		}
		.settings-section {
			width: 100%;
			max-width: 100%;
		}
		.settings-section { 
			display: none !important; 
			width: 100%;
			max-width: 100%;
			min-width: 0;
			overflow: visible;
			box-sizing: border-box;
		}
		.settings-section.active { 
			display: block !important; 
			animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			width: 100%;
			max-width: 100%;
			min-width: 0;
			overflow: visible !important;
			box-sizing: border-box !important;
			min-height: calc(100vh - 300px);
		}
		#usersSection {
			overflow: visible !important;
		}
		#usersSection:not(.active) {
			display: none !important;
		}
		.settings-section .setting-card {
			margin-bottom: 24px;
		}
		.settings-section .setting-card:last-child {
			margin-bottom: 0;
		}
		@keyframes fadeIn { 
			from { 
				opacity: 0; 
				transform: translateY(10px); 
			} 
			to { 
				opacity: 1; 
				transform: translateY(0); 
			} 
		}
		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateX(-10px);
			}
			to {
				opacity: 1;
				transform: translateX(0);
			}
		}
		.settings-section.active {
			animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
		}
		.nav-item {
			animation: slideIn 0.3s ease backwards;
		}
		.nav-item:nth-child(1) { animation-delay: 0.05s; }
		.nav-item:nth-child(2) { animation-delay: 0.1s; }
		.nav-item:nth-child(3) { animation-delay: 0.15s; }
		.nav-item:nth-child(4) { animation-delay: 0.2s; }
		.nav-item:nth-child(5) { animation-delay: 0.25s; }
		.nav-item:nth-child(6) { animation-delay: 0.3s; }
		.nav-item:nth-child(7) { animation-delay: 0.35s; }
		.nav-item:nth-child(8) { animation-delay: 0.4s; }

		/* Cards - Reports & Analytics Style */
		.setting-card {
			background: #ffffff;
			border-radius: 16px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
			overflow: visible;
			border: 1px solid rgba(226, 232, 240, 0.8);
			width: 100%;
			max-width: 100%;
			min-width: 0;
			display: flex;
			flex-direction: column;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			box-sizing: border-box;
		}
		.setting-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 12px 30px rgba(0,0,0,0.12);
		}
		#usersSection .setting-card {
			overflow: visible !important;
			width: 100% !important;
			max-width: 100% !important;
		}
		#usersSection .setting-card .card-header {
			overflow: visible !important;
			width: 100% !important;
			max-width: 100% !important;
			box-sizing: border-box !important;
		}
		.setting-card::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
			background: linear-gradient(90deg, #1e3a5f, #2d5a87, #3b82f6);
			border-radius: 16px 16px 0 0;
			opacity: 0.9;
		}
		.setting-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 12px 30px rgba(0,0,0,0.12);
		}
		.setting-card .card-body {
			overflow-x: visible;
			overflow-y: visible;
		}
		.card-header {
			padding: 24px 28px;
			border-bottom: 1px solid rgba(226, 232, 240, 0.6);
			display: flex;
			justify-content: space-between;
			align-items: center;
			width: 100% !important;
			max-width: 100% !important;
			gap: 20px;
			flex-wrap: nowrap;
			background: linear-gradient(180deg, rgba(249, 250, 251, 0.5) 0%, rgba(255, 255, 255, 0) 100%);
			position: relative;
			z-index: 1;
			box-sizing: border-box !important;
			overflow: visible !important;
		}
		#usersSection .card-header {
			background: linear-gradient(180deg, rgba(249, 250, 251, 0.8) 0%, rgba(255, 255, 255, 0) 100%) !important;
		}
		.card-header .card-title {
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			max-width: calc(100% - 180px);
		}
		#usersSection .card-header .card-title {
			max-width: calc(100% - 180px) !important;
		}
		.card-header .card-title i {
			flex-shrink: 0;
		}
		.card-header .btn {
			flex-shrink: 0;
			white-space: nowrap;
			margin-left: auto;
			display: inline-flex !important;
			align-items: center;
			gap: 8px;
			box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
			position: relative;
			z-index: 2;
		}
		.card-header .btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
		}
		#addUserBtn {
			display: inline-flex !important;
			visibility: visible !important;
			opacity: 1 !important;
			position: relative !important;
			z-index: 10 !important;
			min-width: 140px;
			justify-content: center;
			height: auto;
			padding: 11px 22px;
			font-size: 14px;
			font-weight: 600;
			background: linear-gradient(135deg, #2563eb, #1d4ed8) !important;
			color: white !important;
			border: none !important;
			border-radius: 999px;
			cursor: pointer;
			box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3) !important;
		}
		#addUserBtn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4) !important;
		}
		#usersSection .card-header {
			position: relative !important;
			overflow: visible !important;
			min-height: 70px !important;
			display: flex !important;
			justify-content: space-between !important;
			align-items: center !important;
			width: 100% !important;
			max-width: 100% !important;
			padding: 24px 28px !important;
			box-sizing: border-box !important;
			z-index: 1;
			gap: 16px !important;
		}
		#usersSection .card-header * {
			box-sizing: border-box;
		}
		#usersSection .card-header::after {
			content: '';
			display: none;
		}
		/* Force Add User button visibility */
		#usersSection #addUserBtn {
			order: 2 !important;
			flex-shrink: 0 !important;
			flex-grow: 0 !important;
			display: inline-flex !important;
			visibility: visible !important;
			opacity: 1 !important;
			position: relative !important;
			z-index: 100 !important;
			margin-left: auto !important;
			min-width: 140px !important;
			max-width: none !important;
			width: auto !important;
			height: auto !important;
			padding: 12px 24px !important;
			box-sizing: border-box !important;
			white-space: nowrap !important;
		}
		#usersSection .card-header .card-title {
			order: 1 !important;
			flex: 1 1 auto !important;
			min-width: 0 !important;
			max-width: calc(100% - 180px) !important;
			overflow: hidden !important;
			text-overflow: ellipsis !important;
			white-space: nowrap !important;
		}
		/* Ensure button is never hidden */
		#usersSection #addUserBtn {
			flex: 0 0 auto !important;
			width: auto !important;
			max-width: none !important;
		}
		.card-title {
			font-size: 20px;
			font-weight: 700;
			color: #0f172a;
			display: flex;
			align-items: center;
			gap: 12px;
			min-width: 0;
			letter-spacing: -0.02em;
		}
		.card-title i { 
			color: #1e3a5f; 
			font-size: 22px;
			width: 50px;
			height: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #eff6ff;
			border-radius: 12px;
			flex-shrink: 0;
		}
		.card-title i.blue { background: #eff6ff; color: #3b82f6; }
		.card-title i.purple { background: #f3e8ff; color: #8b5cf6; }
		.card-title i.green { background: #f0fdf4; color: #22c55e; }
		.card-title i.orange { background: #fffbeb; color: #f59e0b; }
		.card-title i.red { background: #fef2f2; color: #ef4444; }
		.card-title i.cyan { background: #ecfeff; color: #06b6d4; }
		.card-body { 
			padding: 28px !important; 
			width: 100% !important;
			max-width: 100% !important;
			overflow: visible !important;
			background: #ffffff !important;
			display: block !important;
			min-height: auto !important;
			box-sizing: border-box !important;
		}
		.card-body > *:first-child {
			margin-top: 0;
		}
		.card-body > *:last-child {
			margin-bottom: 0;
		}
		.setting-card .card-body {
			display: block !important;
			visibility: visible !important;
			opacity: 1 !important;
			height: auto !important;
			min-height: 100px !important;
			padding: 28px !important;
			width: 100% !important;
			max-width: 100% !important;
			overflow: visible !important;
			box-sizing: border-box !important;
		}
		/* Ensure all tables are visible */
		.setting-card .data-table,
		.setting-card table {
			display: table !important;
			visibility: visible !important;
			opacity: 1 !important;
			width: 100% !important;
		}
		/* Ensure all buttons are visible */
		.setting-card .btn,
		.setting-card button {
			display: inline-flex !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		/* Ensure all form elements are visible */
		.setting-card .form-input,
		.setting-card .form-select,
		.setting-card .form-textarea,
		.setting-card input,
		.setting-card select,
		.setting-card textarea {
			display: block !important;
			visibility: visible !important;
			opacity: 1 !important;
		}

		/* School profile specific */
		.school-card-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.school-meta {
			display: flex;
			gap: 16px;
			font-size: 12px;
			color: #64748b;
		}
		.school-meta span {
			display: inline-flex;
			align-items: center;
			gap: 6px;
		}
		.school-meta i {
			color: #22c55e;
		}
		.school-layout {
			display: grid;
			grid-template-columns: minmax(0, 2.1fr) minmax(260px, 1fr);
			gap: 32px;
			align-items: flex-start;
			width: 100%;
			max-width: 100%;
			box-sizing: border-box;
			overflow: visible;
		}
		.school-main {
			border-right: 1px dashed #e2e8f0;
			padding-right: 24px;
			width: 100%;
			max-width: 100%;
			box-sizing: border-box;
			overflow: visible;
			min-width: 0;
		}
		.school-logo-panel {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 20px;
			width: 100%;
			max-width: 100%;
			box-sizing: border-box;
			overflow: visible;
			min-width: 0;
			padding: 20px;
			background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
			border-radius: 16px;
			border: 1px solid rgba(226, 232, 240, 0.8);
		}
		.school-logo-preview {
			width: 160px;
			height: 160px;
			border-radius: 20px;
			border: 3px dashed #cbd5e1;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(145deg, #ffffff, #f8fafc);
			color: #2563eb;
			font-weight: 800;
			font-size: 48px;
			text-transform: uppercase;
			box-shadow: 0 8px 24px rgba(37, 99, 235, 0.15), inset 0 2px 4px rgba(0, 0, 0, 0.05);
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			overflow: hidden;
		}
		.school-logo-preview:hover {
			border-color: #3b82f6;
			box-shadow: 0 12px 32px rgba(37, 99, 235, 0.25), inset 0 2px 4px rgba(0, 0, 0, 0.05);
			transform: translateY(-2px);
		}
		.school-logo-preview span {
			z-index: 1;
			position: relative;
		}
		.school-logo-panel .form-hint {
			text-align: left;
		}
		.school-section-label {
			font-size: 12px;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.08em;
			color: #94a3b8;
			margin-bottom: 6px;
		}
		.logo-upload-row {
			display: flex;
			flex-direction: column;
			align-items: stretch;
			gap: 12px;
			margin-top: 8px;
			width: 100%;
		}
		.logo-upload-row .btn {
			width: 100%;
			justify-content: center;
			padding: 14px 20px;
			font-weight: 600;
			border: 2px solid #e2e8f0;
			background: #ffffff;
			color: #475569;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}
		.logo-upload-row .btn:hover {
			border-color: #3b82f6;
			background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
			color: white;
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
		}
		.logo-file-name {
			font-size: 13px;
			color: #64748b;
			text-align: center;
			padding: 8px 12px;
			background: #f8fafc;
			border-radius: 8px;
			border: 1px solid #e2e8f0;
			width: 100%;
			box-sizing: border-box;
			min-height: 36px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		/* Profile Details Tab - Compact Professional Design */
		.profile-details-hero {
			background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
			border-radius: 12px;
			padding: 16px 20px;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 12px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
			position: relative;
			overflow: hidden;
		}
		.profile-hero-icon {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			background: rgba(255, 255, 255, 0.15);
			backdrop-filter: blur(10px);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 18px;
			color: #ffffff;
			flex-shrink: 0;
			position: relative;
			z-index: 1;
		}
		.profile-hero-content {
			position: relative;
			z-index: 1;
			flex: 1;
		}
		.profile-hero-title {
			font-size: 16px;
			font-weight: 700;
			color: #ffffff;
			margin: 0 0 4px 0;
			letter-spacing: -0.3px;
		}
		.profile-hero-subtitle {
			font-size: 12px;
			color: rgba(255, 255, 255, 0.85);
			margin: 0;
			line-height: 1.4;
		}
		.profile-type-selector-card {
			background: #ffffff;
			border-radius: 10px;
			padding: 12px 14px;
			margin-bottom: 12px;
			border: 1px solid #e2e8f0;
			box-shadow: 0 1px 3px rgba(0,0,0,0.04);
			transition: all 0.2s ease;
		}
		.profile-type-selector-card:hover {
			border-color: #cbd5e1;
			box-shadow: 0 2px 6px rgba(0,0,0,0.06);
		}
		.profile-type-selector-header {
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 10px;
		}
		.profile-type-icon {
			width: 28px;
			height: 28px;
			border-radius: 6px;
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #ffffff;
			font-size: 13px;
			flex-shrink: 0;
		}
		.profile-type-label {
			font-size: 12px;
			font-weight: 700;
			color: #1e293b;
			margin: 0;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.profile-type-hint {
			font-size: 11px;
			color: #64748b;
			margin-top: 2px;
		}
		.profile-type-select {
			width: 100%;
			padding: 8px 12px;
			height: 38px;
			border: 1px solid #e2e8f0;
			border-radius: 8px;
			font-size: 13px;
			font-weight: 500;
			color: #1e293b;
			background: #ffffff;
			cursor: pointer;
			transition: all 0.2s ease;
			appearance: none;
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%2364748b' d='M5 7L1 3h8z'/%3E%3C/svg%3E");
			background-repeat: no-repeat;
			background-position: right 10px center;
			padding-right: 32px;
		}
		.profile-type-select:hover {
			border-color: #3b82f6;
			background-color: #f8fafc;
		}
		.profile-type-select:focus {
			outline: none;
			border-color: #3b82f6;
			box-shadow: 0 0 0 3px rgba(59,130,246,0.1);
			background-color: #ffffff;
		}
		/* Profile Accordion Cards - Progressive Disclosure */
		.profile-accordion-card {
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			margin-bottom: 12px;
			overflow: hidden;
			transition: all 0.3s ease;
			box-shadow: 0 1px 3px rgba(0,0,0,0.05);
			display: none;
		}
		.profile-accordion-card:not([style*="display: none"]) {
			display: block;
		}
		.profile-accordion-card:hover {
			box-shadow: 0 2px 8px rgba(0,0,0,0.08);
		}
		.profile-accordion-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 10px 12px;
			cursor: pointer;
			transition: all 0.2s ease;
			background: #f8fafc;
			border-bottom: 1px solid #e2e8f0;
		}
		.profile-accordion-header:hover {
			background: #f1f5f9;
		}
		.profile-accordion-header.active {
			background: #eff6ff;
			border-bottom-color: #3b82f6;
		}
		.accordion-header-left {
			display: flex;
			align-items: center;
			gap: 10px;
			flex: 1;
		}
		.accordion-header-left i {
			width: 28px;
			height: 28px;
			border-radius: 6px;
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #ffffff;
			font-size: 13px;
			flex-shrink: 0;
		}
		.accordion-title {
			display: block;
			font-size: 13px;
			font-weight: 700;
			color: #1e293b;
			margin-bottom: 1px;
		}
		.accordion-subtitle {
			display: block;
			font-size: 11px;
			color: #64748b;
		}
		.accordion-arrow {
			font-size: 12px;
			color: #64748b;
			transition: transform 0.3s ease;
			flex-shrink: 0;
		}
		.profile-accordion-header.active .accordion-arrow {
			transform: rotate(180deg);
			color: #1e3a5f;
		}
		.profile-accordion-body {
			max-height: 0;
			overflow: hidden;
			transition: max-height 0.3s ease, padding 0.3s ease;
			padding: 0 12px;
		}
		.profile-accordion-body.active {
			max-height: 2000px;
			padding: 12px;
		}
		.profile-form-section {
			margin-bottom: 16px;
		}
		.profile-form-section:last-child {
			margin-bottom: 0;
		}
		.form-grid-compact {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 12px;
		}
		.form-grid-compact .form-group.full {
			grid-column: 1 / -1;
		}
		@media (max-width: 768px) {
			.form-grid-compact {
				grid-template-columns: 1fr;
			}
		}
		.documents-section {
			margin-top: 20px;
			padding-top: 20px;
			border-top: 1px solid #e2e8f0;
		}
		.documents-section-header {
			display: flex;
			align-items: flex-start;
			gap: 12px;
			margin-bottom: 16px;
		}
		.documents-header-icon {
			width: 36px;
			height: 36px;
			border-radius: 8px;
			background: #eff6ff;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #3b82f6;
			font-size: 16px;
			flex-shrink: 0;
		}
		.documents-header-content {
			flex: 1;
		}
		.documents-title {
			font-size: 15px;
			font-weight: 700;
			color: #1e293b;
			margin: 0 0 6px 0;
		}
		.documents-description {
			font-size: 12px;
			color: #64748b;
			margin: 0;
			line-height: 1.5;
		}
		.document-upload-area {
			background: #f8fafc;
			border: 1px dashed #cbd5e1;
			border-radius: 10px;
			padding: 14px;
			transition: all 0.2s ease;
			text-align: center;
			position: relative;
			overflow: hidden;
		}
		.document-upload-area:hover {
			border-color: #3b82f6;
			background: #eff6ff;
		}
		.document-upload-content {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 8px;
			margin-bottom: 12px;
		}
		.document-upload-icon-wrapper {
			width: 36px;
			height: 36px;
			border-radius: 8px;
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #ffffff;
			font-size: 16px;
			flex-shrink: 0;
		}
		.document-upload-text {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 3px;
		}
		.document-upload-title {
			font-size: 13px;
			font-weight: 700;
			color: #1e293b;
			margin: 0;
		}
		.document-upload-subtitle {
			font-size: 11px;
			color: #64748b;
			margin: 0;
		}
		.document-upload-formats {
			display: flex;
			gap: 6px;
			margin-top: 8px;
			flex-wrap: wrap;
			justify-content: center;
		}
		.format-badge {
			padding: 4px 10px;
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 6px;
			font-size: 11px;
			font-weight: 600;
			color: #3b82f6;
		}
		.document-upload-button {
			padding: 8px 16px;
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			color: #ffffff;
			border: none;
			border-radius: 8px;
			font-size: 12px;
			font-weight: 600;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			transition: all 0.2s ease;
			box-shadow: 0 1px 4px rgba(30,58,95,0.2);
		}
		.document-upload-button:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(59,130,246,0.4);
		}
		.document-upload-button:active {
			transform: translateY(0);
		}
		.uploaded-documents-list {
			margin-top: 16px;
			display: grid;
			gap: 10px;
		}
		.document-item {
			background: white;
			border: 1px solid #e2e8f0;
			border-radius: 10px;
			padding: 12px 16px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 12px;
			transition: all 0.2s ease;
		}
		.document-item:hover {
			box-shadow: 0 4px 12px rgba(0,0,0,0.08);
			border-color: #3b82f6;
		}
		.document-item-info {
			display: flex;
			align-items: center;
			gap: 12px;
			flex: 1;
		}
		.document-item-icon {
			width: 40px;
			height: 40px;
			border-radius: 8px;
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 16px;
		}
		.document-item-details {
			flex: 1;
		}
		.document-item-name {
			font-weight: 600;
			color: #1e293b;
			font-size: 14px;
			margin-bottom: 2px;
		}
		.document-item-size {
			font-size: 12px;
			color: #64748b;
		}
		.document-item-actions {
			display: flex;
			gap: 8px;
		}
		.document-item-btn {
			width: 32px;
			height: 32px;
			border-radius: 8px;
			border: none;
			background: #f1f5f9;
			color: #64748b;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
		}
		.document-item-btn:hover {
			background: #fee2e2;
			color: #dc2626;
		}
		.document-item-btn.view:hover {
			background: #dbeafe;
			color: #2563eb;
		}
		@media (max-width: 900px) {
			.school-layout {
				grid-template-columns: 1fr;
			}
			.school-main {
				border-right: none;
				padding-right: 0;
				border-bottom: 1px dashed #e2e8f0;
				padding-bottom: 16px;
				margin-bottom: 16px;
			}
		}

		/* Profile Details Tab - Ultra Premium Modern Design */
		.tab-profile {
			padding: 24px 32px !important;
			background: #f8fafc;
		}
		.profile-premium-container {
			max-width: 950px;
			margin: 0 auto;
		}
		.premium-section-card {
			background: #ffffff;
			border-radius: 14px;
			margin-bottom: 20px;
			box-shadow: 0 2px 12px rgba(0,0,0,0.06);
			overflow: hidden;
			transition: all 0.25s ease;
			border: 1px solid #e5e7eb;
		}
		.premium-section-card:hover {
			box-shadow: 0 4px 20px rgba(0,0,0,0.1);
		}
		.premium-card-header {
			display: flex;
			align-items: center;
			gap: 14px;
			padding: 18px 24px;
			background: #ffffff;
			border-bottom: 1px solid #f1f5f9;
		}
		.premium-icon-badge {
			width: 48px;
			height: 48px;
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 20px;
			flex-shrink: 0;
			background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
			color: #ffffff;
			box-shadow: 0 2px 8px rgba(30,58,95,0.2);
		}
		.premium-icon-badge.student-badge {
			background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
		}
		.premium-icon-badge.teacher-badge {
			background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
		}
		.premium-icon-badge.document-badge {
			background: linear-gradient(135deg, #10b981 0%, #059669 100%);
		}
		.premium-header-content {
			flex: 1;
		}
		.premium-card-title {
			font-size: 17px;
			font-weight: 700;
			color: #111827;
			margin: 0 0 4px 0;
		}
		.premium-card-subtitle {
			font-size: 12px;
			color: #6b7280;
			margin: 0;
			line-height: 1.4;
		}
		.premium-card-body {
			padding: 24px;
		}
		.premium-select-group {
			position: relative;
		}
		.premium-select {
			width: 100%;
			padding: 13px 16px;
			border: 1.5px solid #d1d5db;
			border-radius: 10px;
			background: #ffffff;
			font-size: 14px;
			font-weight: 500;
			color: #111827;
			cursor: pointer;
			transition: all 0.2s ease;
			appearance: none;
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%23475569' d='M7 10L2 5h10z'/%3E%3C/svg%3E");
			background-repeat: no-repeat;
			background-position: right 16px center;
			padding-right: 45px;
		}
		.premium-select:hover {
			border-color: #9ca3af;
		}
		.premium-select:focus {
			outline: none;
			border-color: #1e3a5f;
			box-shadow: 0 0 0 3px rgba(30,58,95,0.1);
		}
		.premium-form-grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 20px;
		}
		.premium-form-field {
			display: flex;
			flex-direction: column;
		}
		.premium-field-label {
			display: flex;
			align-items: center;
			gap: 7px;
			font-size: 12px;
			font-weight: 600;
			color: #374151;
			margin-bottom: 8px;
		}
		.premium-field-label i {
			color: #1e3a5f;
			font-size: 13px;
		}
		.required-star {
			color: #ef4444;
			margin-left: 2px;
		}
		.premium-field-input {
			padding: 12px 14px;
			border: 1.5px solid #d1d5db;
			border-radius: 10px;
			background: #ffffff;
			font-size: 14px;
			color: #111827;
			transition: all 0.2s ease;
			font-weight: 500;
		}
		.premium-field-input:hover {
			border-color: #9ca3af;
		}
		.premium-field-input:focus {
			outline: none;
			border-color: #1e3a5f;
			box-shadow: 0 0 0 3px rgba(30,58,95,0.1);
		}
		.premium-field-input::placeholder {
			color: #9ca3af;
			font-weight: 400;
		}
		.premium-error-msg {
			font-size: 11px;
			color: #ef4444;
			margin-top: 6px;
			display: none;
		}
		.premium-error-msg.show {
			display: block;
		}
		.premium-field-input.error {
			border-color: #ef4444;
		}
		.premium-field-input.error:focus {
			box-shadow: 0 0 0 3px rgba(239,68,68,0.1);
		}
		.premium-upload-zone {
			border: 2px dashed #d1d5db;
			border-radius: 12px;
			padding: 36px 24px;
			text-align: center;
			background: #f9fafb;
			transition: all 0.2s ease;
			cursor: pointer;
		}
		.premium-upload-zone:hover {
			border-color: #1e3a5f;
			background: #f3f4f6;
		}
		.premium-upload-zone.drag-over {
			border-color: #1e3a5f;
			background: #e9e6ff;
		}
		.premium-upload-icon {
			font-size: 44px;
			color: #6b7280;
			margin-bottom: 12px;
		}
		.premium-upload-title {
			font-size: 16px;
			font-weight: 700;
			color: #111827;
			margin: 0 0 6px 0;
		}
		.premium-upload-subtitle {
			font-size: 13px;
			color: #6b7280;
			margin: 0 0 16px 0;
		}
		.premium-upload-btn {
			padding: 12px 28px;
			background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
			color: #ffffff;
			border: none;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 600;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s ease;
			box-shadow: 0 2px 8px rgba(30,58,95,0.2);
		}
		.premium-upload-btn:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(30,58,95,0.3);
		}
		.premium-upload-hint {
			font-size: 11px;
			color: #6b7280;
			margin-top: 16px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 6px;
		}
		.premium-upload-hint i {
			font-size: 12px;
			color: #1e3a5f;
		}
		.premium-files-list {
			margin-top: 20px;
			display: flex;
			flex-direction: column;
			gap: 10px;
		}
		.uploaded-file-chip {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 12px 16px;
			background: #f9fafb;
			border: 1px solid #e5e7eb;
			border-radius: 10px;
			animation: slideIn 0.3s ease;
			transition: all 0.2s ease;
		}
		.uploaded-file-chip:hover {
			border-color: #d1d5db;
			box-shadow: 0 1px 4px rgba(0,0,0,0.05);
		}
		@keyframes slideIn {
			from {
				opacity: 0;
				transform: translateX(-15px);
			}
			to {
				opacity: 1;
				transform: translateX(0);
			}
		}
		.file-chip-info {
			display: flex;
			align-items: center;
			gap: 12px;
			flex: 1;
		}
		.file-chip-icon {
			width: 38px;
			height: 38px;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 16px;
			flex-shrink: 0;
		}
		.file-chip-icon.pdf {
			background: #fee2e2;
			color: #dc2626;
		}
		.file-chip-icon.img {
			background: #dbeafe;
			color: #2563eb;
		}
		.file-chip-name {
			font-size: 13px;
			font-weight: 600;
			color: #111827;
			flex: 1;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}
		.file-chip-size {
			font-size: 11px;
			color: #6b7280;
			margin-left: 10px;
		}
		.file-chip-delete {
			width: 32px;
			height: 32px;
			border: none;
			background: transparent;
			color: #ef4444;
			cursor: pointer;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s ease;
			flex-shrink: 0;
		}
		.file-chip-delete:hover {
			background: #fee2e2;
		}
		@media (max-width: 1024px) {
			.premium-form-grid {
				grid-template-columns: repeat(2, 1fr);
			}
		}
		@media (max-width: 768px) {
			.premium-form-grid {
				grid-template-columns: 1fr;
			}
			.tab-profile {
				padding: 20px 16px !important;
			}
			.premium-card-header {
				padding: 16px 20px;
			}
			.premium-card-body {
				padding: 20px;
			}
			.premium-icon-badge {
				width: 42px;
				height: 42px;
				font-size: 18px;
			}
		}

		/* Form Elements */
		.form-grid {
			display: grid !important;
			grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
			gap: 24px 28px !important;
			align-items: start !important;
			width: 100% !important;
			max-width: 100% !important;
			box-sizing: border-box !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		.form-group {
			display: flex !important;
			flex-direction: column !important;
			gap: 8px !important;
			width: 100% !important;
			min-width: 0 !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		.form-group.full { 
			grid-column: span 2; 
			width: 100%;
		}
		.form-label {
			font-size: 14px;
			font-weight: 600;
			color: #1e293b;
			margin-bottom: 8px;
			letter-spacing: -0.01em;
		}
		.form-input, .form-select, .form-textarea {
			padding: 12px 16px;
			border: 2px solid #e2e8f0;
			border-radius: 12px;
			font-size: 14px;
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 2px rgba(255, 255, 255, 0.8);
			width: 100%;
			box-sizing: border-box;
			color: #1e293b;
			font-weight: 500;
		}
		.form-input:hover, .form-select:hover, .form-textarea:hover {
			border-color: #cbd5e1;
			box-shadow: 0 4px 16px rgba(102, 126, 234, 0.12), inset 0 1px 2px rgba(255, 255, 255, 0.9);
			background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 50%, #ffffff 100%);
			transform: translateY(-2px);
		}
		.form-input:focus, .form-select:focus, .form-textarea:focus {
			outline: none;
			border-color: #667eea;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15), 0 8px 24px rgba(102, 126, 234, 0.25), inset 0 1px 2px rgba(255, 255, 255, 1);
			background: #ffffff;
			transform: translateY(-3px);
		}
		.form-input::placeholder, .form-textarea::placeholder {
			color: #94a3b8;
			font-size: 13px;
			font-weight: 400;
			opacity: 0.8;
		}
		.form-input:focus::placeholder, .form-textarea:focus::placeholder {
			opacity: 0.5;
		}
		.form-select {
			cursor: pointer;
			appearance: none;
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%23667eea' d='M7 10L2 5h10z'/%3E%3C/svg%3E");
			background-repeat: no-repeat;
			background-position: right 16px center;
			padding-right: 42px;
		}
		.form-select:hover {
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%23764ba2' d='M7 10L2 5h10z'/%3E%3C/svg%3E");
		}
		.form-select:focus {
			background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 14 14'%3E%3Cpath fill='%23764ba2' d='M7 4L12 9H2z'/%3E%3C/svg%3E");
		}
		.form-textarea { min-height: 100px; resize: vertical; }
		.form-hint { 
			font-size: 12px; 
			color: #64748b; 
			margin-top: 6px;
			line-height: 1.5;
		}

		/* Toggle Switch */
		.toggle-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 20px 0;
			border-bottom: 1px solid rgba(226, 232, 240, 0.6);
			transition: background 0.2s ease;
			border-radius: 12px;
			margin: 0 -8px;
			padding-left: 8px;
			padding-right: 8px;
		}
		.toggle-row:hover {
			background: rgba(249, 250, 251, 0.5);
		}
		.toggle-row:last-child { border-bottom: none; }
		.toggle-info h4 { 
			font-size: 15px; 
			font-weight: 600; 
			color: #0f172a; 
			margin-bottom: 6px; 
			letter-spacing: -0.01em;
		}
		.toggle-info p { 
			font-size: 13px; 
			color: #64748b; 
			line-height: 1.5;
		}
		.toggle-switch {
			position: relative;
			width: 56px;
			height: 32px;
		}
		.toggle-switch input { display: none; }
		.toggle-slider {
			position: absolute;
			inset: 0;
			background: #cbd5e1;
			border-radius: 28px;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
		}
		.toggle-slider::before {
			content: '';
			position: absolute;
			width: 24px;
			height: 24px;
			left: 4px;
			top: 4px;
			background: white;
			border-radius: 50%;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.1);
		}
		.toggle-switch input:checked + .toggle-slider { 
			background: linear-gradient(135deg, #10b981, #059669);
			box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1), inset 0 2px 4px rgba(0, 0, 0, 0.1);
		}
		.toggle-switch input:checked + .toggle-slider::before { 
			transform: translateX(24px);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25), 0 1px 2px rgba(0, 0, 0, 0.15);
		}

		/* Buttons */
		.btn {
			padding: 12px 24px;
			border-radius: 12px;
			font-weight: 600;
			font-size: 14px;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			gap: 8px;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			border: none;
			letter-spacing: -0.01em;
			position: relative;
			overflow: hidden;
		}
		.btn::before {
			content: '';
			position: absolute;
			top: 50%;
			left: 50%;
			width: 0;
			height: 0;
			border-radius: 50%;
			background: rgba(255, 255, 255, 0.2);
			transform: translate(-50%, -50%);
			transition: width 0.6s, height 0.6s;
		}
		.btn:hover::before {
			width: 300px;
			height: 300px;
		}
		.btn-primary { 
			background: linear-gradient(135deg, #3b82f6, #2563eb); 
			color: white; 
			box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
		}
		.btn-primary:hover {
			background: linear-gradient(135deg, #2563eb, #1d4ed8);
			box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
			transform: translateY(-2px) scale(1.02);
		}
		.btn-primary:active {
			transform: translateY(0) scale(1);
		}
		.btn-success { 
			background: linear-gradient(135deg, #22c55e, #16a34a); 
			color: white; 
		}
		.btn-success:hover {
			transform: translateY(-2px) scale(1.05);
			box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
		}
		.btn-danger { 
			background: linear-gradient(135deg, #ef4444, #dc2626); 
			color: white; 
		}
		.btn-danger:hover {
			transform: translateY(-2px) scale(1.05);
			box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
		}
		.btn-secondary { 
			background: rgba(255,255,255,0.15); 
			color: #374151; 
			border: 1px solid rgba(226, 232, 240, 0.5);
		}
		.btn-secondary:hover { 
			background: #f1f5f9; 
			transform: translateY(-2px); 
			box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
		}
		.btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
		.btn-group { 
			display: flex !important; 
			gap: 12px !important; 
			margin-top: 32px !important; 
			align-items: center !important;
			flex-wrap: wrap !important;
			padding-top: 24px !important;
			border-top: 1px solid rgba(226, 232, 240, 0.6) !important;
			visibility: visible !important;
			opacity: 1 !important;
			width: 100% !important;
			box-sizing: border-box !important;
		}
		.btn-group .btn {
			flex-shrink: 0 !important;
			position: relative !important;
			z-index: 1 !important;
			display: inline-flex !important;
			visibility: visible !important;
			opacity: 1 !important;
		}

		/* Data Table - Modern Professional Design */
		.data-table {
			width: 100% !important;
			border-collapse: separate !important;
			border-spacing: 0 !important;
			background: white !important;
			border-radius: 12px !important;
			overflow: visible !important;
			box-shadow: 0 1px 3px rgba(0,0,0,0.05) !important;
			display: table !important;
			table-layout: auto !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		.data-table th {
			background: linear-gradient(135deg, #4A6CF7 0%, #34495E 100%);
			padding: 16px 20px;
			text-align: left;
			font-weight: 700;
			color: white;
			font-size: 13px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			border: none;
			position: relative;
			user-select: none;
		}
		.data-table th .resize-handle {
			position: absolute;
			right: 0;
			top: 0;
			width: 4px;
			height: 100%;
			cursor: col-resize;
			background: rgba(255, 255, 255, 0.2);
			transition: background 0.2s;
		}
		.data-table th .resize-handle:hover {
			background: rgba(255, 255, 255, 0.5);
		}
		.data-table th.resizing {
			background: linear-gradient(135deg, #3A5CE7 0%, #2C3E50 100%);
		}
		.data-table th:first-child {
			border-top-left-radius: 12px;
		}
		.data-table th:last-child {
			border-top-right-radius: 12px;
		}
		.data-table th:not(:last-child)::after {
			content: '';
			position: absolute;
			right: 0;
			top: 20%;
			height: 60%;
			width: 1px;
			background: rgba(255,255,255,0.2);
		}
		.data-table td {
			padding: 10px 12px;
			border-bottom: 1px solid #f1f5f9;
			color: #334155;
			font-size: 12px;
			background: white;
			transition: all 0.2s ease;
		}
		.data-table th {
			padding: 12px 12px;
			font-size: 11px;
			font-weight: 700;
		}
		/* Filter Row Styles */
		.table-filters {
			background: #f8fafc;
			padding: 10px 12px;
			border-bottom: 2px solid #e2e8f0;
			display: grid;
			grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
			gap: 8px;
			align-items: center;
		}
		.filter-cell {
			display: flex;
			flex-direction: column;
		}
		.table-filter-input,
		.table-filter-select {
			width: 100%;
			padding: 7px 10px;
			border: 1px solid #e2e8f0;
			border-radius: 6px;
			font-size: 11px;
			background: white;
			transition: all 0.2s;
		}
		.table-filter-input:focus,
		.table-filter-select:focus {
			outline: none;
			border-color: #4A6CF7;
			box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.1);
		}
		.filter-count {
			font-size: 9px;
			color: #64748b;
			margin-top: 3px;
			text-align: center;
			font-weight: 600;
		}
		.filter-count.active {
			color: #4A6CF7;
			font-weight: 700;
		}
		.data-table tbody tr {
			transition: all 0.2s ease;
		}
		.data-table tbody tr:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(0,0,0,0.08);
		}
		.data-table tbody tr:hover td {
			background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
		}
		.data-table tbody tr:last-child td:first-child {
			border-bottom-left-radius: 12px;
		}
		.data-table tbody tr:last-child td:last-child {
			border-bottom-right-radius: 12px;
		}
		.data-table tbody tr:last-child td {
			border-bottom: none;
		}
		
		/* Enhanced table cell content */
		.data-table td strong {
			color: #1e293b;
			font-weight: 700;
			font-size: 13px;
			letter-spacing: 0.3px;
		}
		.data-table td:first-child {
			font-weight: 600;
		}
		
		/* Column width constraints for User Management table - Resizable */
		#usersTable th:nth-child(1),
		#usersTable td:nth-child(1) {
			width: 10% !important;
			min-width: 120px !important;
		}
		#usersTable th:nth-child(2),
		#usersTable td:nth-child(2) {
			width: 12% !important;
			min-width: 100px !important;
		}
		#usersTable th:nth-child(3),
		#usersTable td:nth-child(3) {
			width: 15% !important;
			min-width: 120px !important;
		}
		#usersTable th:nth-child(4),
		#usersTable td:nth-child(4) {
			width: 18% !important;
			min-width: 200px !important;
		}
		#usersTable th:nth-child(5),
		#usersTable td:nth-child(5) {
			width: 10% !important;
			min-width: 90px !important;
			max-width: 110px !important;
		}
		#usersTable th:nth-child(6),
		#usersTable td:nth-child(6) {
			width: 10% !important;
			min-width: 90px !important;
			max-width: 110px !important;
		}
		#usersTable th:nth-child(7),
		#usersTable td:nth-child(7) {
			width: 12% !important;
			min-width: 100px !important;
			max-width: 130px !important;
		}
		#usersTable th:nth-child(8),
		#usersTable td:nth-child(8) {
			width: 13% !important;
			min-width: 110px !important;
			max-width: 140px !important;
			text-align: center;
		}
		#usersTable td:nth-child(8) .action-btn-group {
			justify-content: center;
		}
		
		/* Enhanced styling for Role, Status, Last Login columns */
		#usersTable td:nth-child(5),
		#usersTable td:nth-child(6) {
			vertical-align: middle;
			overflow: visible;
		}
		#usersTable td:nth-child(7) {
			vertical-align: middle;
		}
		
		/* Column header enhancements */
		#usersTable th:nth-child(5),
		#usersTable th:nth-child(6),
		#usersTable th:nth-child(7),
		#usersTable th:nth-child(8) {
			text-align: center;
		}
		
		/* Ensure badges are always visible */
		#usersTable td .badge {
			display: inline-flex !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		
		/* Better spacing for action buttons */
		.action-btn-group {
			flex-wrap: nowrap;
		}
		
		/* Table layout - Auto for resizable columns */
		#usersTable {
			table-layout: auto;
			width: 100%;
		}
		
		/* Text overflow handling - Full display for User ID and Email */
		#usersTable td:nth-child(1) {
			white-space: nowrap !important;
			overflow: visible !important;
			text-overflow: clip !important;
		}
		#usersTable td:nth-child(3),
		#usersTable td:nth-child(4) {
			white-space: normal;
			word-break: break-word;
		}
		#usersTable td:nth-child(4) {
			white-space: nowrap !important;
			overflow: visible !important;
			text-overflow: clip !important;
		}
		#usersTable td:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(4)) {
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		#usersTable td > div {
			max-width: 100%;
		}
		#usersTable td:nth-child(1) > div,
		#usersTable td:nth-child(4) > div {
			white-space: nowrap !important;
			overflow: visible !important;
			text-overflow: clip !important;
		}
		#usersTable td:nth-child(3) > div {
			white-space: normal;
			word-break: break-word;
		}
		#usersTable td:not(:nth-child(1)):not(:nth-child(3)):not(:nth-child(4)) > div {
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		/* Tooltip for email on hover */
		#usersTable td:nth-child(4) span[title] {
			cursor: help;
			border-bottom: 1px dotted #64748b;
		}
		
		/* Table wrapper enhancement */
		.table-wrapper {
			background: white;
			border-radius: 12px;
			padding: 2px;
			box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
			width: 100% !important;
			max-width: 100% !important;
			overflow-x: auto !important;
			overflow-y: visible !important;
			margin-top: 24px;
			-webkit-overflow-scrolling: touch;
			box-sizing: border-box !important;
			position: relative !important;
		}
		div[style*="overflow-x: auto"] {
			background: white;
			border-radius: 12px;
			padding: 2px;
			box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
			width: 100% !important;
			max-width: 100% !important;
			overflow-x: auto !important;
			overflow-y: visible !important;
			margin-top: 24px;
			-webkit-overflow-scrolling: touch;
		}
		div[style*="overflow-x: auto"] > table {
			min-width: 1400px !important;
			width: 100% !important;
			display: table !important;
			table-layout: fixed !important;
		}
		#usersTable {
			min-width: 0 !important;
			width: 100% !important;
			max-width: 100% !important;
			display: table !important;
			table-layout: fixed !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		#usersSection {
			width: 100%;
			max-width: 100%;
			overflow: visible;
			display: block !important;
		}
		#usersSection .setting-card {
			width: 100% !important;
			max-width: 100% !important;
			min-width: 0 !important;
			overflow: visible !important;
			display: flex !important;
			flex-direction: column !important;
			box-sizing: border-box !important;
			flex: 1 1 auto !important;
		}
		#usersSection .setting-card .card-body {
			overflow-x: visible !important;
			overflow-y: visible !important;
			display: block !important;
		}
		#usersSection .card-body {
			overflow-x: visible !important;
			overflow-y: visible !important;
			width: 100% !important;
			max-width: 100% !important;
			padding: 28px !important;
			display: block !important;
		}
		#usersSection .table-wrapper {
			width: 100% !important;
			max-width: 100% !important;
			display: block !important;
			position: relative !important;
			overflow-x: hidden !important;
			overflow-y: visible !important;
			margin-top: 28px !important;
			box-sizing: border-box !important;
		}
		#usersSection .stats-row {
			display: grid !important;
			grid-template-columns: repeat(5, 1fr) !important;
			gap: 16px !important;
			margin-bottom: 28px !important;
			width: 100% !important;
			max-width: 100% !important;
		}
		#usersSection .stat-mini {
			display: block !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		#usersSection .table-wrapper::-webkit-scrollbar {
			height: 8px;
		}
		#usersSection .table-wrapper::-webkit-scrollbar-track {
			background: #f1f5f9;
			border-radius: 4px;
		}
		#usersSection .table-wrapper::-webkit-scrollbar-thumb {
			background: #cbd5e1;
			border-radius: 4px;
		}
		#usersSection .table-wrapper::-webkit-scrollbar-thumb:hover {
			background: #94a3b8;
		}
		
		/* Empty state styling */
		.data-table tbody tr:only-child td {
			text-align: center;
			padding: 40px 20px;
			color: #94a3b8;
			font-size: 14px;
		}
		
		/* Responsive table adjustments */
		@media (max-width: 768px) {
			.data-table th,
			.data-table td {
				padding: 12px 14px;
				font-size: 13px;
			}
			.data-table th {
				font-size: 11px;
			}
		}
		.badge {
			padding: 6px 12px;
			border-radius: 10px;
			font-size: 11px;
			font-weight: 700;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			box-shadow: 0 3px 8px rgba(0,0,0,0.12);
			transition: all 0.3s ease;
			border: none;
		}
		.badge:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		}
		.badge.admin { 
			background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); 
			color: white; 
			box-shadow: 0 3px 12px rgba(244, 63, 94, 0.3);
		}
		.badge.admin:hover {
			box-shadow: 0 5px 20px rgba(244, 63, 94, 0.4);
		}
		.badge.teacher { 
			background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); 
			color: white; 
			box-shadow: 0 3px 12px rgba(139, 92, 246, 0.3);
		}
		.badge.teacher:hover {
			box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4);
		}
		.badge.staff { 
			background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
			color: white; 
			box-shadow: 0 3px 12px rgba(6, 182, 212, 0.3);
		}
		.badge.staff:hover {
			box-shadow: 0 5px 20px rgba(6, 182, 212, 0.4);
		}
		.badge.superadmin {
			background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
			color: white;
			box-shadow: 0 3px 12px rgba(245, 158, 11, 0.3);
		}
		.badge.superadmin:hover {
			box-shadow: 0 5px 20px rgba(245, 158, 11, 0.4);
		}
		.badge.active { 
			background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
			color: white; 
			box-shadow: 0 3px 12px rgba(16, 185, 129, 0.3);
		}
		.badge.active:hover {
			box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
		}
		.badge.inactive { 
			background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); 
			color: white; 
			box-shadow: 0 3px 12px rgba(239, 68, 68, 0.3);
		}
		.badge.inactive:hover {
			box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
		}
		.badge i {
			font-size: 11px;
		}

		/* Action Buttons - Enhanced */
		.action-btn {
			width: 32px;
			height: 32px;
			border-radius: 8px;
			font-size: 12px;
			border: none;
			cursor: pointer;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
			margin: 0 3px;
			font-size: 14px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}
		.action-btn.edit { 
			background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); 
			color: white; 
		}
		.action-btn.edit:hover { 
			background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); 
			transform: translateY(-3px) scale(1.08); 
			box-shadow: 0 6px 20px rgba(59,130,246,0.5); 
		}
		.action-btn.delete { 
			background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); 
			color: white; 
		}
		.action-btn.delete:hover { 
			background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); 
			transform: translateY(-3px) scale(1.08); 
			box-shadow: 0 6px 20px rgba(239,68,68,0.5); 
		}
		.action-btn.view { 
			background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
			color: white; 
		}
		.action-btn.view:hover { 
			background: linear-gradient(135deg, #059669 0%, #047857 100%); 
			transform: translateY(-3px) scale(1.08); 
			box-shadow: 0 6px 20px rgba(16,185,129,0.5); 
		}
		.action-btn-group {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 6px;
			gap: 6px;
		}

		/* Theme Cards */
		.theme-grid {
			display: grid;
			grid-template-columns: repeat(4, minmax(0, 1fr));
			gap: 16px;
		}
		.theme-card {
			border: 3px solid #e2e8f0;
			border-radius: 12px;
			padding: 16px;
			cursor: pointer;
			transition: all 0.2s;
			text-align: center;
		}
		.theme-card:hover { border-color: #94a3b8; }
		.theme-card.active { border-color: #22c55e; background: #f0fdf4; }
		.theme-preview {
			width: 100%;
			height: 60px;
			border-radius: 8px;
			margin-bottom: 12px;
		}
		.theme-name { font-weight: 600; font-size: 14px; color: #374151; }

		/* Color Picker */
		.color-picker-row {
			display: flex;
			align-items: center;
			gap: 16px;
			padding: 12px 0;
		}

		/* Responsive layout tweaks for Settings */
		@media (max-width: 1024px) {
			.settings-page {
				padding: 18px 16px 24px;
			}
			.sidebar-nav {
				gap: 3px;
				padding: 6px;
			}
			.nav-item {
				padding: 12px 16px;
				font-size: 13px;
			}
			.nav-item i {
				font-size: 14px;
			}
		}
		@media (max-width: 768px) {
			.settings-header {
				flex-direction: column;
				align-items: flex-start;
				gap: 12px;
				padding: 20px 18px;
			}
			.form-grid {
				grid-template-columns: 1fr;
			}
			.card-header {
				flex-wrap: wrap;
				gap: 12px;
				min-height: auto;
			}
			.card-header .card-title {
				width: 100%;
			}
			.card-header .btn {
				width: 100%;
				justify-content: center;
			}
			#addUserBtn {
				display: flex !important;
				width: 100%;
				margin-left: 0 !important;
			}
		}
		.color-preview {
			width: 50px;
			height: 50px;
			border-radius: 10px;
			border: 2px solid #e2e8f0;
			cursor: pointer;
		}
		.color-input { width: 100%; }

		/* Stats Cards */
		.stats-row {
			display: grid !important;
			grid-template-columns: repeat(5, 1fr) !important;
			gap: 16px !important;
			margin-bottom: 24px !important;
			width: 100% !important;
			max-width: 100% !important;
			box-sizing: border-box !important;
			overflow: visible !important;
		}
		.stats-row > * {
			min-width: 0 !important;
			box-sizing: border-box !important;
			width: 100% !important;
			max-width: 100% !important;
		}
		#usersSection .stats-row {
			display: grid !important;
			grid-template-columns: repeat(5, 1fr) !important;
			gap: 16px !important;
			margin-bottom: 28px !important;
			width: 100% !important;
			max-width: 100% !important;
			box-sizing: border-box !important;
			overflow: visible !important;
		}
		.stat-mini {
			background: #ffffff;
			padding: 20px;
			border-radius: 14px;
			text-align: center;
			box-shadow: 0 2px 10px rgba(0,0,0,0.06);
			border-left: 4px solid;
			border-top: 1px solid rgba(226, 232, 240, 0.6);
			border-right: 1px solid rgba(226, 232, 240, 0.6);
			border-bottom: 1px solid rgba(226, 232, 240, 0.6);
			min-width: 0 !important;
			width: 100% !important;
			max-width: 100% !important;
			transition: all 0.3s;
			box-sizing: border-box !important;
			position: relative;
			overflow: visible !important;
		}
		#usersSection .stat-mini {
			width: 100% !important;
			max-width: 100% !important;
			box-sizing: border-box !important;
			display: block !important;
			visibility: visible !important;
			opacity: 1 !important;
		}
		.stat-mini::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 3px;
			background: linear-gradient(90deg, transparent, currentColor, transparent);
			opacity: 0;
			transition: opacity 0.3s ease;
		}
		.stat-mini:hover {
			transform: translateY(-4px);
			box-shadow: 0 8px 25px rgba(0,0,0,0.1);
		}
		.stat-mini.blue { border-color: #3b82f6; }
		.stat-mini.purple { border-color: #8b5cf6; }
		.stat-mini.green { border-color: #22c55e; }
		.stat-mini.orange { border-color: #f59e0b; }
		.stat-mini.red { border-color: #ef4444; }
		.stat-mini.cyan { border-color: #06b6d4; }
		.stat-mini-value { 
			font-size: 32px; 
			font-weight: 800; 
			color: #0f172a; 
			line-height: 1.2;
			margin-bottom: 8px;
			letter-spacing: -0.02em;
		}
		.stat-mini-label { 
			font-size: 12px; 
			color: #64748b; 
			margin-top: 0; 
			letter-spacing: 0.08em; 
			text-transform: uppercase; 
			font-weight: 600;
		}
		.stat-total {
			border-color: #3b82f6;
		}
		.stat-total .stat-mini-value { color: #1e293b; }
		.stat-students {
			border-color: #06b6d4;
		}
		.stat-students .stat-mini-value { color: #1e293b; }
		.stat-admins {
			border-color: #ef4444;
		}
		.stat-admins .stat-mini-value { color: #1e293b; }
		.stat-teachers {
			border-color: #8b5cf6;
		}
		.stat-teachers .stat-mini-value { color: #1e293b; }
		.stat-staff {
			border-color: #22c55e;
		}
		.stat-staff .stat-mini-value { color: #1e293b; }

		/* Modal */
		.modal-overlay {
			display: none;
			position: fixed;
			inset: 0;
			background: rgba(15,23,42,0.55);
			z-index: 1000;
			align-items: center;
			justify-content: center;
			backdrop-filter: blur(6px);
		}
		.modal-overlay.active { display: flex; }
		.modal-content {
			background: #ffffff;
			border-radius: 0 !important;
			width: 100vw !important;
			max-width: 100vw !important;
			min-width: 100vw !important;
			height: 100vh !important;
			max-height: 100vh !important;
			min-height: 100vh !important;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			box-shadow: none !important;
			animation: modalSlide 0.3s ease;
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
		}
		@keyframes modalSlide { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
		.modal-header {
			padding: 16px 24px;
			border-bottom: 1px solid rgba(255,255,255,0.1);
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 50%, #1e3a5f 100%);
			color: #ffffff;
			position: sticky;
			top: 0;
			z-index: 100;
			flex-shrink: 0;
		}
		.modal-title { 
			font-size: 18px; 
			font-weight: 700; 
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.modal-title i {
			font-size: 18px;
			opacity: 0.9;
		}
		.modal-title span {
			flex: 1;
		}
		.modal-title i {
			font-size: 18px;
			opacity: 0.9;
		}
		.modal-title span {
			flex: 1;
		}
		.modal-close {
			width: 32px;
			height: 32px;
			border-radius: 8px;
			border: none;
			background: rgba(255,255,255,0.15);
			color: #ffffff;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.2s;
		}
		.modal-close:hover {
			background: rgba(255,255,255,0.25);
			transform: scale(1.05);
		}
		.modal-body { 
			padding: 0 !important; 
			overflow-y: auto !important; 
			overflow-x: hidden !important;
			flex: 1 1 auto !important;
			height: auto !important;
			background: #f8fafc;
			scroll-behavior: smooth;
		}
		.modal-body::-webkit-scrollbar {
			width: 8px;
		}
		.modal-body::-webkit-scrollbar-track {
			background: #f1f5f9;
		}
		.modal-body::-webkit-scrollbar-thumb {
			background: #cbd5e1;
			border-radius: 4px;
		}
		.modal-body::-webkit-scrollbar-thumb:hover {
			background: #94a3b8;
		}
		.modal-footer {
			padding: 16px 24px;
			border-top: 1px solid #e2e8f0;
			display: flex;
			justify-content: space-between;
			align-items: center;
			background: #ffffff;
			position: relative;
			width: 100%;
			z-index: 10;
			flex-shrink: 0;
			margin-top: auto;
		}
		.modal-footer-left {
			display: flex;
			align-items: center;
			gap: 12px;
			font-size: 13px;
			color: #64748b;
		}
		.modal-footer-right {
			display: flex;
			gap: 12px;
		}

		/* Responsive tweaks for Add User modal */
		@media (max-width: 1024px) {
			.modal-content {
				width: 100vw !important;
				max-width: 100vw !important;
				min-width: 100vw !important;
				max-height: 100vh !important;
				min-height: 100vh !important;
				border-radius: 0;
			}
			.modal-body {
				max-height: calc(100vh - 200px) !important;
				padding: 20px 20px 18px !important;
			}
		}
		@media (max-width: 768px) {
			.modal-body {
				padding: 16px 16px 14px !important;
			}
			.modal-tabs {
				flex-wrap: wrap;
				row-gap: 8px;
			}
			.wizard-actions {
				flex-direction: column;
				align-items: stretch;
				gap: 8px;
			}
		}

		/* Module Access UI */
		.module-access-wrapper {
			border-radius: 12px;
			border: 1px solid #e2e8f0;
			padding: 14px 16px;
			background: #f8fafc;
			margin-top: 6px;
		}

		/* Wizard tabs & actions - Sticky Professional Design */
		.modal-tabs {
			display: flex !important;
			border-bottom: 2px solid #e2e8f0 !important;
			padding: 0 24px !important;
			gap: 4px !important;
			background: #ffffff !important;
			visibility: visible !important;
			opacity: 1 !important;
			width: 100% !important;
			box-sizing: border-box !important;
			flex-shrink: 0 !important;
			position: sticky !important;
			top: 57px !important;
			z-index: 99 !important;
			box-shadow: 0 2px 8px rgba(0,0,0,0.04) !important;
		}
		.modal-tab {
			border: none;
			background: transparent;
			padding: 12px 20px;
			font-size: 13px;
			font-weight: 600;
			color: #64748b;
			cursor: pointer;
			border-bottom: 3px solid transparent;
			border-radius: 0;
			display: flex;
			align-items: center;
			gap: 8px;
			transition: all 0.2s ease;
			position: relative;
		}
		.modal-tab i {
			font-size: 14px;
			opacity: 0.7;
		}
		.modal-tab:hover {
			color: #1e3a5f;
			background: #f1f5f9;
		}
		.modal-tab:hover i {
			opacity: 1;
		}
		.modal-tab.active {
			color: #1e3a5f;
			border-bottom-color: #1e3a5f;
			background: #f8fafc;
		}
		.modal-tab.active i {
			opacity: 1;
			color: #1e3a5f;
		}
		.modal-tab.active::after {
			content: '';
			position: absolute;
			bottom: -2px;
			left: 0;
			right: 0;
			height: 3px;
			background: linear-gradient(90deg, #1e3a5f, #2d5a87);
		}
		.tab-section { 
			display: none !important; 
			visibility: hidden !important;
			opacity: 0 !important;
		}
		.tab-section.active { 
			display: block !important; 
			visibility: visible !important;
			opacity: 1 !important;
			width: 100% !important;
			box-sizing: border-box !important;
			padding: 20px 24px !important;
			animation: fadeInTab 0.3s ease;
		}
		@keyframes fadeInTab {
			from { opacity: 0; transform: translateY(10px); }
			to { opacity: 1; transform: translateY(0); }
		}
		/* Tab Section Headers */
		.tab-section-header {
			display: flex;
			align-items: center;
			gap: 12px;
			margin-bottom: 20px;
			padding-bottom: 16px;
			border-bottom: 2px solid #e2e8f0;
		}
		.tab-section-header-icon {
			width: 40px;
			height: 40px;
			border-radius: 10px;
			background: linear-gradient(135deg, #1e3a5f, #2d5a87);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #ffffff;
			font-size: 18px;
			flex-shrink: 0;
		}
		.tab-section-title {
			font-size: 18px;
			font-weight: 700;
			color: #1e293b;
			margin: 0 0 4px 0;
		}
		.tab-section-subtitle {
			font-size: 13px;
			color: #64748b;
			margin: 0;
		}
		/* Form Section Cards */
		.form-section-card {
			background: #ffffff;
			border: 1px solid #e2e8f0;
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 16px;
			box-shadow: 0 1px 3px rgba(0,0,0,0.05);
		}
		.form-section-label {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 12px;
			font-weight: 700;
			color: #1e3a5f;
			margin-bottom: 10px;
			padding-bottom: 8px;
			border-bottom: 1px solid #f1f5f9;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.form-section-label i {
			color: #3b82f6;
			font-size: 13px;
		}
		.user-details-grid {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 14px;
		}
		.user-details-group {
			display: flex;
			flex-direction: column;
			gap: 6px;
		}
		@media (max-width: 768px) {
			.user-details-grid {
				grid-template-columns: 1fr;
			}
		}
		/* Compact Form Inputs */
		.modern-input {
			padding: 10px 14px !important;
			font-size: 14px !important;
			height: 42px !important;
		}
		.modern-select {
			padding: 10px 38px 10px 14px !important;
			font-size: 14px !important;
			height: 42px !important;
		}
		.modern-label {
			margin-bottom: 6px !important;
		}
		.modern-hint {
			margin-top: 4px !important;
		}
		/* Compact Module Access Section */
		.tab-modules .tab-section-header {
			margin-bottom: 16px;
		}
		/* Compact Permissions Section */
		.permissions-actions-panel {
			margin-bottom: 16px;
		}
		.permissions-table-wrapper {
			margin-bottom: 16px;
		}
		.permissions-info-card {
			margin-top: 16px;
		}
		.wizard-actions {
			display: none !important;
		}
		/* Compact User Details Layout - No Scroll */
		.user-details-header {
			margin-bottom: 12px !important;
			padding-bottom: 8px !important;
		}
		.user-details-header .form-label {
			font-size: 13px !important;
			margin-bottom: 2px !important;
		}
		.user-details-header .form-hint {
			font-size: 12px !important;
			margin: 0 !important;
		}
		.user-details-grid {
			display: grid !important;
			grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
			gap: 12px 16px !important;
		}
		.user-details-group {
			display: flex !important;
			flex-direction: column !important;
			gap: 4px !important;
		}
		/* Modern Label Design */
		.modern-label {
			display: flex !important;
			align-items: center !important;
			gap: 8px !important;
			font-size: 12px !important;
			font-weight: 700 !important;
			margin-bottom: 6px !important;
			color: #1e293b !important;
			text-transform: uppercase !important;
			letter-spacing: 0.5px !important;
		}
		.modern-label i {
			width: 24px;
			height: 24px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
			color: #ffffff;
			border-radius: 8px;
			font-size: 11px;
			flex-shrink: 0;
			box-shadow: 0 3px 10px rgba(102, 126, 234, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.3);
			transition: all 0.3s ease;
		}
		.modern-label:hover i {
			transform: scale(1.1) rotate(5deg);
			box-shadow: 0 4px 14px rgba(102, 126, 234, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3);
		}
		.modern-label span {
			flex: 1;
		}
		/* Modern Input Wrapper - Premium Design */
		.form-input-wrapper {
			position: relative;
			width: 100%;
		}
		.modern-input {
			padding: 12px 16px !important;
			font-size: 14px !important;
			border-radius: 12px !important;
			height: 44px !important;
			border: 2px solid #e2e8f0 !important;
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%) !important;
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;
			width: 100% !important;
			box-sizing: border-box !important;
			color: #1e293b !important;
			font-weight: 500 !important;
			position: relative;
		}
		.modern-input::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			border-radius: 12px;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
			opacity: 0;
			transition: opacity 0.3s ease;
			pointer-events: none;
		}
		.modern-input:hover {
			border-color: #cbd5e1 !important;
			box-shadow: 0 4px 16px rgba(102, 126, 234, 0.12), inset 0 1px 2px rgba(255, 255, 255, 0.9) !important;
			transform: translateY(-2px);
			background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 50%, #ffffff 100%) !important;
		}
		.modern-input:hover::before {
			opacity: 1;
		}
		.modern-input:focus {
			outline: none !important;
			border-color: #667eea !important;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15), 0 8px 24px rgba(102, 126, 234, 0.25), inset 0 1px 2px rgba(255, 255, 255, 1) !important;
			background: #ffffff !important;
			transform: translateY(-3px);
		}
		.modern-input:focus::before {
			opacity: 0;
		}
		.modern-input::placeholder {
			color: #94a3b8;
			font-size: 13px;
			font-weight: 400;
			opacity: 0.8;
		}
		.modern-input:focus::placeholder {
			opacity: 0.5;
		}
		/* Password Toggle */
		.password-toggle {
			position: absolute;
			right: 14px;
			top: 50%;
			transform: translateY(-50%);
			color: #64748b;
			cursor: pointer;
			font-size: 15px;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			z-index: 2;
			width: 28px;
			height: 28px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 6px;
			background: rgba(102, 126, 234, 0.08);
		}
		.password-toggle:hover {
			color: #667eea;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15));
			transform: translateY(-50%) scale(1.15);
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
		}
		.password-toggle:active {
			transform: translateY(-50%) scale(1);
		}
		/* Modern Select Wrapper - Premium Design */
		.form-select-wrapper {
			position: relative;
			width: 100%;
		}
		.modern-select {
			padding: 12px 42px 12px 16px !important;
			font-size: 14px !important;
			border-radius: 12px !important;
			height: 44px !important;
			border: 2px solid #e2e8f0 !important;
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #ffffff 100%) !important;
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), inset 0 1px 2px rgba(255, 255, 255, 0.8) !important;
			width: 100% !important;
			box-sizing: border-box !important;
			cursor: pointer !important;
			appearance: none !important;
			background-image: none !important;
			color: #1e293b !important;
			font-weight: 500 !important;
			position: relative;
		}
		.modern-select::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			border-radius: 12px;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
			opacity: 0;
			transition: opacity 0.3s ease;
			pointer-events: none;
		}
		.modern-select:hover {
			border-color: #cbd5e1 !important;
			box-shadow: 0 4px 16px rgba(102, 126, 234, 0.12), inset 0 1px 2px rgba(255, 255, 255, 0.9) !important;
			transform: translateY(-2px);
			background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 50%, #ffffff 100%) !important;
		}
		.modern-select:hover::before {
			opacity: 1;
		}
		.modern-select:focus {
			outline: none !important;
			border-color: #667eea !important;
			box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15), 0 8px 24px rgba(102, 126, 234, 0.25), inset 0 1px 2px rgba(255, 255, 255, 1) !important;
			background: #ffffff !important;
			transform: translateY(-3px);
		}
		.modern-select:focus::before {
			opacity: 0;
		}
		.select-arrow {
			position: absolute;
			right: 16px;
			top: 50%;
			transform: translateY(-50%);
			color: #667eea;
			font-size: 13px;
			pointer-events: none;
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			z-index: 2;
			width: 20px;
			height: 20px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
			border-radius: 6px;
		}
		.form-select-wrapper:hover .select-arrow {
			color: #764ba2;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
			transform: translateY(-50%) scale(1.1);
		}
		.modern-select:focus + .select-arrow {
			color: #764ba2;
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
			transform: translateY(-50%) rotate(180deg) scale(1.1);
		}
		.modern-select option {
			padding: 12px;
			background: #ffffff;
			color: #1e293b;
			font-weight: 500;
		}
		.modern-select option:hover {
			background: linear-gradient(135deg, #f0f7ff, #f8fafc);
		}
		.modern-hint {
			font-size: 11px !important;
			margin-top: 4px !important;
			line-height: 1.4 !important;
			color: #64748b !important;
			display: flex;
			align-items: center;
			gap: 6px;
		}
		.modern-hint::before {
			content: '';
			font-size: 10px;
			color: #667eea;
			font-weight: 700;
		}
		.modal-header {
			padding: 12px 20px 8px !important;
			min-height: 50px !important;
		}
		.modal-tabs {
			padding: 0 20px !important;
			min-height: 44px !important;
		}
		.modal-tab {
			padding: 8px 14px !important;
			font-size: 12px !important;
		}
		.modal-footer {
			padding: 10px 20px 12px !important;
			min-height: 50px !important;
		}
		.module-access-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 12px;
			margin-top: 16px;
			font-size: 13px;
		}
		.module-access-grid label {
			display: flex;
			align-items: center;
			gap: 8px;
			cursor: pointer;
		}
		/* Permissions Tab - High-Level Modern Design - Compact */
		.tab-permissions {
			padding: 0 !important;
		}
		.permissions-container {
			display: flex;
			flex-direction: column;
			gap: 12px !important;
			padding: 0;
		}
		.permissions-header {
			display: none !important;
		}
		.permissions-header::before {
			content: '';
			position: absolute;
			top: -50%;
			right: -50%;
			width: 200%;
			height: 200%;
			background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
			animation: permissionsGlow 8s ease-in-out infinite;
		}
		@keyframes permissionsGlow {
			0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
			50% { transform: translate(-10%, -10%) scale(1.1); opacity: 0.5; }
		}
		.permissions-header-content {
			display: flex;
			align-items: center;
			gap: 12px !important;
			position: relative;
			z-index: 1;
		}
		.permissions-icon-wrapper {
			width: 40px !important;
			height: 40px !important;
			border-radius: 10px !important;
			background: rgba(255, 255, 255, 0.2);
			backdrop-filter: blur(10px);
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 18px !important;
			color: #ffffff;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
			flex-shrink: 0;
		}
		.permissions-title {
			font-size: 16px !important;
			font-weight: 700 !important;
			color: #ffffff;
			margin: 0 0 2px 0 !important;
			letter-spacing: -0.3px;
		}
		.permissions-subtitle {
			font-size: 11px !important;
			color: rgba(255, 255, 255, 0.9);
			margin: 0;
			line-height: 1.4;
		}
		.permissions-actions-panel {
			background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
			border-radius: 12px;
			padding: 12px 16px !important;
			border: 1px solid rgba(226, 232, 240, 0.8);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
		}
		.permissions-actions-label {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 11px !important;
			font-weight: 700;
			color: #475569;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 10px !important;
		}
		.permissions-actions-label i {
			color: #f59e0b;
			font-size: 16px;
		}
		.module-access-presets {
			display: flex;
			flex-wrap: wrap;
			gap: 8px !important;
		}
		.preset-chip {
			padding: 8px 14px !important;
			border-radius: 10px;
			border: none;
			background: #ffffff;
			font-size: 12px !important;
			font-weight: 600;
			color: #1e293b;
			display: inline-flex;
			align-items: center;
			gap: 8px !important;
			cursor: pointer;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
			position: relative;
			overflow: hidden;
		}
		.preset-chip::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
			transition: left 0.5s;
		}
		.preset-chip:hover::before {
			left: 100%;
		}
		.preset-chip-icon {
			width: 28px !important;
			height: 28px !important;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 12px !important;
			transition: all 0.3s ease;
		}
		.preset-chip-text {
			flex: 1;
		}
		.preset-chip-arrow {
			opacity: 0;
			transform: translateX(-10px);
			transition: all 0.3s ease;
			font-size: 12px;
		}
		.preset-chip:hover .preset-chip-arrow {
			opacity: 1;
			transform: translateX(0);
		}
		.preset-chip-primary {
			border: 2px solid #8b5cf6;
		}
		.preset-chip-primary .preset-chip-icon {
			background: linear-gradient(135deg, #8b5cf6, #7c3aed);
			color: #ffffff;
		}
		.preset-chip-primary:hover {
			background: linear-gradient(135deg, #8b5cf6, #7c3aed);
			color: #ffffff;
			transform: translateY(-3px);
			box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4);
		}
		.preset-chip-success {
			border: 2px solid #10b981;
		}
		.preset-chip-success .preset-chip-icon {
			background: linear-gradient(135deg, #10b981, #059669);
			color: #ffffff;
		}
		.preset-chip-success:hover {
			background: linear-gradient(135deg, #10b981, #059669);
			color: #ffffff;
			transform: translateY(-3px);
			box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
		}
		.preset-chip-danger {
			border: 2px solid #ef4444;
		}
		.preset-chip-danger .preset-chip-icon {
			background: linear-gradient(135deg, #ef4444, #dc2626);
			color: #ffffff;
		}
		.preset-chip-danger:hover {
			background: linear-gradient(135deg, #ef4444, #dc2626);
			color: #ffffff;
			transform: translateY(-3px);
			box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
		}
		.module-access-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 12px;
			font-size: 13px;
		}
		.module-card {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 12px;
			border-radius: 10px;
			background: #ffffff;
			border: 1px solid #e2e8f0;
			cursor: pointer;
			transition: all 0.2s ease;
			position: relative;
		}
		.module-card input[type="checkbox"] {
			position: absolute;
			opacity: 0;
			width: 0;
			height: 0;
		}
		.module-card-icon {
			width: 32px;
			height: 32px;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 14px;
			flex-shrink: 0;
		}
		.module-card-body {
			display: flex;
			flex-direction: column;
			gap: 2px;
			flex: 1;
		}
		.module-card-title {
			font-weight: 600;
			font-size: 13px;
			color: #1e293b;
		}
		.module-card-sub {
			font-size: 11px;
			color: #94a3b8;
		}
		.module-card:hover {
			border-color: #3b82f6;
			box-shadow: 0 2px 8px rgba(59,130,246,0.15);
			transform: translateY(-1px);
		}
		.module-card input:checked + .module-card-icon,
		.module-card:has(input:checked) {
			border-color: #3b82f6;
			background: #eff6ff;
		}
		.module-card:has(input:checked)::after {
			content: '';
			position: absolute;
			top: 8px;
			right: 8px;
			width: 20px;
			height: 20px;
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			color: white;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 11px;
			font-weight: 700;
		}
		@media (max-width: 768px) {
			.module-access-grid {
				grid-template-columns: 1fr;
			}
		}

		/* Permission Table - Premium Design */
		.permissions-table-wrapper {
			background: #ffffff;
			border-radius: 12px;
			border: 1px solid rgba(226, 232, 240, 0.8);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
			overflow: hidden;
		}
		.permissions-table-header {
			background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
			padding: 10px 16px !important;
			border-bottom: 1px solid #e2e8f0;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.permissions-table-header-left {
			display: flex;
			align-items: center;
			gap: 8px;
			font-weight: 700;
			font-size: 11px !important;
			color: #1e293b;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}
		.permissions-table-header-left i {
			color: #667eea;
			font-size: 12px !important;
		}
		.permissions-count-badge {
			background: linear-gradient(135deg, #667eea, #764ba2);
			color: #ffffff;
			padding: 4px 10px !important;
			border-radius: 12px;
			font-size: 10px !important;
			font-weight: 700;
			box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
		}
		.permissions-table-container {
			overflow-x: auto;
			background: #ffffff;
		}
		.permission-table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0;
			background: #ffffff;
		}
		.permission-table thead {
			background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
		}
		.permission-table thead th {
			color: #ffffff;
			padding: 10px 16px !important;
			font-weight: 700;
			font-size: 11px !important;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			text-align: left;
			border: none;
			position: relative;
		}
		.permission-table thead th::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 0;
			right: 0;
			height: 3px;
			background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
		}
		.permission-th-content {
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.permission-th-content i {
			font-size: 14px;
			opacity: 0.9;
		}
		.permission-col-module {
			min-width: 250px;
		}
		.permission-col-action {
			text-align: center;
			width: 140px;
		}
		.permission-table tbody tr.permission-row {
			border-bottom: 1px solid #f1f5f9;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
		}
		.permission-table tbody tr.permission-row::before {
			content: '';
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			width: 4px;
			background: linear-gradient(180deg, #667eea, #764ba2);
			opacity: 0;
			transition: opacity 0.3s ease;
		}
		.permission-table tbody tr.permission-row:hover {
			background: linear-gradient(90deg, #f8fafc 0%, #ffffff 50%, #f8fafc 100%);
			transform: translateX(4px);
			box-shadow: -4px 0 12px rgba(102, 126, 234, 0.15);
		}
		.permission-table tbody tr.permission-row:hover::before {
			opacity: 1;
		}
		.permission-table tbody tr.permission-row:last-child {
			border-bottom: none;
		}
		.permission-table tbody td {
			padding: 10px 16px !important;
			font-size: 13px !important;
			color: #1e293b;
			vertical-align: middle;
		}
		.permission-module-cell {
			font-weight: 600 !important;
			color: #1e293b;
			display: flex;
			align-items: center;
			gap: 10px !important;
			font-size: 13px !important;
		}
		.permission-module-cell::before {
			content: '';
			width: 6px !important;
			height: 6px !important;
			border-radius: 50%;
			background: linear-gradient(135deg, #667eea, #764ba2);
			flex-shrink: 0;
			box-shadow: 0 1px 4px rgba(102, 126, 234, 0.3);
		}
		@keyframes permissionPulse {
			0%, 100% { transform: scale(1); opacity: 1; }
			50% { transform: scale(1.2); opacity: 0.7; }
		}
		.permission-table tbody td:not(:first-child) {
			text-align: center;
		}
		.permission-table input[type="checkbox"] {
			width: 18px !important;
			height: 18px !important;
			cursor: pointer;
			accent-color: #667eea;
			border-radius: 4px;
			border: 2px solid #cbd5e1;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
		}
		.permission-table input[type="checkbox"]:checked {
			background: linear-gradient(135deg, #667eea, #764ba2);
			border-color: #764ba2;
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
			transform: scale(1.1);
		}
		.permission-table input[type="checkbox"]:hover {
			border-color: #667eea;
			transform: scale(1.15);
			box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
		}
		.permissions-info-card {
			background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
			border: 1px solid #bfdbfe;
			border-radius: 10px;
			padding: 10px 14px !important;
			display: flex;
			align-items: flex-start;
			gap: 10px !important;
			box-shadow: 0 2px 8px rgba(59, 130, 246, 0.08);
			margin-top: 0 !important;
		}
		.permissions-info-icon {
			width: 28px !important;
			height: 28px !important;
			border-radius: 8px;
			background: linear-gradient(135deg, #3b82f6, #2563eb);
			display: flex;
			align-items: center;
			justify-content: center;
			color: #ffffff;
			font-size: 12px !important;
			flex-shrink: 0;
			box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
		}
		.permissions-info-content {
			flex: 1;
			font-size: 11px !important;
			color: #1e40af;
			line-height: 1.5;
		}
		.permissions-info-content strong {
			color: #1e3a8a;
			font-weight: 700;
		}

		/* Responsive */
		@media (max-width: 768px) {
			.sidebar-nav {
				gap: 2px;
				padding: 4px;
			}
			.nav-item {
				padding: 10px 12px;
				font-size: 12px;
				gap: 6px;
			}
			.nav-item i {
				font-size: 13px;
				width: 16px;
			}
			.settings-header {
				flex-direction: column;
				align-items: flex-start;
				gap: 12px;
				padding: 20px 18px;
			}
			.settings-header h1 {
				font-size: 22px;
			}
		}
		@media (max-width: 1024px) {
			.form-grid { grid-template-columns: 1fr; }
			.form-group.full { grid-column: span 1; }
			.theme-grid { grid-template-columns: repeat(2, 1fr); }
			.stats-row { 
				grid-template-columns: repeat(3, 1fr) !important; 
				width: 100% !important;
			}
			#usersSection .stats-row {
				grid-template-columns: repeat(3, 1fr) !important;
			}
			.setting-card {
				width: 100%;
				max-width: 100%;
				overflow: visible !important;
			}
			.card-body {
				width: 100% !important;
				max-width: 100% !important;
				overflow: visible !important;
			}
			#usersSection .card-header {
				flex-wrap: wrap !important;
			}
			#usersSection #addUserBtn {
				width: 100% !important;
				margin-top: 12px !important;
				margin-left: 0 !important;
			}
		}
		@media (max-width: 768px) {
			.stats-row { 
				grid-template-columns: 1fr !important; 
			}
			#usersSection .stats-row {
				grid-template-columns: 1fr !important;
			}
		}
	</style>
</head>
<body>
	<div class="page settings-page active">
		<!-- Header -->
		<div class="settings-header">
			<div>
				<h1><i class="fas fa-cog"></i> Settings</h1>
				<p>Configure system preferences, users, and school settings</p>
			</div>
			<button class="header-btn" id="saveAllBtn">
				<i class="fas fa-save"></i> Save All Changes
			</button>
		</div>

		<!-- Horizontal Navigation Bar -->
			<div class="settings-sidebar">
				<nav class="sidebar-nav">
					<button class="nav-item active" data-section="school"><i class="fas fa-school"></i> School Profile</button>
					<button class="nav-item" data-section="users"><i class="fas fa-users-cog"></i> User Management</button>
					<button class="nav-item" data-section="academic"><i class="fas fa-graduation-cap"></i> Academic Settings</button>
					<button class="nav-item" data-section="notifications"><i class="fas fa-bell"></i> Notifications</button>
					<button class="nav-item" data-section="appearance"><i class="fas fa-palette"></i> Appearance</button>
					<button class="nav-item" data-section="security"><i class="fas fa-shield-alt"></i> Security</button>
					<button class="nav-item" data-section="backup"><i class="fas fa-database"></i> Backup & Data</button>
					<button class="nav-item" data-section="system"><i class="fas fa-server"></i> System Info</button>
				</nav>
			</div>

		<!-- Layout - Full Width Content -->
		<div class="settings-layout">
			<!-- Content -->
			<div class="settings-content">
				<!-- School Profile Section -->
				<div class="settings-section active" id="schoolSection">
					<div class="setting-card">
						<div class="card-header">
							<div class="card-title school-card-header">
								<span><i class="fas fa-school"></i> School Profile</span>
								<div class="school-meta">
									<span><i class="fas fa-check-circle"></i> Profile in use</span>
									<span><i class="fas fa-shield-alt"></i> Managed by Super Admin</span>
						</div>
							</div>
						</div>
						<div class="card-body" style="display: block !important; width: 100% !important; max-width: 100% !important; overflow: visible !important; padding: 28px !important; box-sizing: border-box !important;">
							<div class="school-layout" style="width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; overflow: visible !important;">
								<div class="school-main" style="width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; overflow: visible !important; min-width: 0 !important;">
									<div class="school-section-label">School Information</div>
							<div class="form-grid">
								<div class="form-group full">
									<label class="form-label">School Name</label>
									<input type="text" class="form-input" id="schoolName" value="EduManage Pro School">
								</div>
								<div class="form-group">
									<label class="form-label">School Code</label>
									<input type="text" class="form-input" id="schoolCode" value="EMPS2024">
								</div>
								<div class="form-group">
									<label class="form-label">Established Year</label>
									<input type="number" class="form-input" id="establishedYear" value="1995">
								</div>
								<div class="form-group">
									<label class="form-label">Principal Name</label>
									<input type="text" class="form-input" id="principalName" value="Dr. Rajesh Kumar">
								</div>
								<div class="form-group">
									<label class="form-label">Board Affiliation</label>
									<select class="form-select" id="boardAffiliation">
										<option value="CBSE" selected>CBSE</option>
										<option value="ICSE">ICSE</option>
										<option value="State">State Board</option>
										<option value="IB">International Baccalaureate</option>
									</select>
								</div>
								<div class="form-group">
									<label class="form-label">Contact Email</label>
									<input type="email" class="form-input" id="schoolEmail" value="info@edumanage.edu">
								</div>
								<div class="form-group">
									<label class="form-label">Contact Phone</label>
									<input type="tel" class="form-input" id="schoolPhone" value="+91 9876543210">
								</div>
								<div class="form-group full">
									<label class="form-label">School Address</label>
									<textarea class="form-textarea" id="schoolAddress">123 Education Street, Knowledge Park, New Delhi - 110001</textarea>
								</div>
									</div>
								</div>
								<div class="school-logo-panel" style="width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; overflow: visible !important; min-width: 0 !important;">
									<div class="school-section-label">Branding</div>
									<div class="school-logo-preview" id="schoolLogoPreview">
										<span>EM</span>
									</div>
									<div class="form-group full" style="width:100%;">
										<label class="form-label" style="text-align: center; width: 100%; margin-bottom: 12px; font-size: 15px; font-weight: 700; color: #1e293b; display: block;">School Logo</label>
										<div class="logo-upload-row">
											<input type="file" id="schoolLogo" accept="image/*" style="display:none">
											<button type="button" class="btn btn-outline" id="schoolLogoBtn" style="width: 100%; padding: 14px 20px; font-weight: 600;">
												<i class="fas fa-cloud-upload-alt"></i> Choose Logo File
											</button>
											<span class="logo-file-name" id="schoolLogoFileName">No file chosen</span>
										</div>
										<span class="form-hint" style="text-align: center; width: 100%; margin-top: 8px; display: block;">Recommended: 200x200px, PNG or JPG format</span>
									</div>
								</div>
							</div>
							<div class="btn-group">
								<button class="btn btn-primary" id="saveSchoolBtn"><i class="fas fa-save"></i> Save Profile</button>
								<button class="btn btn-secondary" id="resetSchoolBtn"><i class="fas fa-undo"></i> Reset</button>
							</div>
						</div>
					</div>
				</div>

				<!-- User Management Section -->
				<div class="settings-section" id="usersSection">
					<div class="setting-card">
						<div class="card-header" style="display: flex !important; justify-content: space-between !important; align-items: center !important; width: 100% !important; max-width: 100% !important; padding: 24px 28px !important; overflow: visible !important; min-height: 70px !important; box-sizing: border-box !important; gap: 16px !important;">
							<div class="card-title" style="flex: 1 1 auto !important; min-width: 0 !important; max-width: calc(100% - 180px) !important; overflow: hidden !important; text-overflow: ellipsis !important; white-space: nowrap !important;"><i class="fas fa-users-cog"></i> User Management</div>
							<button class="btn btn-primary" id="addUserBtn" style="display: inline-flex !important; visibility: visible !important; opacity: 1 !important; position: relative !important; z-index: 100 !important; flex: 0 0 auto !important; flex-shrink: 0 !important; flex-grow: 0 !important; margin-left: auto !important; min-width: 140px !important; max-width: none !important; width: auto !important; padding: 12px 24px !important; box-sizing: border-box !important; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important; color: white !important; border: none !important; border-radius: 12px !important; cursor: pointer !important; box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4) !important; white-space: nowrap !important;"><i class="fas fa-plus"></i> Add User</button>
						</div>
						<div class="card-body" style="display: block !important; width: 100% !important; max-width: 100% !important; overflow: visible !important; padding: 28px !important; box-sizing: border-box !important;">
							<div class="stats-row" style="display: grid !important; grid-template-columns: repeat(5, 1fr) !important; gap: 16px !important; margin-bottom: 28px !important; width: 100% !important; max-width: 100% !important; box-sizing: border-box !important; overflow: visible !important;">
								<div class="stat-mini stat-total" style="display: block !important; visibility: visible !important;">
									<div class="stat-mini-value" id="totalUsersCount">0</div>
									<div class="stat-mini-label">Total Users</div>
								</div>
								<div class="stat-mini stat-students" style="display: block !important; visibility: visible !important;">
									<div class="stat-mini-value" id="studentsCount">0</div>
									<div class="stat-mini-label">Students</div>
								</div>
								<div class="stat-mini stat-admins" style="display: block !important; visibility: visible !important;">
									<div class="stat-mini-value" id="adminCount">0</div>
									<div class="stat-mini-label">Admins</div>
								</div>
								<div class="stat-mini stat-teachers" style="display: block !important; visibility: visible !important;">
									<div class="stat-mini-value" id="teacherCount">0</div>
									<div class="stat-mini-label">Teachers</div>
								</div>
								<div class="stat-mini stat-staff" style="display: block !important; visibility: visible !important;">
									<div class="stat-mini-value" id="staffCount">0</div>
									<div class="stat-mini-label">Staff</div>
								</div>
							</div>
							<div class="table-wrapper" style="overflow-x: hidden !important; width: 100% !important; max-width: 100% !important; margin-top: 28px !important; display: block !important; box-sizing: border-box !important; position: relative !important;">
								<!-- Filter Row -->
								<div class="table-filters" style="background: #f8fafc; padding: 12px 14px; border-bottom: 2px solid #e2e8f0; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr; gap: 8px; align-items: center;">
									<div class="filter-cell">
										<input type="text" id="filterUserId" placeholder="Filter User ID" class="table-filter-input" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
										<div class="filter-count" id="countUserId" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<input type="text" id="filterUsername" placeholder="Filter Username" class="table-filter-input" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
										<div class="filter-count" id="countUsername" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<input type="text" id="filterName" placeholder="Filter Name" class="table-filter-input" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
										<div class="filter-count" id="countName" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<input type="text" id="filterEmail" placeholder="Filter Email" class="table-filter-input" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
										<div class="filter-count" id="countEmail" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<select id="filterRole" class="table-filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; background: white; cursor: pointer;">
											<option value="">All Roles</option>
											<option value="SuperAdmin">Super Admin</option>
											<option value="Admin">Admin</option>
											<option value="Teacher">Teacher</option>
											<option value="Staff">Staff</option>
											<option value="Student">Student</option>
										</select>
										<div class="filter-count" id="countRole" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<select id="filterStatus" class="table-filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; background: white; cursor: pointer;">
											<option value="">All Status</option>
											<option value="Active">Active</option>
											<option value="Inactive">Inactive</option>
										</select>
										<div class="filter-count" id="countStatus" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell">
										<input type="text" id="filterLastLogin" placeholder="Filter Last Login" class="table-filter-input" style="width: 100%; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px;">
										<div class="filter-count" id="countLastLogin" style="font-size: 10px; color: #64748b; margin-top: 4px; text-align: center;">-</div>
									</div>
									<div class="filter-cell" style="display: flex; align-items: center; justify-content: center;">
										<button id="clearFilters" class="btn btn-secondary" style="padding: 8px 16px; font-size: 12px; border-radius: 8px;">Clear</button>
									</div>
								</div>
								<table class="data-table" id="usersTable" style="width: 100% !important; min-width: 0 !important; max-width: 100% !important; display: table !important; table-layout: auto !important; box-sizing: border-box !important; visibility: visible !important; opacity: 1 !important; font-size: 12px;">
									<thead>
										<tr>
											<th>User ID<div class="resize-handle"></div></th>
											<th>Username<div class="resize-handle"></div></th>
											<th>Name<div class="resize-handle"></div></th>
											<th>Email<div class="resize-handle"></div></th>
											<th>Role<div class="resize-handle"></div></th>
											<th>Status<div class="resize-handle"></div></th>
											<th>Last Login<div class="resize-handle"></div></th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="usersTableBody"></tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Academic Settings Section -->
				<div class="settings-section" id="academicSection">
					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-calendar-alt"></i> Academic Year</div>
						</div>
						<div class="card-body" style="display: block !important; width: 100% !important; max-width: 100% !important; overflow: visible !important; padding: 28px !important;">
							<div class="form-grid" style="display: grid !important; visibility: visible !important; opacity: 1 !important;">
								<div class="form-group">
									<label class="form-label">Current Academic Year</label>
									<select class="form-select" id="academicYear">
										<option value="2024-25" selected>2024-25</option>
										<option value="2023-24">2023-24</option>
										<option value="2025-26">2025-26</option>
									</select>
								</div>
								<div class="form-group">
									<label class="form-label">Session Start</label>
									<input type="date" class="form-input" id="sessionStart" value="2024-04-01">
								</div>
								<div class="form-group">
									<label class="form-label">Session End</label>
									<input type="date" class="form-input" id="sessionEnd" value="2025-03-31">
								</div>
								<div class="form-group">
									<label class="form-label">Working Days/Week</label>
									<select class="form-select" id="workingDays">
										<option value="5">5 Days (Mon-Fri)</option>
										<option value="6" selected>6 Days (Mon-Sat)</option>
									</select>
								</div>
							</div>
							<div class="btn-group">
								<button class="btn btn-primary" id="saveAcademicBtn"><i class="fas fa-save"></i> Save Academic Settings</button>
							</div>
						</div>
					</div>

					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-layer-group"></i> Classes & Sections</div>
							<button class="btn btn-primary" id="addClassBtn"><i class="fas fa-plus"></i> Add Class</button>
						</div>
						<div class="card-body" style="display: block !important; width: 100% !important; max-width: 100% !important; overflow: visible !important; padding: 28px !important;">
							<div style="overflow-x: auto !important; width: 100% !important; display: block !important;">
								<table class="data-table" style="width: 100% !important; display: table !important; visibility: visible !important; opacity: 1 !important;">
									<thead>
										<tr>
											<th>Class</th>
											<th>Sections</th>
											<th>Class Teacher</th>
											<th>Students</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="classesTableBody"></tbody>
								</table>
							</div>
						</div>
					</div>

					<div class="setting-card">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-book"></i> Subjects</div>
							<button class="btn btn-primary" id="addSubjectBtn"><i class="fas fa-plus"></i> Add Subject</button>
						</div>
						<div class="card-body">
							<div style="overflow-x: auto;">
								<table class="data-table">
									<thead>
										<tr>
											<th>Subject Code</th>
											<th>Subject Name</th>
											<th>Type</th>
											<th>Classes</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody id="subjectsTableBody"></tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Notifications Section -->
				<div class="settings-section" id="notificationsSection">
					<div class="setting-card">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-bell"></i> Notification Settings</div>
						</div>
						<div class="card-body">
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Email Notifications</h4>
									<p>Receive important updates via email</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="emailNotif" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>SMS Notifications</h4>
									<p>Send SMS alerts to parents and staff</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="smsNotif" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Fee Reminders</h4>
									<p>Automatic reminders for pending fees</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="feeReminder" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Attendance Alerts</h4>
									<p>Notify parents when student is absent</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="attendanceAlert" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Exam Notifications</h4>
									<p>Send exam schedule and result alerts</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="examNotif" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Holiday Announcements</h4>
									<p>Notify about upcoming holidays</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="holidayNotif">
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="btn-group">
								<button class="btn btn-primary" id="saveNotifBtn"><i class="fas fa-save"></i> Save Notification Settings</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Appearance Section -->
				<div class="settings-section" id="appearanceSection">
					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-palette"></i> Theme Selection</div>
						</div>
						<div class="card-body">
							<div class="theme-grid">
								<div class="theme-card active" data-theme="default">
									<div class="theme-preview" style="background: linear-gradient(135deg, #2563eb, #3b82f6);"></div>
									<div class="theme-name">Default Blue</div>
								</div>
								<div class="theme-card" data-theme="dark">
									<div class="theme-preview" style="background: linear-gradient(135deg, #1f2937, #374151);"></div>
									<div class="theme-name">Dark Mode</div>
								</div>
								<div class="theme-card" data-theme="green">
									<div class="theme-preview" style="background: linear-gradient(135deg, #16a34a, #22c55e);"></div>
									<div class="theme-name">Nature Green</div>
								</div>
								<div class="theme-card" data-theme="purple">
									<div class="theme-preview" style="background: linear-gradient(135deg, #7c3aed, #8b5cf6);"></div>
									<div class="theme-name">Royal Purple</div>
								</div>
							</div>
						</div>
					</div>

					<div class="setting-card">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-sliders-h"></i> Display Settings</div>
						</div>
						<div class="card-body">
							<div class="form-grid">
								<div class="form-group">
									<label class="form-label">Sidebar Position</label>
									<select class="form-select" id="sidebarPosition">
										<option value="left" selected>Left</option>
										<option value="right">Right</option>
									</select>
								</div>
								<div class="form-group">
									<label class="form-label">Font Size</label>
									<select class="form-select" id="fontSize">
										<option value="small">Small</option>
										<option value="medium" selected>Medium</option>
										<option value="large">Large</option>
									</select>
								</div>
								<div class="form-group">
									<label class="form-label">Date Format</label>
									<select class="form-select" id="dateFormat">
										<option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
										<option value="MM/DD/YYYY">MM/DD/YYYY</option>
										<option value="YYYY-MM-DD">YYYY-MM-DD</option>
									</select>
								</div>
								<div class="form-group">
									<label class="form-label">Time Format</label>
									<select class="form-select" id="timeFormat">
										<option value="12h" selected>12 Hour</option>
										<option value="24h">24 Hour</option>
									</select>
								</div>
							</div>
							<div class="toggle-row" style="margin-top: 20px;">
								<div class="toggle-info">
									<h4>Compact Mode</h4>
									<p>Reduce spacing for more content visibility</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="compactMode">
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="btn-group">
								<button class="btn btn-primary" id="saveAppearanceBtn"><i class="fas fa-save"></i> Save Appearance</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Security Section -->
				<div class="settings-section" id="securitySection">
					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-lock"></i> Password Policy</div>
						</div>
						<div class="card-body">
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Require Strong Password</h4>
									<p>Minimum 8 characters with numbers and symbols</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="strongPassword" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Two-Factor Authentication</h4>
									<p>Add extra security layer for admin accounts</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="twoFactor">
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="toggle-row">
								<div class="toggle-info">
									<h4>Auto Logout</h4>
									<p>Automatically logout after inactivity</p>
								</div>
								<label class="toggle-switch">
									<input type="checkbox" id="autoLogout" checked>
									<span class="toggle-slider"></span>
								</label>
							</div>
							<div class="form-group" style="margin-top: 20px;">
								<label class="form-label">Session Timeout (minutes)</label>
								<input type="number" class="form-input" id="sessionTimeout" value="30" style="width: 200px;">
							</div>
						</div>
					</div>

					<div class="setting-card">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-key"></i> Change Admin Password</div>
						</div>
						<div class="card-body">
							<div class="form-grid">
								<div class="form-group">
									<label class="form-label">Current Password</label>
									<input type="password" class="form-input" id="currentPassword" placeholder="Enter current password">
								</div>
								<div class="form-group">
									<label class="form-label">New Password</label>
									<input type="password" class="form-input" id="newPassword" placeholder="Enter new password">
								</div>
								<div class="form-group">
									<label class="form-label">Confirm Password</label>
									<input type="password" class="form-input" id="confirmPassword" placeholder="Confirm new password">
								</div>
							</div>
							<div class="btn-group">
								<button class="btn btn-danger" id="changePasswordBtn"><i class="fas fa-key"></i> Change Password</button>
							</div>
						</div>
					</div>
				</div>

				<!-- Backup Section -->
				<div class="settings-section" id="backupSection">
					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-cloud-download-alt"></i> Backup Data</div>
						</div>
						<div class="card-body">
							<p style="color: #64748b; margin-bottom: 20px;">Download a complete backup of all your school data including students, teachers, attendance, fees, and settings.</p>
							<div class="btn-group">
								<button class="btn btn-success" id="backupAllBtn"><i class="fas fa-download"></i> Download Full Backup</button>
								<button class="btn btn-primary" id="backupStudentsBtn"><i class="fas fa-user-graduate"></i> Backup Students</button>
								<button class="btn btn-secondary" id="backupTeachersBtn"><i class="fas fa-chalkboard-teacher"></i> Backup Teachers</button>
							</div>
						</div>
					</div>

					<div class="setting-card" style="margin-bottom: 24px;">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-cloud-upload-alt"></i> Restore Data</div>
						</div>
						<div class="card-body">
							<p style="color: #64748b; margin-bottom: 20px;">Restore data from a previously downloaded backup file. This will overwrite existing data.</p>
							<div class="form-group">
								<label class="form-label">Select Backup File</label>
								<input type="file" class="form-input" id="restoreFile" accept=".json">
							</div>
							<div class="btn-group">
								<button class="btn btn-danger" id="restoreBtn"><i class="fas fa-upload"></i> Restore Data</button>
							</div>
						</div>
					</div>

					<div class="setting-card">
						<div class="card-header">
							<div class="card-title"><i class="fas fa-trash-alt"></i> Clear Data</div>
						</div>
						<div class="card-body">
							<p style="color: #ef4444; margin-bottom: 20px;"><i class="fas fa-exclamation-triangle"></i> Warning: These actions cannot be undone!</p>
							<div class="btn-group">
								<button class="btn btn-danger" id="clearStudentsBtn"><i class="fas fa-user-times"></i> Clear Students</button>
								<button class="btn btn-danger" id="clearTeachersBtn"><i class="fas fa-user-times"></i> Clear Teachers</button>
								<button class="btn btn-danger" id="clearAllBtn"><i class="fas fa-bomb"></i> Clear All Data</button>
							</div>
						</div>
					</div>
		</div>

				<!-- System Info Section -->
				<div class="settings-section" id="systemSection">
					<div class="setting-card">
			<div class="card-header">
							<div class="card-title"><i class="fas fa-info-circle"></i> System Information</div>
						</div>
						<div class="card-body">
							<table class="data-table">
								<tbody>
									<tr><td style="font-weight: 600; width: 200px;">Application Name</td><td>EduManage Pro</td></tr>
									<tr><td style="font-weight: 600;">Version</td><td>2.5.0</td></tr>
									<tr><td style="font-weight: 600;">Build Date</td><td id="buildDate">November 29, 2025</td></tr>
									<tr><td style="font-weight: 600;">Browser</td><td id="browserInfo">-</td></tr>
									<tr><td style="font-weight: 600;">Screen Resolution</td><td id="screenRes">-</td></tr>
									<tr><td style="font-weight: 600;">Storage Used</td><td id="storageUsed">-</td></tr>
									<tr><td style="font-weight: 600;">Total Students</td><td id="sysStudents">0</td></tr>
									<tr><td style="font-weight: 600;">Total Teachers</td><td id="sysTeachers">0</td></tr>
									<tr><td style="font-weight: 600;">Last Backup</td><td id="lastBackup">Never</td></tr>
								</tbody>
							</table>
							<div class="btn-group" style="margin-top: 20px;">
								<button class="btn btn-secondary" id="checkUpdatesBtn"><i class="fas fa-sync-alt"></i> Check for Updates</button>
								<button class="btn btn-secondary" id="viewLogsBtn"><i class="fas fa-file-alt"></i> View Activity Log</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Add User Modal -->
	<div class="modal-overlay" id="userModal">
		<div class="modal-content">
			<div class="modal-header">
				<div class="modal-title" id="userModalTitle">
					<i class="fas fa-user-plus"></i>
					<span>Add New User</span>
				</div>
				<button class="modal-close" id="closeUserModal"><i class="fas fa-times"></i></button>
			</div>
			<div class="modal-tabs">
				<button class="modal-tab active" data-tab="details">
					<i class="fas fa-user"></i>
					<span>User Details</span>
				</button>
				<button class="modal-tab" data-tab="modules">
					<i class="fas fa-th-large"></i>
					<span>Module Access</span>
				</button>
				<button class="modal-tab" data-tab="permissions">
					<i class="fas fa-shield-alt"></i>
					<span>Permissions</span>
				</button>
				<button class="modal-tab" data-tab="profile">
					<i class="fas fa-id-card"></i>
					<span>Profile Details</span>
				</button>
			</div>
			<div class="modal-body">
				<!-- Tab 1: User Details -->
				<div class="tab-section tab-details active">
					<div class="tab-section-header">
						<div class="tab-section-header-icon">
							<i class="fas fa-user"></i>
					</div>
						<div>
							<h3 class="tab-section-title">User Details</h3>
							<p class="tab-section-subtitle">Enter basic user information for login and identification</p>
					</div>
					</div>
					<div class="form-section-card">
						<div class="form-section-label">
							<i class="fas fa-info-circle"></i>
							<span>Basic Information</span>
						</div>
						<div class="user-details-grid">
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-user"></i>
								<span>Full Name</span>
							</label>
							<div class="form-input-wrapper">
								<input type="text" class="form-input modern-input" id="userName" placeholder="Enter full name">
					</div>
						</div>
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-at"></i>
								<span>Username</span>
							</label>
							<div class="form-input-wrapper">
								<input type="text" class="form-input modern-input" id="userUsername" placeholder="Login username">
							</div>
							<div class="form-hint modern-hint">Use a short, unique ID (e.g. priya.s, teacher01).</div>
						</div>
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-envelope"></i>
								<span>Email Address</span>
							</label>
							<div class="form-input-wrapper">
								<input type="email" class="form-input modern-input" id="userEmail" placeholder="Enter email">
							</div>
						</div>
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-user-tag"></i>
								<span>Role</span>
							</label>
							<div class="form-select-wrapper">
								<select class="form-select modern-select" id="userRole">
							<option value="SuperAdmin">Super Admin</option>
							<option value="Admin">Admin</option>
							<option value="Teacher">Teacher</option>
							<option value="Staff">Staff</option>
						</select>
								<i class="fas fa-chevron-down select-arrow"></i>
					</div>
							<div class="form-hint modern-hint">Role controls default access and permissions.</div>
					</div>
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-lock"></i>
								<span>Password</span>
							</label>
							<div class="form-input-wrapper">
								<input type="password" class="form-input modern-input" id="userPassword" placeholder="Enter password (min 6 characters)">
								<i class="fas fa-eye-slash password-toggle" id="passwordToggle"></i>
							</div>
							<div class="form-hint modern-hint">Share this password securely with the user.</div>
						</div>
						<div class="user-details-group">
							<label class="form-label modern-label">
								<i class="fas fa-toggle-on"></i>
								<span>Status</span>
							</label>
							<div class="form-select-wrapper">
								<select class="form-select modern-select" id="userStatus">
							<option value="Active">Active</option>
							<option value="Inactive">Inactive</option>
						</select>
								<i class="fas fa-chevron-down select-arrow"></i>
					</div>
							<div class="form-hint modern-hint">Inactive users cannot log in.</div>
						</div>
					</div>
					</div>
				</div>

				<!-- Tab 2: Module Access -->
				<div class="tab-section tab-modules">
					<div class="tab-section-header">
						<div class="tab-section-header-icon">
							<i class="fas fa-th-large"></i>
						</div>
						<div>
							<h3 class="tab-section-title">Module Access</h3>
							<p class="tab-section-subtitle">Select which modules this user can access in the system</p>
						</div>
					</div>
					<div class="module-access-grid" id="moduleAccessGrid">
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="dashboard">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#3b82f6,#2563eb);">
								<i class="fas fa-home"></i>
					</div>
							<div class="module-card-body">
								<div class="module-card-title">Dashboard</div>
								<div class="module-card-sub">Overview &amp; widgets</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="students">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#22c55e,#16a34a);">
								<i class="fas fa-user-graduate"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Students</div>
								<div class="module-card-sub">Admissions &amp; profiles</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="teachers">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#8b5cf6,#7c3aed);">
								<i class="fas fa-chalkboard-teacher"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Teachers</div>
								<div class="module-card-sub">Staff directory</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="attendance">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#f97316,#ea580c);">
								<i class="fas fa-calendar-check"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Attendance</div>
								<div class="module-card-sub">Daily attendance</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="exams">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#facc15,#eab308);">
								<i class="fas fa-file-alt"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Exams &amp; Grades</div>
								<div class="module-card-sub">Schedules &amp; marks</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="timetable">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#06b6d4,#0ea5e9);">
								<i class="fas fa-calendar-alt"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Timetable</div>
								<div class="module-card-sub">Class schedules</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="fees">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#10b981,#059669);">
								<i class="fas fa-rupee-sign"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Fees</div>
								<div class="module-card-sub">Collections &amp; dues</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="library">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#f97316,#ea580c);">
								<i class="fas fa-book"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Library</div>
								<div class="module-card-sub">Books &amp; issues</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="transport">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#0f766e,#14b8a6);">
								<i class="fas fa-bus"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Transport</div>
								<div class="module-card-sub">Routes &amp; buses</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="hostel">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#a855f7,#7e22ce);">
								<i class="fas fa-bed"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Hostel</div>
								<div class="module-card-sub">Rooms &amp; residents</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="reports">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#0f172a,#1e293b);">
								<i class="fas fa-chart-line"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Reports &amp; Analytics</div>
								<div class="module-card-sub">Export &amp; insights</div>
							</div>
						</label>
						<label class="module-card">
							<input type="checkbox" class="module-toggle" value="settings">
							<div class="module-card-icon" style="background: linear-gradient(135deg,#4b5563,#111827);">
								<i class="fas fa-cog"></i>
							</div>
							<div class="module-card-body">
								<div class="module-card-title">Settings</div>
								<div class="module-card-sub">Configuration</div>
							</div>
						</label>
					</div>
				</div>

				<!-- Tab 3: Permissions -->
				<div class="tab-section tab-permissions">
					<div class="tab-section-header">
						<div class="tab-section-header-icon">
							<i class="fas fa-shield-alt"></i>
						</div>
						<div>
							<h3 class="tab-section-title">Module Permissions</h3>
							<p class="tab-section-subtitle">Configure access controls and define what this user can see and do in each module</p>
						</div>
					</div>
					<div class="permissions-container">
							<div class="permissions-header-content">
								<div class="permissions-icon-wrapper">
									<i class="fas fa-shield-alt"></i>
								</div>
								<div>
									<h3 class="permissions-title">Module Permissions</h3>
									<p class="permissions-subtitle">Configure access controls and define what this user can see and do in each module</p>
								</div>
							</div>
						</div>

						<div class="permissions-actions-panel">
							<div class="permissions-actions-label">
								<i class="fas fa-bolt"></i>
								<span>Quick Actions</span>
							</div>
							<div class="module-access-presets">
								<button class="preset-chip preset-chip-primary" data-preset="role">
									<span class="preset-chip-icon"><i class="fas fa-magic"></i></span>
									<span class="preset-chip-text">Apply Role Default</span>
									<span class="preset-chip-arrow"><i class="fas fa-arrow-right"></i></span>
								</button>
								<button class="preset-chip preset-chip-success" data-preset="view-all">
									<span class="preset-chip-icon"><i class="fas fa-eye"></i></span>
									<span class="preset-chip-text">Enable View All</span>
									<span class="preset-chip-arrow"><i class="fas fa-arrow-right"></i></span>
								</button>
								<button class="preset-chip preset-chip-danger" data-preset="none">
									<span class="preset-chip-icon"><i class="fas fa-ban"></i></span>
									<span class="preset-chip-text">Clear All</span>
									<span class="preset-chip-arrow"><i class="fas fa-arrow-right"></i></span>
								</button>
							</div>
						</div>

						<div class="permissions-table-wrapper">
							<div class="permissions-table-header">
								<div class="permissions-table-header-left">
									<i class="fas fa-list-check"></i>
									<span>Permission Matrix</span>
								</div>
								<div class="permissions-table-header-right">
									<span class="permissions-count-badge" id="permissionsCount">0 modules</span>
								</div>
							</div>
							<div class="permissions-table-container">
								<table class="permission-table">
									<thead>
										<tr>
											<th class="permission-col-module">
												<div class="permission-th-content">
													<i class="fas fa-cube"></i>
													<span>Module</span>
												</div>
											</th>
											<th class="permission-col-action">
												<div class="permission-th-content">
													<i class="fas fa-eye"></i>
													<span>View</span>
												</div>
											</th>
											<th class="permission-col-action">
												<div class="permission-th-content">
													<i class="fas fa-edit"></i>
													<span>Edit</span>
												</div>
											</th>
											<th class="permission-col-action">
												<div class="permission-th-content">
													<i class="fas fa-trash"></i>
													<span>Delete</span>
												</div>
											</th>
										</tr>
									</thead>
									<tbody id="permissionTableBody"></tbody>
								</table>
							</div>
						</div>

						<div class="permissions-info-card">
							<div class="permissions-info-icon">
								<i class="fas fa-info-circle"></i>
					</div>
							<div class="permissions-info-content">
								<strong>Important:</strong> If no permission is selected for a module, its tab will be completely hidden for this user. Ensure at least one permission is granted for modules that should be accessible.
					</div>
						</div>
					</div>
				</div>

				<!-- Tab 4: Profile Details -->
				<div class="tab-section tab-profile">
					<div class="profile-premium-container">
						<!-- Profile Type Selection -->
						<div class="premium-section-card">
							<div class="premium-card-header">
								<div class="premium-icon-badge">
									<i class="fas fa-user-tag"></i>
								</div>
								<div class="premium-header-content">
									<h3 class="premium-card-title">Profile Type</h3>
									<p class="premium-card-subtitle">Link this user to a student or teacher profile (optional)</p>
								</div>
							</div>
							<div class="premium-card-body">
								<div class="premium-select-group">
									<select class="premium-select" id="linkedProfileType">
										<option value="none" selected>Select profile type</option>
										<option value="student">Student Profile</option>
										<option value="teacher">Teacher Profile</option>
									</select>
								</div>
							</div>
						</div>

						<!-- Student Profile Fields -->
						<div id="studentProfileFields" class="premium-section-card" style="display: none;">
							<div class="premium-card-header">
								<div class="premium-icon-badge student-badge">
									<i class="fas fa-user-graduate"></i>
								</div>
								<div class="premium-header-content">
									<h3 class="premium-card-title">Student Information</h3>
									<p class="premium-card-subtitle">Enter academic details for the student</p>
								</div>
							</div>
							<div class="premium-card-body">
								<div class="premium-form-grid">
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-graduation-cap"></i>
											<span>Class <span class="required-star">*</span></span>
										</label>
										<select class="premium-field-input" id="studentProfileClass">
											<option value="">Select Class</option>
											<option value="1">Class 1</option>
											<option value="2">Class 2</option>
											<option value="3">Class 3</option>
											<option value="4">Class 4</option>
											<option value="5">Class 5</option>
											<option value="6">Class 6</option>
											<option value="7">Class 7</option>
											<option value="8">Class 8</option>
											<option value="9">Class 9</option>
											<option value="10">Class 10</option>
											<option value="11">Class 11</option>
											<option value="12">Class 12</option>
										</select>
										<span class="premium-error-msg" id="studentClassError"></span>
									</div>
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-hashtag"></i>
											<span>Roll Number <span class="required-star">*</span></span>
										</label>
										<input type="text" class="premium-field-input" id="studentProfileRoll" placeholder="Enter roll number">
										<span class="premium-error-msg" id="studentRollError"></span>
									</div>
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-heartbeat"></i>
											<span>Blood Group</span>
										</label>
										<select class="premium-field-input" id="studentProfileBloodGroup">
											<option value="">Select Blood Group</option>
											<option value="A+">A+</option>
											<option value="A-">A-</option>
											<option value="B+">B+</option>
											<option value="B-">B-</option>
											<option value="AB+">AB+</option>
											<option value="AB-">AB-</option>
											<option value="O+">O+</option>
											<option value="O-">O-</option>
										</select>
									</div>
								</div>
							</div>
						</div>

						<!-- Teacher Profile Fields -->
						<div id="teacherProfileFields" class="premium-section-card" style="display: none;">
							<div class="premium-card-header">
								<div class="premium-icon-badge teacher-badge">
									<i class="fas fa-chalkboard-teacher"></i>
								</div>
								<div class="premium-header-content">
									<h3 class="premium-card-title">Teacher Information</h3>
									<p class="premium-card-subtitle">Enter professional details for the teacher</p>
								</div>
							</div>
							<div class="premium-card-body">
								<div class="premium-form-grid">
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-book"></i>
											<span>Subject <span class="required-star">*</span></span>
										</label>
										<select class="premium-field-input" id="teacherProfileSubject">
											<option value="">Select Subject</option>
											<option value="Mathematics">Mathematics</option>
											<option value="Science">Science</option>
											<option value="English">English</option>
											<option value="Social Studies">Social Studies</option>
											<option value="Physics">Physics</option>
											<option value="Chemistry">Chemistry</option>
											<option value="Biology">Biology</option>
											<option value="History">History</option>
											<option value="Geography">Geography</option>
											<option value="Computer Science">Computer Science</option>
										</select>
										<span class="premium-error-msg" id="teacherSubjectError"></span>
									</div>
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-calendar-alt"></i>
											<span>Experience (Years) <span class="required-star">*</span></span>
										</label>
										<input type="number" class="premium-field-input" id="teacherProfileExperience" placeholder="Enter years of experience" min="0">
										<span class="premium-error-msg" id="teacherExperienceError"></span>
									</div>
									<div class="premium-form-field">
										<label class="premium-field-label">
											<i class="fas fa-briefcase"></i>
											<span>Designation</span>
										</label>
										<select class="premium-field-input" id="teacherProfileDesignation">
											<option value="">Select Designation</option>
											<option value="Principal">Principal</option>
											<option value="Vice Principal">Vice Principal</option>
											<option value="Head Teacher">Head Teacher</option>
											<option value="Senior Teacher">Senior Teacher</option>
											<option value="Teacher">Teacher</option>
											<option value="Assistant Teacher">Assistant Teacher</option>
										</select>
									</div>
								</div>
							</div>
						</div>

						<!-- Documents Upload Section -->
						<div class="premium-section-card">
							<div class="premium-card-header">
								<div class="premium-icon-badge document-badge">
									<i class="fas fa-file-upload"></i>
								</div>
								<div class="premium-header-content">
									<h3 class="premium-card-title">Supporting Documents</h3>
									<p class="premium-card-subtitle">Upload ID proof, certificates, or other relevant documents</p>
								</div>
							</div>
							<div class="premium-card-body">
								<input type="file" id="documentUploadInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none;">
								<div class="premium-upload-zone" id="uploadDropArea">
									<div class="premium-upload-icon">
										<i class="fas fa-cloud-upload-alt"></i>
									</div>
									<h4 class="premium-upload-title">Drag & Drop Files Here</h4>
									<p class="premium-upload-subtitle">or click to browse</p>
									<button type="button" class="premium-upload-btn" id="uploadBrowseBtn">
										<i class="fas fa-folder-open"></i> Select Files
									</button>
									<div class="premium-upload-hint">
										<i class="fas fa-info-circle"></i>
										<span>Supported formats: PDF, JPG, PNG (Max 10MB per file)</span>
									</div>
								</div>
								<div class="premium-files-list" id="uploadedFilesList"></div>
							</div>
						</div>
					</div>

				</div>
			</div>
			<div class="modal-footer">
				<div class="modal-footer-left">
					<i class="fas fa-info-circle"></i>
					<span>Complete all required fields to save</span>
				</div>
				<div class="modal-footer-right">
					<button class="btn btn-secondary" id="cancelUserBtn">
						<i class="fas fa-times"></i> Cancel
					</button>
					<button class="btn btn-primary" id="saveUserBtn" disabled>
						<i class="fas fa-save"></i> Save User
					</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		// ==================== TOAST NOTIFICATION ====================
		function notify(msg, type = 'success') {
			document.querySelectorAll('.toast').forEach(t => t.remove());
			const toast = document.createElement('div');
			const bg = type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#374151';
			const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';
			toast.style.cssText = `position:fixed;bottom:30px;right:30px;padding:16px 24px;background:${bg};color:white;border-radius:12px;font-weight:600;font-size:14px;box-shadow:0 10px 40px rgba(0,0,0,0.25);z-index:10000;display:flex;align-items:center;gap:10px;animation:slideIn 0.4s ease;font-family:'Segoe UI',sans-serif;`;
			toast.innerHTML = `<i class="fas fa-${icon}"></i> ${msg}`;
			document.body.appendChild(toast);
			if (!document.getElementById('toastStyle')) {
				const s = document.createElement('style');
				s.id = 'toastStyle';
				s.textContent = `@keyframes slideIn{from{transform:translateX(100px);opacity:0}to{transform:translateX(0);opacity:1}}`;
				document.head.appendChild(s);
			}
			setTimeout(() => { toast.style.transition = 'all 0.3s'; toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
		}

		// ==================== DATA FUNCTIONS ====================
		const load = key => { try { return JSON.parse(localStorage.getItem(key) || '[]'); } catch(e) { return []; } };
		const save = (key, data) => localStorage.setItem(key, JSON.stringify(data));
		const loadSettings = () => { try { return JSON.parse(localStorage.getItem('edu_settings') || '{}'); } catch(e) { return {}; } };
		const saveSettings = data => localStorage.setItem('edu_settings', JSON.stringify(data));
		const loadUsers = () => load('edu_users');
		const saveUsers = data => save('edu_users', data);

		// ==================== INITIALIZE DEMO DATA ====================
		function initDemoData() {
			if (loadUsers().length === 0) {
				const demoUsers = [
					{
						id: 'USR000',
						name: 'Super Admin',
						username: 'superadmin',
						email: 'superadmin@edumanage.edu',
						role: 'SuperAdmin',
						status: 'Active',
						password: 'super@123',
						lastLogin: '',
						permissions: ROLE_DEFAULT_PERMISSIONS['SuperAdmin']
					},
					{
						id: 'USR001',
						name: 'School Admin',
						username: 'admin',
						email: 'admin@edumanage.edu',
						role: 'Admin',
						status: 'Active',
						password: 'admin123',
						lastLogin: '2025-11-29 10:30',
						permissions: ROLE_DEFAULT_PERMISSIONS['Admin']
					},
					{
						id: 'USR002',
						name: 'Priya Sharma',
						username: 'teacher1',
						email: 'priya@edumanage.edu',
						role: 'Teacher',
						status: 'Active',
						password: 'teacher123',
						lastLogin: '2025-11-28 09:15',
						permissions: ROLE_DEFAULT_PERMISSIONS['Teacher']
					},
					{
						id: 'USR003',
						name: 'Rahul Verma',
						username: 'teacher2',
						email: 'rahul@edumanage.edu',
						role: 'Teacher',
						status: 'Active',
						password: 'teacher123',
						lastLogin: '2025-11-28 14:20',
						permissions: ROLE_DEFAULT_PERMISSIONS['Teacher']
					},
					{
						id: 'USR004',
						name: 'Office Staff',
						username: 'office',
						email: 'office@edumanage.edu',
						role: 'Staff',
						status: 'Active',
						password: 'office123',
						lastLogin: '2025-11-27 11:00',
						permissions: ROLE_DEFAULT_PERMISSIONS['Staff']
					},
					{
						id: 'USR005',
						name: 'Lab Assistant',
						username: 'lab',
						email: 'lab@edumanage.edu',
						role: 'Staff',
						status: 'Inactive',
						password: 'lab123',
						lastLogin: '2025-11-20 16:45',
						permissions: ROLE_DEFAULT_PERMISSIONS['Staff']
					}
				];
				saveUsers(demoUsers);
			}
		}

		// ==================== NAVIGATION ====================
		document.querySelectorAll('.nav-item').forEach(item => {
			item.addEventListener('click', () => {
				document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
				document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
				item.classList.add('active');
				document.getElementById(item.dataset.section + 'Section').classList.add('active');
			});
		});

		// ==================== RENDER USERS ====================
		let allUsersData = [];
		let filteredUsersData = [];
		
		function renderUsers(filteredUsers = null) {
			const users = filteredUsers || loadUsers();
			allUsersData = loadUsers();
			filteredUsersData = users;
			
			// Count admins - include both Admin and SuperAdmin
			const admins = users.filter(u => u.role === 'Admin' || u.role === 'SuperAdmin').length;
			const teachers = users.filter(u => u.role === 'Teacher').length;
			const staff = users.filter(u => u.role === 'Staff').length;
			
			// Count students - from users with Student role or linkedProfile type student
			const studentsFromUsers = users.filter(u => u.role === 'Student' || (u.linkedProfile && u.linkedProfile.type === 'student')).length;
			// Also count from students storage
			const studentsData = load('edu_students');
			const studentsCount = Math.max(studentsFromUsers, studentsData.length);

			document.getElementById('totalUsersCount').textContent = users.length;
			document.getElementById('studentsCount').textContent = studentsCount;
			document.getElementById('adminCount').textContent = admins;
			document.getElementById('teacherCount').textContent = teachers;
			document.getElementById('staffCount').textContent = staff;

			if (users.length === 0) {
				document.getElementById('usersTableBody').innerHTML = `
					<tr>
						<td colspan="8" style="text-align:center;padding:60px 20px;">
							<div style="display:flex;flex-direction:column;align-items:center;gap:16px;">
								<div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);display:flex;align-items:center;justify-content:center;">
									<i class="fas fa-users" style="font-size:32px;color:#94a3b8;"></i>
								</div>
								<div>
									<h3 style="margin:0;color:#475569;font-size:18px;font-weight:700;">No Users Found</h3>
									<p style="margin:8px 0 0;color:#94a3b8;font-size:14px;">Click "Add New User" to create your first user</p>
								</div>
							</div>
						</td>
					</tr>
				`;
				return;
			}

			// Update filter counts on initial load
			if (!filteredUsers) {
				updateFilterCounts(users, '', '', '', '', '', '', '');
			}
			
			document.getElementById('usersTableBody').innerHTML = users.map(u => {
				// Ensure role and status always have values
				let role = u.role || 'Staff';
				let status = u.status || 'Active';
				
				// Normalize role names
				if (role === 'SuperAdmin' || role === 'superadmin') {
					role = 'SuperAdmin';
				} else if (role === 'Admin' || role === 'admin') {
					role = 'Admin';
				} else if (role === 'Teacher' || role === 'teacher') {
					role = 'Teacher';
				} else {
					role = 'Staff';
				}
				
				// Normalize status
				status = (status === 'Active' || status === 'active') ? 'Active' : 'Inactive';
				
				const initials = u.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
				const roleLower = role.toLowerCase();
				const statusLower = status.toLowerCase();
				
				// Role icon mapping
				const roleIcons = {
					'superadmin': 'fa-crown',
					'admin': 'fa-user-shield',
					'teacher': 'fa-chalkboard-teacher',
					'staff': 'fa-user-tie'
				};
				
				return `
				<tr>
					<td style="min-width:120px !important;padding:12px 16px !important;visibility:visible !important;display:table-cell !important;">
						<div style="display:flex;align-items:center;gap:10px;min-width:0;width:100%;">
							<div style="width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:14px;box-shadow:0 2px 8px rgba(102,126,234,0.3);flex-shrink:0;">
								${initials}
							</div>
							<strong style="color:#1e293b;white-space:nowrap;display:block;" title="${u.id}">${u.id}</strong>
						</div>
					</td>
					<td style="width:150px !important;min-width:150px !important;max-width:150px !important;padding:12px 16px !important;visibility:visible !important;display:table-cell !important;">
						<div style="display:flex;align-items:center;gap:8px;min-width:0;width:100%;">
							<i class="fas fa-user" style="color:#94a3b8;font-size:12px;flex-shrink:0;"></i>
							<span style="color:#475569;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:120px;display:block;" title="${u.username || '-'}">${u.username || '<span style="color:#cbd5e1;">-</span>'}</span>
						</div>
					</td>
					<td style="width:200px !important;min-width:200px !important;max-width:200px !important;padding:12px 16px !important;visibility:visible !important;display:table-cell !important;">
						<div style="font-weight:600;color:#1e293b;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;" title="${u.name}">${u.name}</div>
					</td>
					<td style="min-width:200px !important;">
						<div style="display:flex;align-items:center;gap:8px;min-width:0;width:100%;">
							<i class="fas fa-envelope" style="color:#94a3b8;font-size:12px;flex-shrink:0;"></i>
							<span style="color:#64748b;white-space:nowrap;display:block;cursor:help;border-bottom:1px dotted #64748b;" title="${u.email}">${u.email}</span>
						</div>
					</td>
					<td style="text-align:center;vertical-align:middle;">
						<span class="badge ${roleLower}" style="cursor:default;display:inline-flex;align-items:center;gap:6px;">
							<i class="fas ${roleIcons[roleLower] || 'fa-user'}" style="font-size:11px;"></i>
							<span style="white-space:nowrap;">${role}</span>
						</span>
					</td>
					<td style="text-align:center;vertical-align:middle;">
						<span class="badge ${statusLower}" style="cursor:default;display:inline-flex;align-items:center;gap:6px;">
							<i class="fas ${statusLower === 'active' ? 'fa-check-circle' : 'fa-times-circle'}" style="font-size:11px;"></i>
							<span style="white-space:nowrap;">${status}</span>
						</span>
					</td>
					<td>
						<div style="display:flex;align-items:center;gap:10px;min-width:0;padding:6px 12px;background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);border-radius:10px;border:1px solid #e2e8f0;">
							<div style="width:32px;height:32px;border-radius:8px;background:linear-gradient(135deg,#6366f1 0%,#4f46e5 100%);display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 2px 6px rgba(99,102,241,0.25);">
								<i class="fas fa-clock" style="color:white;font-size:12px;"></i>
							</div>
							<span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#475569;font-weight:600;font-size:13px;" title="${u.lastLogin || 'Never'}">${u.lastLogin || '<span style="color:#94a3b8;font-weight:500;">Never</span>'}</span>
						</div>
					</td>
					<td>
						<div class="action-btn-group" style="justify-content:center;gap:6px;">
							${role === 'SuperAdmin' ? '' : `
								<button class="action-btn view" title="${status === 'Active' ? 'Disable user' : 'Activate user'}" onclick="toggleUserStatus('${u.id}')" style="background:${statusLower === 'active' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #64748b 0%, #475569 100%)'};box-shadow:0 3px 10px ${statusLower === 'active' ? 'rgba(16,185,129,0.3)' : 'rgba(100,116,139,0.3)'};">
									<i class="fas fa-power-off"></i>
								</button>
							`}
							<button class="action-btn edit" onclick="editUser('${u.id}')" title="Edit User" style="box-shadow:0 3px 10px rgba(59,130,246,0.3);">
								<i class="fas fa-edit"></i>
							</button>
							${role === 'SuperAdmin' ? '' : `
								<button class="action-btn delete" onclick="deleteUser('${u.id}')" title="Delete User" style="box-shadow:0 3px 10px rgba(239,68,68,0.3);">
									<i class="fas fa-trash"></i>
								</button>
							`}
						</div>
					</td>
				</tr>
			`;
			}).join('');
		}

		// ==================== RENDER CLASSES ====================
		function renderClasses() {
			const students = load('edu_students');
			const classes = ['9', '10', '11', '12'];
			document.getElementById('classesTableBody').innerHTML = classes.map(c => {
				const count = students.filter(s => s.class === c).length;
				return `
					<tr>
						<td><strong>Class ${c}</strong></td>
						<td>A, B, C</td>
						<td>-</td>
						<td>${count}</td>
						<td>
							<button class="action-btn edit"><i class="fas fa-edit"></i></button>
							<button class="action-btn delete"><i class="fas fa-trash"></i></button>
						</td>
					</tr>
				`;
			}).join('');
		}

		// ==================== RENDER SUBJECTS ====================
		function renderSubjects() {
			const subjects = [
				{ code: 'MATH', name: 'Mathematics', type: 'Core', classes: '9-12' },
				{ code: 'SCI', name: 'Science', type: 'Core', classes: '9-10' },
				{ code: 'ENG', name: 'English', type: 'Core', classes: '9-12' },
				{ code: 'PHY', name: 'Physics', type: 'Core', classes: '11-12' },
				{ code: 'CHEM', name: 'Chemistry', type: 'Core', classes: '11-12' },
				{ code: 'CS', name: 'Computer Science', type: 'Elective', classes: '9-12' },
				{ code: 'PE', name: 'Physical Education', type: 'Elective', classes: '9-12' }
			];
			document.getElementById('subjectsTableBody').innerHTML = subjects.map(s => `
				<tr>
					<td><strong>${s.code}</strong></td>
					<td>${s.name}</td>
					<td><span class="badge ${s.type === 'Core' ? 'active' : 'staff'}">${s.type}</span></td>
					<td>${s.classes}</td>
					<td>
						<button class="action-btn edit"><i class="fas fa-edit"></i></button>
						<button class="action-btn delete"><i class="fas fa-trash"></i></button>
					</td>
				</tr>
			`).join('');
		}

		// ==================== SYSTEM INFO ====================
		function renderSystemInfo() {
			document.getElementById('browserInfo').textContent = navigator.userAgent.split(' ').slice(-2).join(' ');
			document.getElementById('screenRes').textContent = `${window.screen.width} x ${window.screen.height}`;
			const students = load('edu_students');
			const teachers = load('edu_teachers');
			document.getElementById('sysStudents').textContent = students.length;
			document.getElementById('sysTeachers').textContent = teachers.length;
			
			// Calculate storage
			let totalSize = 0;
			for (let key in localStorage) {
				if (localStorage.hasOwnProperty(key)) {
					totalSize += localStorage[key].length * 2; // UTF-16
				}
			}
			document.getElementById('storageUsed').textContent = (totalSize / 1024).toFixed(2) + ' KB';
			
			const lastBackup = loadSettings().lastBackup;
			document.getElementById('lastBackup').textContent = lastBackup || 'Never';

			// Update school logo preview initials
			try {
				const name = document.getElementById('schoolName')?.value || 'School';
				const initials = name.split(' ').map(n => n[0]).join('').slice(0,2).toUpperCase();
				const preview = document.getElementById('schoolLogoPreview');
				if (preview) {
					preview.textContent = initials;
					preview.style.backgroundImage = '';
				}
			} catch(e) {}
		}

		// ==================== USER MODAL ====================
		let editingUserId = null;
		const currentRoleKey = (localStorage.getItem('edu_role') || 'SuperAdmin').toLowerCase();

		// Build module list dynamically from Module Access grid
		const MODULE_DEFINITIONS = (() => {
			const toggles = document.querySelectorAll('#moduleAccessGrid .module-toggle');
			return Array.from(toggles).map(cb => {
				const labelEl = cb.closest('label');
				const titleEl = labelEl?.querySelector('.module-card-title');
				const labelText = (titleEl?.textContent || labelEl?.textContent || cb.value || '').trim();
				return {
					key: cb.value,
					label: labelText
				};
			});
		})();

		const ROLE_DEFAULT_PERMISSIONS = {
			SuperAdmin: MODULE_DEFINITIONS.reduce((acc, m) => {
				acc[m.key] = { view: true, edit: true, delete: true };
				return acc;
			}, {}),
			Admin: {
				dashboard:  { view: true, edit: false, delete: false },
				students:   { view: true, edit: true,  delete: true },
				teachers:   { view: true, edit: true,  delete: false },
				attendance: { view: true, edit: true,  delete: false },
				exams:      { view: true, edit: true,  delete: false },
				timetable:  { view: true, edit: true,  delete: false },
				fees:       { view: true, edit: true,  delete: false },
				library:    { view: true, edit: true,  delete: false },
				transport:  { view: true, edit: true,  delete: false },
				hostel:     { view: true, edit: true,  delete: false },
				reports:    { view: true, edit: false, delete: false },
				settings:   { view: true, edit: true,  delete: false }
			},
			Teacher: {
				dashboard:  { view: true, edit: false, delete: false },
				students:   { view: true, edit: false, delete: false },
				attendance: { view: true, edit: true,  delete: false },
				exams:      { view: true, edit: true,  delete: false },
				timetable:  { view: true, edit: false, delete: false },
				reports:    { view: true, edit: false, delete: false }
			},
			Staff: {
				dashboard: { view: true, edit: false, delete: false },
				students:  { view: true, edit: true,  delete: false },
				fees:      { view: true, edit: true,  delete: false },
				library:   { view: true, edit: false, delete: false },
				reports:   { view: true, edit: false, delete: false }
			}
		};

		// Modules that are currently enabled for this user (from Module Access tab)
		let currentEnabledModules = [];

		function renderPermissionTable(currentPerms = {}, roleForDefaults = 'Admin') {
			const body = document.getElementById('permissionTableBody');
			if (!body) return;

			// Always sync enabled modules with current selections in Module Access
			const toggles = Array.from(document.querySelectorAll('.module-toggle'));
			const selectedFromUI = toggles
				.filter(cb => cb.checked)
				.map(cb => cb.value);
			// Even if zero selected, reflect that explicitly (no modules  no rows)
			currentEnabledModules = selectedFromUI;

			const roleDefaults = ROLE_DEFAULT_PERMISSIONS[roleForDefaults] || {};
			body.innerHTML = MODULE_DEFINITIONS
				// Only show modules that are currently enabled in Module Access
				.filter(m => currentEnabledModules.includes(m.key))
				.map(m => {
				const base = currentPerms[m.key] || roleDefaults[m.key] || { view: false, edit: false, delete: false };
				return `
					<tr class="permission-row" data-module="${m.key}">
						<td class="permission-module-cell">${m.label}</td>
						<td style="text-align:center;"><input type="checkbox" class="perm-view"   ${base.view   ? 'checked' : ''}></td>
						<td style="text-align:center;"><input type="checkbox" class="perm-edit"   ${base.edit   ? 'checked' : ''}></td>
						<td style="text-align:center;"><input type="checkbox" class="perm-delete" ${base.delete ? 'checked' : ''}></td>
					</tr>
				`;
			}).join('');
			
			// Add event listeners to checkboxes for real-time count update
			body.querySelectorAll('input[type="checkbox"]').forEach(cb => {
				cb.addEventListener('change', updatePermissionsCount);
			});
			
			updatePermissionsCount();
			
			// Add event listeners to checkboxes for real-time count update
			body.querySelectorAll('input[type="checkbox"]').forEach(cb => {
				cb.addEventListener('change', updatePermissionsCount);
			});
			
			updatePermissionsCount();
		}

		function updatePermissionsCount() {
			const body = document.getElementById('permissionTableBody');
			const countEl = document.getElementById('permissionsCount');
			if (!body || !countEl) return;
			const count = body.querySelectorAll('tr[data-module]').length;
			countEl.textContent = `${count} ${count === 1 ? 'module' : 'modules'}`;
		}

		function collectPermissionsFromUI() {
			const body = document.getElementById('permissionTableBody');
			const perms = {};
			if (!body) return perms;
			body.querySelectorAll('tr[data-module]').forEach(row => {
				const key = row.dataset.module;
				const view   = row.querySelector('.perm-view')?.checked   || false;
				const edit   = row.querySelector('.perm-edit')?.checked   || false;
				const del    = row.querySelector('.perm-delete')?.checked || false;
				// Only store modules that have at least one permission granted
				if (view || edit || del) {
					perms[key] = { view, edit, delete: del };
				}
			});
			updatePermissionsCount();
			return perms;
		}

		function validateUserDetails(showErrors = true) {
			const name = document.getElementById('userName').value.trim();
			const username = document.getElementById('userUsername').value.trim();
			const email = document.getElementById('userEmail').value.trim();
			const password = document.getElementById('userPassword').value;
			if (!name || !username || !email) {
				if (showErrors) {
				notify('Please fill in name, username and email.', 'error');
				}
				return false;
			}
			if (!editingUserId && (!password || password.length < 6)) {
				if (showErrors) {
				notify('Password must be at least 6 characters.', 'error');
				}
				return false;
			}
			return true;
		}

		function updateSaveButtonState() {
			const saveBtn = document.getElementById('saveUserBtn');
			if (!saveBtn) return;
			// Silent validation while typing  no error toasts here
			const basicOk = validateUserDetails(false);
			const anyModule = Array.from(document.querySelectorAll('.module-toggle'))
				.some(cb => cb.checked);
			const perms = collectPermissionsFromUI();
			const anyPerm = Object.values(perms).some(p => p.view || p.edit || p.delete);
			saveBtn.disabled = !(basicOk && anyModule && anyPerm);
		}

		// Document upload handling
		let uploadedDocuments = [];
		
		function updateProfileFormsVisibility() {
			const type = document.getElementById('linkedProfileType')?.value || 'none';
			const studentFields = document.getElementById('studentProfileFields');
			const teacherFields = document.getElementById('teacherProfileFields');
			
			// Show/hide fields based on selection
			if (studentFields) {
				studentFields.style.display = type === 'student' ? 'block' : 'none';
			}
			if (teacherFields) {
				teacherFields.style.display = type === 'teacher' ? 'block' : 'none';
			}
			
			// Clear validation errors when switching
			document.querySelectorAll('.premium-error-msg').forEach(el => {
				el.classList.remove('show');
			});
			document.querySelectorAll('.premium-field-input.error').forEach(el => {
				el.classList.remove('error');
			});
		}
		
		// File Upload Handling - Premium Design
		let uploadedFiles = [];
		
		function formatFileSize(bytes) {
			if (bytes === 0) return '0 Bytes';
			const k = 1024;
			const sizes = ['Bytes', 'KB', 'MB'];
			const i = Math.floor(Math.log(bytes) / Math.log(k));
			return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
		}
		
		function renderUploadedFiles() {
			const list = document.getElementById('uploadedFilesList');
			if (!list) return;
			
			if (uploadedFiles.length === 0) {
				list.innerHTML = '';
				return;
			}
			
			list.innerHTML = uploadedFiles.map((file, index) => {
				const isImage = file.type.startsWith('image/');
				const iconClass = file.type === 'application/pdf' ? 'pdf' : 'img';
				const icon = file.type === 'application/pdf' ? 'fa-file-pdf' : 'fa-file-image';
				const size = formatFileSize(file.size);
				
				return `
					<div class="uploaded-file-chip">
						<div class="file-chip-info">
							<div class="file-chip-icon ${iconClass}">
								<i class="fas ${icon}"></i>
							</div>
							<span class="file-chip-name">${file.name}</span>
							<span class="file-chip-size">${size}</span>
						</div>
						<button type="button" class="file-chip-delete" onclick="removeFile(${index})">
							<i class="fas fa-times"></i>
						</button>
					</div>
				`;
			}).join('');
		}
		
		function removeFile(index) {
			uploadedFiles.splice(index, 1);
			renderUploadedFiles();
		}
		
		window.removeFile = removeFile;
		
		// Drag and Drop Implementation
		function initFileUpload() {
			const dropArea = document.getElementById('uploadDropArea');
			const fileInput = document.getElementById('documentUploadInput');
			
			if (!dropArea || !fileInput) return;
			
			['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
				dropArea.addEventListener(eventName, preventDefaults, false);
			});
			
			function preventDefaults(e) {
				e.preventDefault();
				e.stopPropagation();
			}
			
			['dragenter', 'dragover'].forEach(eventName => {
				dropArea.addEventListener(eventName, () => {
					dropArea.classList.add('drag-over');
				}, false);
			});
			
			['dragleave', 'drop'].forEach(eventName => {
				dropArea.addEventListener(eventName, () => {
					dropArea.classList.remove('drag-over');
				}, false);
			});
			
			dropArea.addEventListener('drop', handleDrop, false);
			dropArea.addEventListener('click', () => fileInput.click());
			
			fileInput.addEventListener('change', handleFiles);
			
			function handleDrop(e) {
				const dt = e.dataTransfer;
				const files = dt.files;
				handleFiles({ target: { files } });
			}
			
			function handleFiles(e) {
				const files = Array.from(e.target.files || []);
				files.forEach(file => {
					if (file.size > 10 * 1024 * 1024) {
						notify('File size exceeds 10MB limit: ' + file.name, 'error');
						return;
					}
					uploadedFiles.push(file);
				});
				renderUploadedFiles();
				fileInput.value = '';
			}
		}

		// Accordion Toggle Functionality
		function initProfileAccordions() {
			document.querySelectorAll('.profile-accordion-header').forEach(header => {
				header.addEventListener('click', function() {
					const toggleId = this.dataset.toggle;
					const body = document.getElementById(toggleId + 'Body');
					
					if (body) {
						const isActive = body.classList.contains('active');
						
						// Close all other accordions in the same card (if needed)
						// For now, allow multiple open
						
						// Toggle current
						body.classList.toggle('active');
						this.classList.toggle('active');
					}
				});
			});
		}

		function formatFileSize(bytes) {
			if (bytes === 0) return '0 Bytes';
			const k = 1024;
			const sizes = ['Bytes', 'KB', 'MB'];
			const i = Math.floor(Math.log(bytes) / Math.log(k));
			return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
		}

		function renderUploadedDocuments() {
			const list = document.getElementById('uploadedDocumentsList');
			if (!list) return;
			
			if (uploadedDocuments.length === 0) {
				list.innerHTML = '';
				return;
			}

			list.innerHTML = uploadedDocuments.map((doc, idx) => `
				<div class="document-item">
					<div class="document-item-info">
						<div class="document-item-icon">
							<i class="fas fa-file-${doc.type === 'application/pdf' ? 'pdf' : 'image'}"></i>
						</div>
						<div class="document-item-details">
							<div class="document-item-name">${doc.name}</div>
							<div class="document-item-size">${formatFileSize(doc.size)}</div>
						</div>
					</div>
					<div class="document-item-actions">
						<button type="button" class="document-item-btn view" onclick="viewDocument(${idx})" title="View">
							<i class="fas fa-eye"></i>
						</button>
						<button type="button" class="document-item-btn" onclick="removeDocument(${idx})" title="Remove">
							<i class="fas fa-times"></i>
						</button>
					</div>
				</div>
			`).join('');
		}

		window.viewDocument = function(idx) {
			const doc = uploadedDocuments[idx];
			if (doc && doc.data) {
				const newWindow = window.open();
				if (doc.type === 'application/pdf') {
					newWindow.document.write(`<iframe src="${doc.data}" style="width:100%;height:100vh;border:none;"></iframe>`);
				} else {
					newWindow.document.write(`<img src="${doc.data}" style="max-width:100%;height:auto;">`);
				}
			}
		};

		window.removeDocument = function(idx) {
			uploadedDocuments.splice(idx, 1);
			renderUploadedDocuments();
		};

		// Document upload event listeners
		document.getElementById('linkedProfileType')?.addEventListener('change', () => {
			updateProfileFormsVisibility();
		});
		
		// Initialize accordions
		initProfileAccordions();
		
		document.getElementById('uploadDocumentsBtn')?.addEventListener('click', () => {
			document.getElementById('documentUploadInput')?.click();
		});

		document.getElementById('documentUploadInput')?.addEventListener('change', (e) => {
			const files = Array.from(e.target.files);
			files.forEach(file => {
				const reader = new FileReader();
				reader.onload = (event) => {
					uploadedDocuments.push({
						name: file.name,
						size: file.size,
						type: file.type,
						data: event.target.result
					});
					renderUploadedDocuments();
				};
				reader.readAsDataURL(file);
			});
			e.target.value = '';
		});

		// Preset chips for quick selection
		document.addEventListener('click', (e) => {
			const chip = e.target.closest('.preset-chip');
			if (!chip) return;
			const preset = chip.dataset.preset;
			const role = document.getElementById('userRole')?.value || 'Admin';

			if (preset === 'role') {
				// Apply role defaults to both Module Access and Permissions
				const roleDefaults = ROLE_DEFAULT_PERMISSIONS[role] || {};
				currentEnabledModules = Object.keys(roleDefaults);
				document.querySelectorAll('.module-toggle').forEach(cb => {
					cb.checked = !!roleDefaults[cb.value];
				});
				renderPermissionTable({}, role);
				updateSaveButtonState();
				return;
			}

			const body = document.getElementById('permissionTableBody');
			if (!body) return;

			if (preset === 'view-all') {
				body.querySelectorAll('.perm-view').forEach(cb => cb.checked = true);
				body.querySelectorAll('.perm-edit, .perm-delete').forEach(cb => cb.checked = false);
				updateSaveButtonState();
				return;
			}

			if (preset === 'none') {
				body.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
				updateSaveButtonState();
			}
		});

		document.getElementById('addUserBtn').addEventListener('click', () => {
			if (currentRoleKey !== 'superadmin') {
				notify('Only Super Admin can create users.', 'error');
				return;
			}
			editingUserId = null;
			document.getElementById('userModalTitle').textContent = 'Add New User';
			document.getElementById('userName').value = '';
			document.getElementById('userUsername').value = '';
			document.getElementById('userEmail').value = '';
			document.getElementById('userRole').value = 'Teacher';
			document.getElementById('userPassword').value = '';
			document.getElementById('userStatus').value = 'Active';

			// Reset tabs to first step
			document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
			document.querySelector('.modal-tab[data-tab="details"]').classList.add('active');
			document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active'));
			document.querySelector('.tab-details').classList.add('active');

			// Initialise enabled modules and UI based on default Teacher role
			currentEnabledModules = Object.keys(ROLE_DEFAULT_PERMISSIONS['Teacher'] || {});
			document.querySelectorAll('.module-toggle').forEach(cb => {
				cb.checked = currentEnabledModules.includes(cb.value);
			});
			renderPermissionTable({}, 'Teacher');
			
			// Reset profile forms
			document.getElementById('linkedProfileType').value = 'none';
			updateProfileFormsVisibility();
			uploadedDocuments = [];
			renderUploadedDocuments();
			
			// Clear all profile fields
			['studentProfileClass', 'studentProfileSection', 'studentProfileRoll', 'studentProfileDOB', 
			 'studentProfileGender', 'studentProfileAddress', 'studentProfileParentName', 'studentProfileParentPhone',
			 'teacherProfileSubject', 'teacherProfilePhone', 'teacherProfileExperience', 
			 'teacherProfileQualification', 'teacherProfileGender', 'teacherProfileAddress'].forEach(id => {
				const el = document.getElementById(id);
				if (el) el.value = '';
			});
			
			document.getElementById('userModal').classList.add('active');
			updateSaveButtonState();
		});

		document.getElementById('closeUserModal').addEventListener('click', () => {
			document.getElementById('userModal').classList.remove('active');
		});

		document.getElementById('cancelUserBtn').addEventListener('click', () => {
			document.getElementById('userModal').classList.remove('active');
		});

		// Update save button when typing / changing controls
		['userName','userUsername','userEmail','userPassword','userRole','userStatus'].forEach(id => {
			const el = document.getElementById(id);
			if (el) {
				el.addEventListener('input', updateSaveButtonState);
				el.addEventListener('change', updateSaveButtonState);
			}
		});

		// Password Toggle Functionality
		const passwordToggle = document.getElementById('passwordToggle');
		const userPasswordInput = document.getElementById('userPassword');
		if (passwordToggle && userPasswordInput) {
			passwordToggle.addEventListener('click', function() {
				const type = userPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
				userPasswordInput.setAttribute('type', type);
				this.classList.toggle('fa-eye-slash');
				this.classList.toggle('fa-eye');
			});
		}

		document.getElementById('moduleAccessGrid')?.addEventListener('change', e => {
			if (e.target.classList.contains('module-toggle')) {
				// update enabled modules list
				currentEnabledModules = Array.from(document.querySelectorAll('.module-toggle'))
					.filter(cb => cb.checked)
					.map(cb => cb.value);
				renderPermissionTable(collectPermissionsFromUI(), document.getElementById('userRole')?.value || 'Admin');
				updateSaveButtonState();
			}
		});
		document.getElementById('linkedProfileType')?.addEventListener('change', () => {
			updateProfileFormsVisibility();
		});
		document.getElementById('permissionTableBody')?.addEventListener('change', e => {
			if (e.target.matches('input[type="checkbox"]')) {
				updateSaveButtonState();
				updatePermissionsCount();
			}
		});

		// Wizard tab buttons
		function goToTab(key) {
			document.querySelectorAll('.modal-tab').forEach(t => {
				t.classList.toggle('active', t.dataset.tab === key);
			});
			document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active'));
			const target = document.querySelector(`.tab-${key}`);
			if (target) target.classList.add('active');
		}

		document.querySelectorAll('.modal-tab').forEach(tab => {
			tab.addEventListener('click', () => goToTab(tab.dataset.tab));
		});

		// Tab Navigation Function
		function goToTab(tabName) {
			// Update active tab
			document.querySelectorAll('.modal-tab').forEach(t => {
				if (t.dataset.tab === tabName) {
					t.classList.add('active');
				} else {
					t.classList.remove('active');
				}
			});
			
			// Update active section
			document.querySelectorAll('.tab-section').forEach(s => {
				if (s.classList.contains(`tab-${tabName}`)) {
					s.classList.add('active');
				} else {
					s.classList.remove('active');
				}
			});
			
			// Scroll to top of modal body
			document.querySelector('.modal-body').scrollTop = 0;
		}

		// Tab Navigation - Click tabs to switch
		document.querySelectorAll('.modal-tab').forEach(tab => {
			tab.addEventListener('click', () => {
				const targetTab = tab.dataset.tab;
				
				// Optional validation before switching tabs
				if (targetTab === 'modules' && !validateUserDetails(false)) {
					notify('Please complete required fields in User Details', 'error');
					return;
				}
				if (targetTab === 'permissions') {
				const anyModule = Array.from(document.querySelectorAll('.module-toggle'))
					.some(cb => cb.checked);
				if (!anyModule) {
					notify('Select at least one module for this user.', 'error');
					return;
				}
					// Rebuild permission table based on current module selections
					const role = document.getElementById('userRole')?.value || 'Admin';
					renderPermissionTable(collectPermissionsFromUI(), role);
		}
				
				goToTab(targetTab);
			});
		});

		document.getElementById('saveUserBtn').addEventListener('click', () => {
			if (currentRoleKey !== 'superadmin') {
				notify('Only Super Admin can manage users.', 'error');
				return;
			}
			if (!validateUserDetails()) return;
			const name = document.getElementById('userName').value.trim();
			const username = document.getElementById('userUsername').value.trim();
			const email = document.getElementById('userEmail').value.trim();
			// Always capture a valid role; fallback to Teacher if something goes wrong
			const roleSelect = document.getElementById('userRole');
			const role = roleSelect && roleSelect.value ? roleSelect.value : 'Teacher';
			const password = document.getElementById('userPassword').value;
			const status = document.getElementById('userStatus').value;
			const permissions = collectPermissionsFromUI();
			const linkedType = document.getElementById('linkedProfileType')?.value || 'none';
			let linkedProfile = null;
			let profileData = null;
			
			if (linkedType === 'student') {
				profileData = {
					class: document.getElementById('studentProfileClass')?.value || '',
					roll: document.getElementById('studentProfileRoll')?.value || '',
					bloodGroup: document.getElementById('studentProfileBloodGroup')?.value || ''
				};
				linkedProfile = {
					type: 'student',
					...profileData,
					documents: uploadedFiles.map(f => ({
						name: f.name,
						size: f.size,
						type: f.type
					}))
				};
				
				// Also save/update in students storage
				const students = load('edu_students');
				if (editingUserId) {
					// Update existing student if found
					const existingIdx = students.findIndex(s => s.userId === editingUserId);
					if (existingIdx >= 0) {
						students[existingIdx] = {
							...students[existingIdx],
							name: name,
							email: email,
							phone: profileData.parentPhone,
							class: profileData.class,
							section: profileData.section,
							gender: profileData.gender || students[existingIdx].gender || 'Male',
							dob: profileData.dob,
							address: profileData.address,
							parent: profileData.parentName,
							parentContact: profileData.parentPhone,
							documents: uploadedDocuments
						};
					} else {
						// Create new student record
						const studentId = 'STU-' + new Date().getFullYear() + '-' + String(students.length + 1).padStart(3, '0');
						students.push({
							id: studentId,
							name: name,
							email: email,
							phone: profileData.parentPhone,
							class: profileData.class,
							section: profileData.section,
							gender: profileData.gender || 'Male',
							dob: profileData.dob,
							address: profileData.address,
							parent: profileData.parentName,
							parentContact: profileData.parentPhone,
							status: 'Active',
							documents: uploadedDocuments,
							userId: editingUserId
						});
					}
				} else {
					// New user - create student record
					const studentId = 'STU-' + new Date().getFullYear() + '-' + String(students.length + 1).padStart(3, '0');
					students.push({
						id: studentId,
						name: name,
						email: email,
						phone: profileData.parentPhone,
						class: profileData.class,
						section: profileData.section,
						gender: profileData.gender || 'Male',
						dob: profileData.dob,
						address: profileData.address,
						parent: profileData.parentName,
						parentContact: profileData.parentPhone,
						status: 'Active',
						documents: uploadedDocuments,
						userId: null // Will be set after user is created
					});
				}
				save('edu_students', students);
			} else if (linkedType === 'teacher') {
				profileData = {
					subject: document.getElementById('teacherProfileSubject')?.value || '',
					phone: document.getElementById('teacherProfilePhone')?.value || '',
					experience: document.getElementById('teacherProfileExperience')?.value || '',
					qualification: document.getElementById('teacherProfileQualification')?.value || '',
					gender: document.getElementById('teacherProfileGender')?.value || '',
					address: document.getElementById('teacherProfileAddress')?.value || ''
				};
				linkedProfile = {
					type: 'teacher',
					...profileData,
					documents: uploadedDocuments
				};
				
				// Also save/update in teachers storage
				const teachers = load('edu_teachers');
				if (editingUserId) {
					// Update existing teacher if found
					const existingIdx = teachers.findIndex(t => t.userId === editingUserId);
					if (existingIdx >= 0) {
						teachers[existingIdx] = {
							...teachers[existingIdx],
							name: name,
							email: email,
							phone: profileData.phone,
							subject: profileData.subject,
							gender: profileData.gender || teachers[existingIdx].gender || 'Male',
							experience: profileData.experience,
							qualification: profileData.qualification,
							address: profileData.address,
							documents: uploadedDocuments
						};
					} else {
						// Create new teacher record
						const teacherId = 'TCH-' + new Date().getFullYear() + '-' + String(teachers.length + 1).padStart(3, '0');
						teachers.push({
							id: teacherId,
							name: name,
							email: email,
							phone: profileData.phone,
							subject: profileData.subject,
							gender: profileData.gender || 'Male',
							experience: profileData.experience,
							qualification: profileData.qualification,
							address: profileData.address,
							status: 'Active',
							documents: uploadedDocuments,
							userId: editingUserId
						});
					}
				} else {
					// New user - create teacher record
					const teacherId = 'TCH-' + new Date().getFullYear() + '-' + String(teachers.length + 1).padStart(3, '0');
					teachers.push({
						id: teacherId,
						name: name,
						email: email,
						phone: profileData.phone,
						subject: profileData.subject,
						gender: profileData.gender || 'Male',
						experience: profileData.experience,
						qualification: profileData.qualification,
						address: profileData.address,
						status: 'Active',
						documents: uploadedDocuments,
						userId: null // Will be set after user is created
					});
				}
				save('edu_teachers', teachers);
			}

			const users = loadUsers();
			const usernameExists = users.some(u => u.username && u.username.toLowerCase() === username.toLowerCase() && u.id !== editingUserId);
			if (usernameExists) {
				notify('Username already exists. Please choose another.', 'error');
				return;
			}

			if (editingUserId) {
				const idx = users.findIndex(u => u.id === editingUserId);
				if (idx !== -1) {
					// Never allow Super Admin to be downgraded or inactivated
					if (users[idx].role === 'SuperAdmin') {
						users[idx].name = name;
						users[idx].email = email;
						users[idx].username = username;
						users[idx].permissions = permissions;
						if (password && password.length >= 6) {
							users[idx].password = password;
						}
					} else {
						users[idx] = {
							...users[idx],
							name,
							email,
							username,
							role,
							status,
							permissions,
							linkedProfile,
							...(password && password.length >= 6 ? { password } : {})
						};
					}
					notify('User updated successfully!', 'success');
				}
			} else {
				const newUser = {
					id: 'USR' + String(users.length + 1).padStart(3, '0'),
					name,
					username,
					email,
					role,
					status,
					password,
					permissions,
					linkedProfile,
					lastLogin: '-'
				};
				users.push(newUser);
				
				// Link student/teacher records with user ID
				if (linkedType === 'student') {
					const students = load('edu_students');
					const lastStudent = students[students.length - 1];
					if (lastStudent && !lastStudent.userId) {
						lastStudent.userId = newUser.id;
						save('edu_students', students);
					}
				} else if (linkedType === 'teacher') {
					const teachers = load('edu_teachers');
					const lastTeacher = teachers[teachers.length - 1];
					if (lastTeacher && !lastTeacher.userId) {
						lastTeacher.userId = newUser.id;
						save('edu_teachers', teachers);
					}
				}
				
				notify('User added successfully!', 'success');
			}
			saveUsers(users);
			renderUsers();
			document.getElementById('userModal').classList.remove('active');
		});

		window.editUser = function(id) {
			const users = loadUsers();
			const user = users.find(u => u.id === id);
			if (user) {
				if (currentRoleKey !== 'superadmin') {
					notify('Only Super Admin can edit users.', 'error');
					return;
				}
				editingUserId = id;
				document.getElementById('userModalTitle').textContent = 'Edit User';
				document.getElementById('userName').value = user.name;
				document.getElementById('userUsername').value = user.username || '';
				document.getElementById('userEmail').value = user.email;
				document.getElementById('userRole').value = user.role;
				document.getElementById('userStatus').value = user.status;

				// Reset to first tab when opening edit
				document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
				document.querySelector('.modal-tab[data-tab="details"]').classList.add('active');
				document.querySelectorAll('.tab-section').forEach(s => s.classList.remove('active'));
				document.querySelector('.tab-details').classList.add('active');

				// Enabled modules based on existing permissions
				const perms = user.permissions || {};
				currentEnabledModules = Object.keys(perms).filter(k => {
					const p = perms[k];
					return p && (p.view || p.edit || p.delete);
				});
				if (currentEnabledModules.length === 0) {
					currentEnabledModules = Object.keys(ROLE_DEFAULT_PERMISSIONS[user.role] || {});
				}
				document.querySelectorAll('.module-toggle').forEach(cb => {
					cb.checked = currentEnabledModules.includes(cb.value);
				});

				renderPermissionTable(perms, user.role || 'Admin');

				// Linked profile
				const lp = user.linkedProfile || null;
				const typeSelect = document.getElementById('linkedProfileType');
				if (typeSelect) typeSelect.value = lp?.type || 'none';

				// Populate profile forms
				if (lp?.type === 'student') {
					document.getElementById('studentProfileClass').value = lp.class || '';
					document.getElementById('studentProfileSection').value = lp.section || '';
					document.getElementById('studentProfileRoll').value = lp.roll || '';
					document.getElementById('studentProfileDOB').value = lp.dob || '';
					document.getElementById('studentProfileGender').value = lp.gender || '';
					document.getElementById('studentProfileAddress').value = lp.address || '';
					document.getElementById('studentProfileParentName').value = lp.parentName || '';
					document.getElementById('studentProfileParentPhone').value = lp.parentPhone || '';
				}
				if (lp?.type === 'teacher') {
					document.getElementById('teacherProfileSubject').value = lp.subject || '';
					document.getElementById('teacherProfilePhone').value = lp.phone || '';
					document.getElementById('teacherProfileExperience').value = lp.experience || '';
					document.getElementById('teacherProfileQualification').value = lp.qualification || '';
					document.getElementById('teacherProfileGender').value = lp.gender || '';
					document.getElementById('teacherProfileAddress').value = lp.address || '';
				}
				
				// Load documents
				uploadedDocuments = lp?.documents || [];
				renderUploadedDocuments();
				
				updateProfileFormsVisibility();

				document.getElementById('userPassword').value = '';
				document.getElementById('userModal').classList.add('active');
				updateSaveButtonState();
			}
		};

		// Quick enable/disable from table
		window.toggleUserStatus = function(id) {
			const users = loadUsers();
			const idx = users.findIndex(u => u.id === id);
			if (idx === -1) return;

			const user = users[idx];
			if (user.role === 'SuperAdmin') {
				notify('Super Admin cannot be disabled.', 'error');
				return;
			}

			user.status = user.status === 'Active' ? 'Inactive' : 'Active';
			users[idx] = user;
			saveUsers(users);
			renderUsers();
			notify(`User ${user.status === 'Active' ? 'activated' : 'disabled'} successfully.`, 'success');
		};

		window.deleteUser = function(id) {
			if (currentRoleKey !== 'superadmin') {
				notify('Only Super Admin can delete users.', 'error');
				return;
			}
			if (confirm('Are you sure you want to delete this user?')) {
				let users = loadUsers();
				const userToDelete = users.find(u => u.id === id);
				if (userToDelete && userToDelete.role === 'SuperAdmin') {
					notify('Super Admin account cannot be deleted.', 'error');
					return;
				}
				users = users.filter(u => u.id !== id);
				saveUsers(users);
				renderUsers();
				notify('User deleted successfully!', 'success');
			}
		};

		// ==================== THEME SELECTION ====================
		document.querySelectorAll('.theme-card').forEach(card => {
			card.addEventListener('click', () => {
				document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
				card.classList.add('active');
				const theme = card.dataset.theme;
				const settings = loadSettings();
				settings.theme = theme;
				saveSettings(settings);
				notify(`Theme changed to ${card.querySelector('.theme-name').textContent}!`, 'success');
			});
		});

		// ==================== SAVE BUTTONS ====================
		document.getElementById('saveAllBtn').addEventListener('click', () => {
			saveAllSettings();
			notify('All settings saved successfully!', 'success');
		});

		// Logo upload interactions (branding)
		(function initLogoUpload() {
			const input = document.getElementById('schoolLogo');
			const btn = document.getElementById('schoolLogoBtn');
			const fileName = document.getElementById('schoolLogoFileName');
			if (!input || !btn || !fileName) return;

			btn.addEventListener('click', () => input.click());
			input.addEventListener('change', () => {
				const file = input.files && input.files[0];
				if (!file) return;
				fileName.textContent = file.name;

				const reader = new FileReader();
				reader.onload = e => {
					const preview = document.getElementById('schoolLogoPreview');
					if (preview) {
						preview.style.backgroundImage = `url(${e.target.result})`;
						preview.style.backgroundSize = 'cover';
						preview.style.backgroundPosition = 'center';
						preview.textContent = '';
					}
				};
				reader.readAsDataURL(file);
			});
		})();

		document.getElementById('saveSchoolBtn').addEventListener('click', () => {
			const settings = loadSettings();
			settings.school = {
				name: document.getElementById('schoolName').value,
				code: document.getElementById('schoolCode').value,
				established: document.getElementById('establishedYear').value,
				principal: document.getElementById('principalName').value,
				board: document.getElementById('boardAffiliation').value,
				email: document.getElementById('schoolEmail').value,
				phone: document.getElementById('schoolPhone').value,
				address: document.getElementById('schoolAddress').value
			};
			saveSettings(settings);
			notify('School profile saved!', 'success');
		});

		document.getElementById('saveAcademicBtn').addEventListener('click', () => {
			const settings = loadSettings();
			settings.academic = {
				year: document.getElementById('academicYear').value,
				start: document.getElementById('sessionStart').value,
				end: document.getElementById('sessionEnd').value,
				workingDays: document.getElementById('workingDays').value
			};
			saveSettings(settings);
			notify('Academic settings saved!', 'success');
		});

		document.getElementById('saveNotifBtn').addEventListener('click', () => {
			const settings = loadSettings();
			settings.notifications = {
				email: document.getElementById('emailNotif').checked,
				sms: document.getElementById('smsNotif').checked,
				feeReminder: document.getElementById('feeReminder').checked,
				attendance: document.getElementById('attendanceAlert').checked,
				exam: document.getElementById('examNotif').checked,
				holiday: document.getElementById('holidayNotif').checked
			};
			saveSettings(settings);
			notify('Notification settings saved!', 'success');
		});

		document.getElementById('saveAppearanceBtn').addEventListener('click', () => {
			const settings = loadSettings();
			settings.appearance = {
				sidebarPosition: document.getElementById('sidebarPosition').value,
				fontSize: document.getElementById('fontSize').value,
				dateFormat: document.getElementById('dateFormat').value,
				timeFormat: document.getElementById('timeFormat').value,
				compactMode: document.getElementById('compactMode').checked
			};
			saveSettings(settings);
			notify('Appearance settings saved!', 'success');
		});

		document.getElementById('changePasswordBtn').addEventListener('click', () => {
			const current = document.getElementById('currentPassword').value;
			const newPass = document.getElementById('newPassword').value;
			const confirm = document.getElementById('confirmPassword').value;

			if (!current || !newPass || !confirm) {
				notify('Please fill all password fields', 'error');
				return;
			}
			if (newPass !== confirm) {
				notify('New passwords do not match', 'error');
				return;
			}
			if (newPass.length < 8) {
				notify('Password must be at least 8 characters', 'error');
				return;
			}
			notify('Password changed successfully!', 'success');
			document.getElementById('currentPassword').value = '';
			document.getElementById('newPassword').value = '';
			document.getElementById('confirmPassword').value = '';
		});

		// ==================== BACKUP FUNCTIONS ====================
		function exportToJSON(data, filename) {
			const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
			const link = document.createElement('a');
			link.href = URL.createObjectURL(blob);
			link.download = filename + '_' + new Date().toISOString().slice(0, 10) + '.json';
			link.click();
		}

		document.getElementById('backupAllBtn').addEventListener('click', () => {
			const backup = {
				students: load('edu_students'),
				teachers: load('edu_teachers'),
				attendance: load('edu_attendance'),
				exams: load('edu_exams'),
				users: loadUsers(),
				settings: loadSettings(),
				timestamp: new Date().toISOString()
			};
			exportToJSON(backup, 'EduManage_Full_Backup');
			const settings = loadSettings();
			settings.lastBackup = new Date().toLocaleString();
			saveSettings(settings);
			notify('Full backup downloaded!', 'success');
		});

		document.getElementById('backupStudentsBtn').addEventListener('click', () => {
			exportToJSON(load('edu_students'), 'Students_Backup');
			notify('Students backup downloaded!', 'success');
		});

		document.getElementById('backupTeachersBtn').addEventListener('click', () => {
			exportToJSON(load('edu_teachers'), 'Teachers_Backup');
			notify('Teachers backup downloaded!', 'success');
		});

		document.getElementById('restoreBtn').addEventListener('click', () => {
			const file = document.getElementById('restoreFile').files[0];
			if (!file) {
				notify('Please select a backup file', 'error');
				return;
			}
			const reader = new FileReader();
			reader.onload = function(e) {
				try {
					const data = JSON.parse(e.target.result);
					if (data.students) save('edu_students', data.students);
					if (data.teachers) save('edu_teachers', data.teachers);
					if (data.attendance) save('edu_attendance', data.attendance);
					if (data.exams) save('edu_exams', data.exams);
					if (data.users) saveUsers(data.users);
					if (data.settings) saveSettings(data.settings);
					notify('Data restored successfully!', 'success');
					renderUsers();
					renderSystemInfo();
				} catch(err) {
					notify('Invalid backup file', 'error');
				}
			};
			reader.readAsText(file);
		});

		document.getElementById('clearStudentsBtn').addEventListener('click', () => {
			if (confirm('Are you sure you want to delete ALL students? This cannot be undone!')) {
				localStorage.removeItem('edu_students');
				notify('All students cleared!', 'success');
				renderSystemInfo();
			}
		});

		document.getElementById('clearTeachersBtn').addEventListener('click', () => {
			if (confirm('Are you sure you want to delete ALL teachers? This cannot be undone!')) {
				localStorage.removeItem('edu_teachers');
				notify('All teachers cleared!', 'success');
				renderSystemInfo();
			}
		});

		document.getElementById('clearAllBtn').addEventListener('click', () => {
			if (confirm(' WARNING: This will delete ALL data including students, teachers, attendance, exams, and settings. Are you absolutely sure?')) {
				if (confirm('This is your FINAL warning. Click OK to permanently delete everything.')) {
					localStorage.clear();
					notify('All data cleared!', 'success');
					initDemoData();
					renderUsers();
					renderSystemInfo();
				}
			}
		});

		document.getElementById('checkUpdatesBtn').addEventListener('click', () => {
			notify('You are running the latest version (2.5.0)', 'info');
		});

		document.getElementById('viewLogsBtn').addEventListener('click', () => {
			notify('Activity log feature coming soon!', 'info');
		});

		// ==================== SAVE ALL SETTINGS ====================
		function saveAllSettings() {
			const settings = loadSettings();
			settings.school = {
				name: document.getElementById('schoolName').value,
				code: document.getElementById('schoolCode').value,
				established: document.getElementById('establishedYear').value,
				principal: document.getElementById('principalName').value,
				board: document.getElementById('boardAffiliation').value,
				email: document.getElementById('schoolEmail').value,
				phone: document.getElementById('schoolPhone').value,
				address: document.getElementById('schoolAddress').value
			};
			settings.academic = {
				year: document.getElementById('academicYear').value,
				start: document.getElementById('sessionStart').value,
				end: document.getElementById('sessionEnd').value,
				workingDays: document.getElementById('workingDays').value
			};
			settings.notifications = {
				email: document.getElementById('emailNotif').checked,
				sms: document.getElementById('smsNotif').checked,
				feeReminder: document.getElementById('feeReminder').checked,
				attendance: document.getElementById('attendanceAlert').checked,
				exam: document.getElementById('examNotif').checked,
				holiday: document.getElementById('holidayNotif').checked
			};
			settings.appearance = {
				sidebarPosition: document.getElementById('sidebarPosition').value,
				fontSize: document.getElementById('fontSize').value,
				dateFormat: document.getElementById('dateFormat').value,
				timeFormat: document.getElementById('timeFormat').value,
				compactMode: document.getElementById('compactMode').checked
			};
			saveSettings(settings);
		}

		// ==================== LOAD SETTINGS ====================
		function loadSavedSettings() {
			const settings = loadSettings();
			if (settings.school) {
				document.getElementById('schoolName').value = settings.school.name || 'EduManage Pro School';
				document.getElementById('schoolCode').value = settings.school.code || 'EMPS2024';
				document.getElementById('establishedYear').value = settings.school.established || '1995';
				document.getElementById('principalName').value = settings.school.principal || 'Dr. Rajesh Kumar';
				document.getElementById('boardAffiliation').value = settings.school.board || 'CBSE';
				document.getElementById('schoolEmail').value = settings.school.email || 'info@edumanage.edu';
				document.getElementById('schoolPhone').value = settings.school.phone || '+91 9876543210';
				document.getElementById('schoolAddress').value = settings.school.address || '123 Education Street, Knowledge Park, New Delhi - 110001';
			}
			if (settings.notifications) {
				document.getElementById('emailNotif').checked = settings.notifications.email !== false;
				document.getElementById('smsNotif').checked = settings.notifications.sms !== false;
				document.getElementById('feeReminder').checked = settings.notifications.feeReminder !== false;
				document.getElementById('attendanceAlert').checked = settings.notifications.attendance !== false;
				document.getElementById('examNotif').checked = settings.notifications.exam !== false;
				document.getElementById('holidayNotif').checked = settings.notifications.holiday === true;
			}
			if (settings.appearance) {
				document.getElementById('sidebarPosition').value = settings.appearance.sidebarPosition || 'left';
				document.getElementById('fontSize').value = settings.appearance.fontSize || 'medium';
				document.getElementById('dateFormat').value = settings.appearance.dateFormat || 'DD/MM/YYYY';
				document.getElementById('timeFormat').value = settings.appearance.timeFormat || '12h';
				document.getElementById('compactMode').checked = settings.appearance.compactMode === true;
			}
			if (settings.theme) {
				document.querySelectorAll('.theme-card').forEach(c => {
					c.classList.toggle('active', c.dataset.theme === settings.theme);
				});
			}
		}

		// ==================== INITIALIZE ====================
		document.addEventListener('DOMContentLoaded', () => {
			// Ensure only the first tab (School Profile) is active on load
			document.querySelectorAll('.nav-item').forEach((item, index) => {
				if (index === 0) {
					item.classList.add('active');
				} else {
					item.classList.remove('active');
				}
			});
			document.querySelectorAll('.settings-section').forEach((section, index) => {
				if (index === 0) {
					section.classList.add('active');
				} else {
					section.classList.remove('active');
				}
			});
			
			initDemoData();
			loadSavedSettings();
			renderUsers();
			renderClasses();
			renderSubjects();
			renderSystemInfo();
			initFilters();
			// Initialize table resizing after a short delay to ensure table is rendered
			setTimeout(() => {
				initTableResize();
			}, 100);
			console.log('Settings page loaded - All buttons enabled');
		});

		// Run immediately
		initDemoData();
		loadSavedSettings();
		renderUsers();
		renderClasses();
		renderSubjects();
		renderSystemInfo();
		// ==================== FILTER FUNCTIONS ====================
		function updateFilterCounts(users, userIdFilter, usernameFilter, nameFilter, emailFilter, roleFilter, statusFilter, lastLoginFilter) {
			const allUsers = loadUsers();
			
			const countUserId = allUsers.filter(u => !userIdFilter || u.id.toLowerCase().includes(userIdFilter.toLowerCase())).length;
			const countUsername = allUsers.filter(u => !usernameFilter || (u.username && u.username.toLowerCase().includes(usernameFilter.toLowerCase()))).length;
			const countName = allUsers.filter(u => !nameFilter || u.name.toLowerCase().includes(nameFilter.toLowerCase())).length;
			const countEmail = allUsers.filter(u => !emailFilter || u.email.toLowerCase().includes(emailFilter.toLowerCase())).length;
			const countRole = allUsers.filter(u => !roleFilter || u.role === roleFilter).length;
			const countStatus = allUsers.filter(u => !statusFilter || u.status === statusFilter).length;
			const countLastLogin = allUsers.filter(u => !lastLoginFilter || (u.lastLogin && u.lastLogin.toLowerCase().includes(lastLoginFilter.toLowerCase()))).length;
			
			document.getElementById('countUserId').textContent = userIdFilter ? `${countUserId}` : '-';
			document.getElementById('countUsername').textContent = usernameFilter ? `${countUsername}` : '-';
			document.getElementById('countName').textContent = nameFilter ? `${countName}` : '-';
			document.getElementById('countEmail').textContent = emailFilter ? `${countEmail}` : '-';
			document.getElementById('countRole').textContent = roleFilter ? `${countRole}` : '-';
			document.getElementById('countStatus').textContent = statusFilter ? `${countStatus}` : '-';
			document.getElementById('countLastLogin').textContent = lastLoginFilter ? `${countLastLogin}` : '-';
			
			// Highlight active filters
			document.getElementById('countUserId').style.color = userIdFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countUsername').style.color = usernameFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countName').style.color = nameFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countEmail').style.color = emailFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countRole').style.color = roleFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countStatus').style.color = statusFilter ? '#4A6CF7' : '#64748b';
			document.getElementById('countLastLogin').style.color = lastLoginFilter ? '#4A6CF7' : '#64748b';
		}

		function initFilters() {
			const filterUserId = document.getElementById('filterUserId');
			const filterUsername = document.getElementById('filterUsername');
			const filterName = document.getElementById('filterName');
			const filterEmail = document.getElementById('filterEmail');
			const filterRole = document.getElementById('filterRole');
			const filterStatus = document.getElementById('filterStatus');
			const filterLastLogin = document.getElementById('filterLastLogin');
			const clearFiltersBtn = document.getElementById('clearFilters');
			
			if (!filterUserId || !filterUsername || !filterName || !filterEmail || !filterRole || !filterStatus || !filterLastLogin) {
				return; // Filters not found, skip initialization
			}
			
			const applyFilters = () => {
				const userIdFilter = filterUserId.value.trim();
				const usernameFilter = filterUsername.value.trim();
				const nameFilter = filterName.value.trim();
				const emailFilter = filterEmail.value.trim();
				const roleFilter = filterRole.value;
				const statusFilter = filterStatus.value;
				const lastLoginFilter = filterLastLogin.value.trim();
				
				const allUsers = loadUsers();
				let filtered = allUsers;
				
				if (userIdFilter) {
					filtered = filtered.filter(u => u.id.toLowerCase().includes(userIdFilter.toLowerCase()));
				}
				if (usernameFilter) {
					filtered = filtered.filter(u => u.username && u.username.toLowerCase().includes(usernameFilter.toLowerCase()));
				}
				if (nameFilter) {
					filtered = filtered.filter(u => u.name.toLowerCase().includes(nameFilter.toLowerCase()));
				}
				if (emailFilter) {
					filtered = filtered.filter(u => u.email.toLowerCase().includes(emailFilter.toLowerCase()));
				}
				if (roleFilter) {
					filtered = filtered.filter(u => u.role === roleFilter);
				}
				if (statusFilter) {
					filtered = filtered.filter(u => u.status === statusFilter);
				}
				if (lastLoginFilter) {
					filtered = filtered.filter(u => u.lastLogin && u.lastLogin.toLowerCase().includes(lastLoginFilter.toLowerCase()));
				}
				
				renderUsers(filtered);
				updateFilterCounts(allUsers, userIdFilter, usernameFilter, nameFilter, emailFilter, roleFilter, statusFilter, lastLoginFilter);
			};
			
			filterUserId.addEventListener('keyup', applyFilters);
			filterUsername.addEventListener('keyup', applyFilters);
			filterName.addEventListener('keyup', applyFilters);
			filterEmail.addEventListener('keyup', applyFilters);
			filterRole.addEventListener('change', applyFilters);
			filterStatus.addEventListener('change', applyFilters);
			filterLastLogin.addEventListener('keyup', applyFilters);
			
			if (clearFiltersBtn) {
				clearFiltersBtn.addEventListener('click', () => {
					filterUserId.value = '';
					filterUsername.value = '';
					filterName.value = '';
					filterEmail.value = '';
					filterRole.value = '';
					filterStatus.value = '';
					filterLastLogin.value = '';
					renderUsers();
					updateFilterCounts(loadUsers(), '', '', '', '', '', '', '');
				});
			}
			
			// Initialize counts
			updateFilterCounts(loadUsers(), '', '', '', '', '', '', '');
		}

		// Initialize filters and table resizing after a short delay to ensure table is rendered
		setTimeout(() => {
			initFilters();
			initTableResize();
		}, 100);
	</script>
</body>
</html>
